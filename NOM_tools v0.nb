(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    639141,      16527]
NotebookOptionsPosition[    628295,      16394]
NotebookOutlinePosition[    628708,      16410]
CellTagsIndexPosition[    628665,      16407]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"$HistoryLength", "=", "0"}], ";", 
  RowBox[{"Print", "[", "\"\<History Length has been set to 0\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "$HistoryLength", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"$VersionNumber", "<", "10.1"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"StringStartsQ", "[", 
       RowBox[{"s1_String", ",", "s2_String"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"StringTake", "[", 
        RowBox[{"s1", ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"StringLength", "[", "s1", "]"}], ",", 
             RowBox[{"StringLength", "[", "s2", "]"}]}], "]"}]}], "}"}]}], 
        "]"}], "\[Equal]", "s2"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"StringDelete", "[", 
       RowBox[{"s1_String", ",", "s_String"}], "]"}], ":=", 
      RowBox[{"StringJoin", "[", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"s1", ",", "s"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"StringDelete", "[", 
       RowBox[{"s1_String", ",", "s_List"}], "]"}], ":=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"s2", "=", "s1"}], "}"}], ",", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"s2", "=", 
            RowBox[{"StringDelete", "[", 
             RowBox[{"s2", ",", 
              RowBox[{"s", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "s", "]"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "s2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MinMax", "[", "a_List", "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Min", "[", "a", "]"}], ",", 
        RowBox[{"Max", "[", "a", "]"}]}], "}"}]}], ";"}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.766477775318651*^9, 3.7664777753206515`*^9}, {
  3.7983866913846426`*^9, 
  3.798386721269352*^9}},ExpressionUUID->"e105784a-1344-4304-ac26-\
917ea4cbff95"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Both", " ", "oldVar", " ", "and", " ", "newVar", " ", "need", " ", "to", 
     " ", "be", " ", 
     RowBox[{"atomQ", ".", " ", "It"}], " ", "does", " ", "the", " ", 
     "substition", " ", "in", " ", 
     RowBox[{"place", "!"}], " ", "This", " ", "function", " ", "is", " ", 
     "very", " ", 
     RowBox[{"useful", ".", " ", "It"}], " ", "can", " ", "rename", " ", 
     "the", " ", "variable", " ", "in", " ", 
     RowBox[{"place", ".", " ", "Therefore"}]}], ",", " ", 
    RowBox[{
    "in", " ", "the", " ", "first", " ", "draft", " ", "of", " ", "the", " ", 
     "code"}], ",", " ", 
    RowBox[{
    "we", " ", "can", " ", "use", " ", "simple", " ", "name", " ", "and", " ",
      "then", " ", "use", " ", "more", " ", "meaningful", " ", "name", " ", 
     RowBox[{"latter", ".", " ", "Developed"}], " ", "in", " ", "notebook", 
     " ", 
     RowBox[{"NotebookModifyCell", ".", "nb"}]}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"RenameVarInCell", "[", 
    RowBox[{
     RowBox[{"oldVar_", "?", "AtomQ"}], ",", 
     RowBox[{"newVar_", "?", "AtomQ"}]}], "]"}], ":=", 
   RowBox[{"NotebookWrite", "[", 
    RowBox[{
     RowBox[{"PreviousCell", "[", "]"}], ",", 
     RowBox[{"ReplaceAll", "[", 
      RowBox[{
       RowBox[{"NotebookRead", "[", 
        RowBox[{"PreviousCell", "[", "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"ToString", "[", "oldVar", "]"}], "\[Rule]", 
          RowBox[{"ToString", "[", "newVar", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"ToString", "[", "oldVar", "]"}], "<>", "\"\<_\>\""}], 
          "\[Rule]", 
          RowBox[{
           RowBox[{"ToString", "[", "newVar", "]"}], "<>", "\"\<_\>\""}]}]}], 
        "}"}]}], "]"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.818327429791625*^9, 3.818327501489123*^9}, {
  3.8183275451895056`*^9, 3.8183275990924044`*^9}, {3.818327634828497*^9, 
  3.8183276457834396`*^9}},ExpressionUUID->"50f569c4-75fd-4294-973f-\
250ca1546d90"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"https", ":"}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
        "questions"}], "/", "1512"}], "/", "how"}], "-", "to", "-", "abort", 
     "-", "on", "-", "any", "-", "message", "-", "generated"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"AbortOnMessage", "[", 
    RowBox[{"t_", ":", "True"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{"t", ",", 
     RowBox[{
      RowBox[{"messageHandler", "=", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Last", "[", "#", "]"}], ",", 
          RowBox[{"Abort", "[", "]"}]}], "]"}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Internal`AddHandler", "[", 
       RowBox[{"\"\<Message\>\"", ",", "messageHandler"}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Internal`RemoveHandler", "[", 
      RowBox[{"\"\<Message\>\"", ",", "messageHandler"}], "]"}]}], 
    "]"}]}]}]], "Input",
 CellLabel->"In[1]:=",ExpressionUUID->"ead747ab-a475-45d0-935c-942ca3023394"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"LessThan2", "[", 
    RowBox[{"v1_List", ",", "v2_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p", "=", "True"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"v1", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ">", " ", 
           RowBox[{"v2", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"p", "=", "False"}], ";", 
           RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "v1", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"Return", "[", "p", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindPoints", "[", 
    RowBox[{"v1_List", ",", "xmin_List", ",", "xmax_List", ",", 
     RowBox[{"show_", ":", "False"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ilist", "=", 
        RowBox[{"{", "}"}]}], ",", "y", ",", "r", ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"v1", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"len", "=", 
        RowBox[{"Length", "[", "v1", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"LessThan2", "[", 
            RowBox[{
             RowBox[{"v1", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "xmax"}], "]"}], "&&", " ", 
           RowBox[{"LessThan2", "[", 
            RowBox[{"xmin", ",", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ilist", ",", "i"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"show", ",", 
        RowBox[{
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", "ilist", "]"}], "]"}], ",", 
              RowBox[{"DataRange", "\[Rule]", "Automatic"}]}], "]"}], "]"}]}],
           "]"}], ";", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{
             RowBox[{"ListPointPlot3D", "[", 
              RowBox[{"v1", "[", 
               RowBox[{"[", "ilist", "]"}], "]"}], "]"}], ",", 
             RowBox[{"DataRange", "\[Rule]", "Full"}]}], "]"}]}], "]"}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", "ilist"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindPoints", "[", 
    RowBox[{"v1_List", ",", "xmin_List", ",", "xmax_List", ",", "range_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ilist", "=", 
        RowBox[{"{", "}"}]}], ",", "y", ",", "r", ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"v1", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"len", "=", 
        RowBox[{"Length", "[", "v1", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"LessThan2", "[", 
            RowBox[{
             RowBox[{"v1", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "xmax"}], "]"}], "&&", " ", 
           RowBox[{"LessThan2", "[", 
            RowBox[{"xmin", ",", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ilist", ",", "i"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "range"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "ilist"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindPoints", "[", 
    RowBox[{"v1_List", ",", "fun_", ",", "dist_", ",", 
     RowBox[{"show_", ":", "False"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ilist", "=", 
        RowBox[{"{", "}"}]}], ",", "y", ",", "r", ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"v1", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"len", "=", 
        RowBox[{"Length", "[", "v1", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"fun", "[", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "\[LessEqual]", 
           "dist"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ilist", ",", "i"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
      RowBox[{"If", "[", 
       RowBox[{"show", ",", 
        RowBox[{
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"ListPlot", "[", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "ilist", "]"}], "]"}], "]"}], "]"}]}], "]"}], ";", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"ListPointPlot3D", "[", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "ilist", "]"}], "]"}], "]"}], "]"}]}], "]"}]}]}], 
       "]"}], ";", "ilist"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ListMinus", "[", 
    RowBox[{"v1_List", ",", "v0_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v2", "=", "v1"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"v2", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "-=", "v0"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "v1", "]"}]}], "}"}]}], "]"}], ";", "v2"}]}],
     "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FindPointsC1", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"v1", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"y", ",", "r", ",", 
         RowBox[{"vt", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"Length", "[", "v1", "]"}], "}"}]}], "]"}]}]}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ">", "xmin"}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "<", "xmax"}]}], ",", 
             RowBox[{
              RowBox[{"vt", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "=", "1"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "v1", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Position", "[", 
         RowBox[{"vt", ",", "1"}], "]"}]}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FindPointsC2", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"v1", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"y", ",", "r", ",", 
         RowBox[{"vt", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"Length", "[", "v1", "]"}], "}"}]}], "]"}]}]}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], ">", 
               RowBox[{"xmin", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], ">", 
               RowBox[{"xmin", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "<", 
               RowBox[{"xmax", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "<", 
               RowBox[{"xmax", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"vt", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "=", "1"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "v1", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Position", "[", 
         RowBox[{"vt", ",", "1"}], "]"}]}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FindPointsC3", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"v1", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"y", ",", "r", ",", 
         RowBox[{"vt", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"Length", "[", "v1", "]"}], "}"}]}], "]"}]}]}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], ">", 
               RowBox[{"xmin", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], ">", 
               RowBox[{"xmin", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], " ", "&&", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "3"}], "]"}], "]"}], ">", 
               RowBox[{"xmin", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "<", 
               RowBox[{"xmax", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "<", 
               RowBox[{"xmax", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "3"}], "]"}], "]"}], "<", 
               RowBox[{"xmax", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"vt", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "=", "1"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "v1", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Position", "[", 
         RowBox[{"vt", ",", "1"}], "]"}]}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FindPointsC", "[", 
   RowBox[{"v1_List", ",", "xmin_List", ",", "xmax_List"}], "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"Switch", "[", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"v1", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "0", ",", 
     RowBox[{"FindPointsC1", "[", 
      RowBox[{"v1", ",", "xmin", ",", "xmax"}], "]"}], ",", "2", ",", 
     RowBox[{"FindPointsC2", "[", 
      RowBox[{"v1", ",", "xmin", ",", "xmax"}], "]"}], ",", "3", ",", 
     RowBox[{"FindPointsC3", "[", 
      RowBox[{"v1", ",", "xmin", ",", "xmax"}], "]"}]}], "]"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.7705574606788297`*^9, 3.770557504481335*^9}, {
   3.770557900930011*^9, 3.7705580690786285`*^9}, {3.770558120528571*^9, 
   3.7705581320632305`*^9}, {3.77055841965368*^9, 3.770558441268916*^9}, {
   3.7705584713456364`*^9, 3.770558490380725*^9}, {3.7705585412466345`*^9, 
   3.770558552800296*^9}, 3.772694995765539*^9, {3.7809853538763437`*^9, 
   3.780985453619379*^9}, {3.780985486110003*^9, 3.7809855820495872`*^9}, {
   3.780985624733679*^9, 3.780985835674273*^9}, {3.780985871323536*^9, 
   3.780986065042029*^9}, {3.7809861066828127`*^9, 3.7809861180789127`*^9}, {
   3.780986148996745*^9, 3.780986149443565*^9}, {3.78098622721113*^9, 
   3.780986255315727*^9}, {3.780986451961369*^9, 3.780986557639612*^9}, {
   3.78098730691753*^9, 3.7809873111204453`*^9}, {3.7809915449603243`*^9, 
   3.780991579953828*^9}, {3.783067133242486*^9, 3.7830671785300765`*^9}},
 CellLabel->
  "In[263]:=",ExpressionUUID->"ed31c5e5-d606-4bf4-bdec-8f23718a6674"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlotXY", "[", "x__", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"narg", ",", 
      RowBox[{"x2", "=", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"x3", "=", 
       RowBox[{"List", "[", "x", "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"narg", "=", 
      RowBox[{"Length", "[", "x3", "]"}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OddQ", "[", "narg", "]"}], ",", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<X,Y should be paired\>\"", "]"}], ";", 
        "Return"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"AppendTo", "[", 
        RowBox[{"x2", ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x3", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"2", "i"}], "-", "1"}], "]"}], "]"}], ",", 
            RowBox[{"x3", "[", 
             RowBox[{"[", 
              RowBox[{"2", "i"}], "]"}], "]"}]}], "}"}], "\[Transpose]"}]}], 
        "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"narg", "/", "2"}]}], "}"}]}], "]"}], ";", 
     RowBox[{"ListLinePlot", "[", 
      RowBox[{"x2", ",", 
       RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
       RowBox[{"PlotMarkers", "\[Rule]", "Automatic"}], ",", 
       RowBox[{"Mesh", "\[Rule]", "All"}]}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.752928532846854*^9, 3.7529287192247133`*^9}, {
  3.7529287942162476`*^9, 3.7529287944472427`*^9}, {3.75292903991096*^9, 
  3.752929051152977*^9}, {3.752929176785325*^9, 3.7529291891412807`*^9}, {
  3.7529292440963016`*^9, 3.7529293217633314`*^9}, {3.752929355095318*^9, 
  3.7529294415623703`*^9}, {3.7529294854703374`*^9, 3.7529295309573526`*^9}, {
  3.7529295700073953`*^9, 3.7529295863253775`*^9}, {3.7529296725743713`*^9, 
  3.75292968438238*^9}, {3.752929726471422*^9, 3.752929726789412*^9}},
 CellLabel->
  "In[272]:=",ExpressionUUID->"30bca96f-8013-4735-ad3a-d1cde44703ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlotXY0", "[", "x__", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"narg", ",", 
      RowBox[{"x2", "=", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"x3", "=", 
       RowBox[{"List", "[", "x", "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"narg", "=", 
      RowBox[{"Length", "[", "x3", "]"}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OddQ", "[", "narg", "]"}], ",", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<X,Y should be paired\>\"", "]"}], ";", 
        "Return"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"AppendTo", "[", 
        RowBox[{"x2", ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x3", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"2", "i"}], "-", "1"}], "]"}], "]"}], ",", 
            RowBox[{"x3", "[", 
             RowBox[{"[", 
              RowBox[{"2", "i"}], "]"}], "]"}]}], "}"}], "\[Transpose]"}]}], 
        "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"narg", "/", "2"}]}], "}"}]}], "]"}], ";", 
     RowBox[{"ListLinePlot", "[", 
      RowBox[{"x2", ",", 
       RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
       RowBox[{"Mesh", "\[Rule]", "None"}]}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7683844436649528`*^9, 3.768384446841134*^9}, {
  3.7683845963256845`*^9, 3.7683846173748884`*^9}, {3.7683847495384474`*^9, 
  3.768384749950471*^9}},
 CellLabel->
  "In[273]:=",ExpressionUUID->"d358a4a8-b9e5-4afb-bd62-d8afa2af52f0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PlotXYL", "[", "x__", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"narg", ",", 
       RowBox[{"x2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"x3", "=", 
        RowBox[{"List", "[", "x", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"narg", "=", 
       RowBox[{"Length", "[", "x3", "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Mod", "[", 
          RowBox[{"narg", ",", "3"}], "]"}], "\[NotEqual]", "0"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<X,Y should be paired\>\"", "]"}], ";", 
         "Return"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"x2", ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x3", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"3", "i"}], "-", "2"}], "]"}], "]"}], ",", 
             RowBox[{"x3", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"3", "i"}], "-", "1"}], "]"}], "]"}]}], "}"}], 
           "\[Transpose]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"narg", "/", "3"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", "x2", "]"}], ";"}], "*)"}], 
      RowBox[{"ListLinePlot", "[", 
       RowBox[{"x2", ",", 
        RowBox[{"PlotLegends", "\[Rule]", 
         RowBox[{"x3", "[", 
          RowBox[{"[", 
           RowBox[{"3", ";;", 
            RowBox[{"-", "1"}], ";;", "3"}], "]"}], "]"}]}], ",", 
        RowBox[{"AxesLabel", "\[Rule]", "axesLabel"}], ",", 
        RowBox[{"PlotMarkers", "\[Rule]", "Automatic"}], ",", 
        RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
        RowBox[{"AxesOrigin", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Min", "[", 
            RowBox[{"x2", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"Min", "[", 
            RowBox[{"x2", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}]}], 
          "}"}]}]}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"axesLabel", "=", 
   RowBox[{"{", 
    RowBox[{"\"\<X\>\"", ",", "\"\<Y\>\""}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.752929903238038*^9, 3.7529299105180464`*^9}, {
  3.7529299564290123`*^9, 3.7529299836230574`*^9}, {3.752930058526067*^9, 
  3.752930109950074*^9}, {3.752930496696108*^9, 3.7529305060030527`*^9}, {
  3.7529305649416885`*^9, 3.7529306432692785`*^9}, {3.755933721463193*^9, 
  3.7559337428423014`*^9}, {3.755933845824856*^9, 3.755933846951563*^9}, {
  3.755933885524847*^9, 3.7559339093785377`*^9}, {3.7559340866553383`*^9, 
  3.7559341326522465`*^9}, {3.755934167045921*^9, 3.7559341683895884`*^9}, {
  3.7559342352642045`*^9, 3.755934238691862*^9}, {3.7559343136863317`*^9, 
  3.7559343504803724`*^9}, {3.7789054760553937`*^9, 3.778905476556422*^9}},
 CellLabel->
  "In[274]:=",ExpressionUUID->"09d9eda1-2b53-47c8-a773-3d0b3bd061fb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PlotXYL", "[", "x__", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"narg", ",", 
       RowBox[{"x2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"x3", "=", 
        RowBox[{"List", "[", "x", "]"}]}], ",", "x0"}], "}"}], ",", 
     RowBox[{
      RowBox[{"narg", "=", 
       RowBox[{"Length", "[", "x3", "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Mod", "[", 
          RowBox[{"narg", ",", "3"}], "]"}], "\[NotEqual]", "0"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<X,Y should be paired\>\"", "]"}], ";", 
         "Return"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"x2", ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x3", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"3", "i"}], "-", "2"}], "]"}], "]"}], ",", 
             RowBox[{"x3", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"3", "i"}], "-", "1"}], "]"}], "]"}]}], "}"}], 
           "\[Transpose]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"narg", "/", "3"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x0", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Min", "[", 
          RowBox[{"x2", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"Min", "[", 
          RowBox[{"x2", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}]}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x0", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"x0", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ">", "0"}], ",", "0.95", ",", 
            "1.05"}], "]"}], ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"x0", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ">", "0"}], ",", "0.95", ",", 
            "1.05"}], "]"}]}], "}"}], "x0"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", "x2", "]"}], ";"}], "*)"}], 
      RowBox[{"Labeled", "[", 
       RowBox[{
        RowBox[{"ListLinePlot", "[", 
         RowBox[{"x2", ",", 
          RowBox[{"PlotLegends", "\[Rule]", 
           RowBox[{"x3", "[", 
            RowBox[{"[", 
             RowBox[{"3", ";;", 
              RowBox[{"-", "1"}], ";;", "3"}], "]"}], "]"}]}], ",", 
          RowBox[{"PlotMarkers", "\[Rule]", "Automatic"}], ",", 
          RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
          RowBox[{"AxesOrigin", "\[Rule]", "x0"}]}], "]"}], ",", 
        RowBox[{"Reverse", "[", "axesLabel", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"Left", ",", "Bottom"}], "}"}], ",", 
        RowBox[{"RotateLabel", "\[Rule]", "True"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"axesLabel", "=", 
   RowBox[{"{", 
    RowBox[{"\"\<X\>\"", ",", "\"\<Y\>\""}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7974770509937677`*^9, 3.797477058190179*^9}, {
  3.7974771308613358`*^9, 3.797477214908143*^9}, {3.7974773054153194`*^9, 
  3.797477400331749*^9}, {3.7974774626273117`*^9, 3.7974775262449503`*^9}, {
  3.797477668109065*^9, 3.797477673317363*^9}},
 CellLabel->
  "In[515]:=",ExpressionUUID->"df8df1fe-7250-4062-bf28-367877bd16e4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "cc", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cc", "[", "a_List", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"da", "=", 
        RowBox[{"Dimensions", "[", "a", "]"}]}], ",", "sa"}], "}"}], ",", 
     RowBox[{
      RowBox[{"sa", "=", 
       RowBox[{"ToString", "[", 
        RowBox[{"InputForm", "[", "a", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sa", "=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"sa", ",", 
         RowBox[{"\"\<*^\>\"", "\[Rule]", "\"\<e\>\""}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "da", "]"}], "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"sa", "=", 
          RowBox[{"StringTake", "[", 
           RowBox[{"sa", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", 
              RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], ";", 
         RowBox[{"sa", "=", 
          RowBox[{"StringReplace", "[", 
           RowBox[{"sa", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<,\>\"", "\[Rule]", "\"\<\\n\>\""}], "}"}]}], 
           "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "da", "]"}], "\[Equal]", "2"}], ",", 
        RowBox[{
         RowBox[{"sa", "=", 
          RowBox[{"StringTake", "[", 
           RowBox[{"sa", ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", 
              RowBox[{"-", "3"}]}], "}"}]}], "]"}]}], ";", 
         RowBox[{"sa", "=", 
          RowBox[{"StringDelete", "[", 
           RowBox[{"sa", ",", 
            RowBox[{"{", 
             RowBox[{"\"\< \>\"", ",", "\"\<},\>\""}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"sa", "=", 
          RowBox[{"StringReplace", "[", 
           RowBox[{"sa", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<,\>\"", "\[Rule]", "\"\< \>\""}], ",", 
              RowBox[{"\"\<{\>\"", "\[Rule]", "\"\<\\n\>\""}]}], "}"}]}], 
           "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"CopyToClipboard", "[", "sa", "]"}]}]}], "]"}]}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"cc", "[", "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"da", "=", 
          RowBox[{"ToString", "[", 
           RowBox[{"InputForm", "[", 
            RowBox[{"NotebookGet", "@", 
             RowBox[{"ClipboardNotebook", "[", "]"}]}], "]"}], "]"}]}], ",", 
         "ia", ",", "$$$a", ",", "fa"}], "}"}], ",", 
       RowBox[{
        RowBox[{"ia", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"StringPosition", "[", 
            RowBox[{"da", ",", "\"\<\\\"\>\"", ",", "2"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"1", ";;", "2"}], ",", "1"}], "]"}], "]"}], "+", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"-", "1"}]}], "}"}]}]}], ";", " ", 
        RowBox[{"da", "=", 
         RowBox[{"StringTake", "[", 
          RowBox[{"da", ",", "ia"}], "]"}]}], ";", 
        RowBox[{"da", "=", 
         RowBox[{"StringReplace", "[", 
          RowBox[{"da", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<\\\\t\>\"", "\[Rule]", "\"\<,\>\""}], ",", 
             RowBox[{"\"\< \>\"", "\[Rule]", "\"\<,\>\""}], ",", 
             RowBox[{"\"\<E\>\"", "\[Rule]", "\"\<*^\>\""}], ",", 
             RowBox[{"\"\<e\>\"", "\[Rule]", "\"\<*^\>\""}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"da", "=", 
         RowBox[{"StringReplace", "[", 
          RowBox[{"da", ",", 
           RowBox[{"\"\<\\\\n\>\"", "\[Rule]", "\"\<},{\>\""}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"da", "=", 
         RowBox[{"StringReplace", "[", 
          RowBox[{"da", ",", 
           RowBox[{"\"\<,}\>\"", "\[Rule]", "\"\<}\>\""}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"da", "=", 
         RowBox[{"StringReplace", "[", 
          RowBox[{"da", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<,,\>\"", "\[Rule]", "\"\<,\>\""}], ",", 
             RowBox[{"\"\<,,,\>\"", "\[Rule]", "\"\<,\>\""}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"da", "=", 
         RowBox[{"\"\<{{\>\"", "<>", "da", "<>", "\"\<}}\>\""}]}], ";", 
        RowBox[{"$$$a", "=", 
         RowBox[{"ToExpression", "[", "da", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"fa", "=", 
         RowBox[{"Flatten", "[", "$$$a", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "fa", "]"}], "\[Equal]", 
           RowBox[{"Length", "[", "$$$a", "]"}]}], ",", "fa", ",", "$$$a"}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cc", "[", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"$$$da", "=", 
        RowBox[{"ToString", "[", 
         RowBox[{"InputForm", "[", 
          RowBox[{"NotebookGet", "@", 
           RowBox[{"ClipboardNotebook", "[", "]"}]}], "]"}], "]"}]}], ",", 
       "ia", ",", "$$$a", ",", "$$$fa"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ia", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"StringPosition", "[", 
          RowBox[{"$$$da", ",", "\"\<\\\"\>\"", ",", "2"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"1", ";;", "2"}], ",", "1"}], "]"}], "]"}], "+", 
        RowBox[{"{", 
         RowBox[{"1", ",", 
          RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"$$$da", "=", 
       RowBox[{"StringTake", "[", 
        RowBox[{"$$$da", ",", "ia"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"$$$da", "=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"$$$da", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<\\\\t\>\"", "\[Rule]", "\"\<,\>\""}], ",", 
           RowBox[{"\"\< \>\"", "\[Rule]", "\"\<,\>\""}], ",", 
           RowBox[{"\"\<E\>\"", "\[Rule]", "\"\<*^\>\""}], ",", 
           RowBox[{"\"\<e\>\"", "\[Rule]", "\"\<*^\>\""}]}], "}"}]}], "]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"$$$da", "=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"$$$da", ",", 
         RowBox[{"\"\<\\\\n\>\"", "\[Rule]", "\"\<},{\>\""}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"$$$da", "=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"$$$da", ",", 
         RowBox[{"\"\<,}\>\"", "\[Rule]", "\"\<}\>\""}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"$$$da", "=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"$$$da", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<,,\>\"", "\[Rule]", "\"\<,\>\""}], ",", 
           RowBox[{"\"\<,,,\>\"", "\[Rule]", "\"\<,\>\""}]}], "}"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"$$$da", "=", 
       RowBox[{"\"\<{{\>\"", "<>", "$$$da", "<>", "\"\<}}\>\""}]}], ";", 
      RowBox[{"$$$a", "=", 
       RowBox[{"ToExpression", "[", "$$$da", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"$$$fa", "=", 
       RowBox[{"Flatten", "[", "$$$a", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "$$$fa", "]"}], "\[Equal]", 
         RowBox[{"Length", "[", "$$$a", "]"}]}], ",", "$$$fa", ",", "$$$a"}], 
       "]"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.79748050857253*^9, 3.7974806007568026`*^9}, {
   3.7974806866917176`*^9, 3.797480721404703*^9}, {3.7974809991515894`*^9, 
   3.797481039424893*^9}, {3.7974811544354715`*^9, 3.7974811721394835`*^9}, {
   3.7974812028342395`*^9, 3.797481374466056*^9}, {3.7974814116031804`*^9, 
   3.7974814221367826`*^9}, {3.7974814616160407`*^9, 3.797481501065297*^9}, {
   3.797481777759123*^9, 3.7974817866616325`*^9}, {3.7974818194185057`*^9, 
   3.797481854162493*^9}, {3.797481886135322*^9, 3.7974818898625355`*^9}, {
   3.797481937118238*^9, 3.797481965780877*^9}, {3.797482001211904*^9, 
   3.79748201355761*^9}, {3.797482058385174*^9, 3.7974820626584187`*^9}, {
   3.797482479369253*^9, 3.797482540425745*^9}, {3.797482646779828*^9, 
   3.7974827058002043`*^9}, {3.7974827425323052`*^9, 3.797482799242549*^9}, 
   3.7975054669650683`*^9, 3.7975055474276705`*^9, {3.797585937289954*^9, 
   3.7975859513499737`*^9}, {3.7975860242950783`*^9, 
   3.7975860306750875`*^9}, {3.797586084573163*^9, 3.797586102795189*^9}, {
   3.797586480910724*^9, 3.79758649246074*^9}, {3.7975866029418983`*^9, 
   3.7975866517969685`*^9}, {3.7975867249250765`*^9, 3.79758681890921*^9}, {
   3.7975868520432568`*^9, 3.797586855813262*^9}, {3.7975870089294868`*^9, 
   3.797587017709499*^9}, {3.797587074453579*^9, 3.7975871370596666`*^9}, {
   3.7975872050897646`*^9, 3.797587313265918*^9}, {3.7975873887320237`*^9, 
   3.797587521223213*^9}, {3.797587643599386*^9, 3.79758766024141*^9}, {
   3.7975877023924694`*^9, 3.7975877325345116`*^9}, {3.79758790404991*^9, 
   3.797587928724945*^9}, {3.797588064015136*^9, 3.797588066405139*^9}, {
   3.7975881447022543`*^9, 3.7975881539962673`*^9}},
 CellLabel->
  "In[187]:=",ExpressionUUID->"c30f8721-3d32-4eac-9642-48abbf85afad"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MyRegionDifference", "[", "x__", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"narg", ",", "x2", ",", 
       RowBox[{"x3", "=", 
        RowBox[{"List", "[", "x", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"narg", "=", 
       RowBox[{"Length", "[", "x3", "]"}]}], ";", 
      RowBox[{"x2", "=", 
       RowBox[{"x3", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"x2", "=", 
          RowBox[{"RegionDifference", "[", 
           RowBox[{"x2", ",", 
            RowBox[{"x3", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "2", ",", "narg"}], "}"}]}], "]"}], ";", 
      RowBox[{"Print", "[", 
       RowBox[{"RegionPlot", "[", "x2", "]"}], "]"}], ";", "x2"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7830596362766843`*^9, 3.783059647260312*^9}},
 CellLabel->
  "In[276]:=",ExpressionUUID->"82d03511-a52a-4ba4-ace3-242c94520a1b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshgrid", "[", 
     RowBox[{"x_List", ",", "y_List"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ConstantArray", "[", 
       RowBox[{"x", ",", 
        RowBox[{"Length", "[", "x", "]"}]}], "]"}], ",", 
      RowBox[{"Transpose", "@", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"y", ",", 
         RowBox[{"Length", "[", "y", "]"}]}], "]"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"xx", ",", "yy"}], "}"}], "=", 
     RowBox[{"meshgrid", "[", 
      RowBox[{
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"-", "2"}], ",", "2", ",", ".1"}], "]"}], ",", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"-", "4"}], ",", "4", ",", ".2"}], "]"}]}], "]"}]}], ";", 
    "\n", 
    RowBox[{"c", "=", 
     RowBox[{"xx", "*", 
      RowBox[{"Exp", "[", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"xx", "^", "2"}]}], "-", 
        RowBox[{"yy", "^", "2"}]}], "]"}]}]}], ";", "\n", 
    RowBox[{"pts", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"xx", ",", "yy", ",", "c"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}]}], "]"}]}], ";", "\n", 
    RowBox[{"ListPlot3D", "[", 
     RowBox[{"pts", ",", 
      RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
      RowBox[{"AxesLabel", "\[Rule]", "Automatic"}], ",", 
      RowBox[{"ImagePadding", "\[Rule]", "20"}], ",", 
      RowBox[{"Mesh", "\[Rule]", "35"}], ",", 
      RowBox[{"InterpolationOrder", "\[Rule]", "2"}], ",", 
      RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
      RowBox[{"Boxed", "\[Rule]", "False"}]}], "]"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyPlot", "[", 
    RowBox[{"coord_List", ",", "u_List", ",", "iu_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Nnode", "=", 
        RowBox[{"Length", "[", "coord", "]"}]}], ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"xyz", "=", 
        RowBox[{"{", "}"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"xyz", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"Nnode", ",", 
           RowBox[{"ndim", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"xyz", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "ndim"}]}], "]"}], "]"}], "=", "coord"}], ";", 
      RowBox[{
       RowBox[{"xyz", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", 
       RowBox[{"u", "[", 
        RowBox[{"[", 
         RowBox[{"iu", ";;", 
          RowBox[{"-", "1"}], ";;", "ndim"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ListPlot3D", "[", 
       RowBox[{"xyz", ",", 
        RowBox[{"Axes", "\[Rule]", "True"}], ",", 
        RowBox[{"AxesLabel", "\[Rule]", 
         RowBox[{"Table", "[", 
          RowBox[{"i", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "ndim"}], "}"}]}], "]"}]}]}], 
       "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyPlot", "[", 
    RowBox[{"coord_List", ",", "u_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Nnode", "=", 
        RowBox[{"Length", "[", "coord", "]"}]}], ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"xyz", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"uv", "=", 
        RowBox[{"{", 
         RowBox[{"\"\<u\>\"", ",", "\"\<v\>\"", ",", "\"\<w\>\""}], "}"}]}]}],
       "}"}], ",", 
     RowBox[{
      RowBox[{"xyz", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"Nnode", ",", 
           RowBox[{"ndim", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"xyz", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "ndim"}]}], "]"}], "]"}], "=", "coord"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "u", "]"}], "\[Equal]", "Nnode"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"xyz", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", "u"}], ";", 
         RowBox[{
          RowBox[{
           RowBox[{"CellPrint", "@", 
            RowBox[{"ExpressionCell", "[", 
             RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"ListPlot3D", "[", 
            RowBox[{"xyz", ",", 
             RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
             RowBox[{"Axes", "\[Rule]", "True"}], ",", 
             RowBox[{"AxesLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ",", 
             RowBox[{"PlotLabel", "\[Rule]", "\"\<u\>\""}], ",", " ", 
             RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
             RowBox[{"InterpolationOrder", "\[Rule]", "3"}], ",", 
             RowBox[{
             "ColorFunction", "\[Rule]", "\"\<SouthwestColors\>\""}]}], "]"}],
            "}"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"xyz", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", 
            RowBox[{"u", "[", 
             RowBox[{"[", 
              RowBox[{"iu", ";;", 
               RowBox[{"-", "1"}], ";;", "ndim"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"CellPrint", "@", 
              RowBox[{"ExpressionCell", "[", 
               RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{"ListPlot3D", "[", 
              RowBox[{"xyz", ",", 
               RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
               RowBox[{"Axes", "\[Rule]", "True"}], ",", 
               RowBox[{"AxesLabel", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ",", 
               RowBox[{"PlotLabel", "\[Rule]", 
                RowBox[{
                "uv", "\[LeftDoubleBracket]", "iu", 
                 "\[RightDoubleBracket]"}]}], ",", " ", 
               RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
               RowBox[{"InterpolationOrder", "\[Rule]", "3"}], ",", 
               RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
              "]"}], "}"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"iu", ",", "ndim"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDensityPlot", "[", 
    RowBox[{"coord_List", ",", "u_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Nnode", "=", 
        RowBox[{"Length", "[", "coord", "]"}]}], ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"xyz", "=", 
        RowBox[{"{", "}"}]}], ",", "r", ",", "r2"}], "}"}], ",", 
     RowBox[{
      RowBox[{"xyz", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"Nnode", ",", 
           RowBox[{"ndim", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"xyz", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "ndim"}]}], "]"}], "]"}], "=", "coord"}], ";", 
      RowBox[{"r", "=", 
       RowBox[{"ListRange", "[", "coord", "]"}]}], ";", 
      RowBox[{"r2", "=", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "-", 
        RowBox[{"r", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
      RowBox[{"r2", "=", 
       RowBox[{
        RowBox[{"r2", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "/", 
        RowBox[{"r2", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "u", "]"}], "\[Equal]", "Nnode"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"xyz", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", "u"}], ";", 
         RowBox[{
          RowBox[{
           RowBox[{"CellPrint", "@", 
            RowBox[{"ExpressionCell", "[", 
             RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"ListDensityPlot", "[", 
            RowBox[{"xyz", ",", 
             RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
             RowBox[{"AspectRatio", "\[Rule]", "r2"}], ",", " ", 
             RowBox[{"Axes", "\[Rule]", "True"}], ",", 
             RowBox[{"AxesLabel", "\[Rule]", 
              RowBox[{"Table", "[", 
               RowBox[{"i", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "ndim"}], "}"}]}], "]"}]}], ",", 
             RowBox[{"Mesh", "\[Rule]", "All"}], ",", 
             RowBox[{"InterpolationOrder", "\[Rule]", "3"}], ",", 
             RowBox[{
             "ColorFunction", "\[Rule]", "\"\<SouthwestColors\>\""}]}], "]"}],
            "}"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"xyz", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", 
            RowBox[{"u", "[", 
             RowBox[{"[", 
              RowBox[{"iu", ";;", 
               RowBox[{"-", "1"}], ";;", "ndim"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"CellPrint", "@", 
              RowBox[{"ExpressionCell", "[", 
               RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{"ListDensityPlot", "[", 
              RowBox[{"xyz", ",", 
               RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
               RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
               RowBox[{"AspectRatio", "\[Rule]", "r2"}], ",", " ", 
               RowBox[{"Axes", "\[Rule]", "True"}], ",", 
               RowBox[{"Mesh", "\[Rule]", "All"}], ",", 
               RowBox[{"AxesLabel", "\[Rule]", 
                RowBox[{"Table", "[", 
                 RowBox[{"i", ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "1", ",", "ndim"}], "}"}]}], "]"}]}], 
               ",", 
               RowBox[{"InterpolationOrder", "\[Rule]", "3"}], ",", 
               RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
              "]"}], "}"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"iu", ",", "ndim"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyPlotPoint", "[", 
    RowBox[{"coord_List", ",", "u_List", ",", 
     RowBox[{"plotRange_", ":", "Automatic"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Nnode", "=", 
        RowBox[{"Length", "[", "coord", "]"}]}], ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"xyz", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"uv", "=", 
        RowBox[{"{", 
         RowBox[{"\"\<u\>\"", ",", "\"\<v\>\"", ",", "\"\<w\>\""}], "}"}]}], 
       ",", "r", ",", "r2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "coord", "]"}], ">", 
         RowBox[{"Length", "[", "u", "]"}]}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Error,u is less than coord\>\"", "]"}], 
         ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
      RowBox[{"xyz", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"Nnode", ",", 
           RowBox[{"ndim", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"xyz", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "ndim"}]}], "]"}], "]"}], "=", "coord"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "u", "]"}], "\[Equal]", "Nnode"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"xyz", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", "u"}], ";", 
         RowBox[{
          RowBox[{
           RowBox[{"CellPrint", "@", 
            RowBox[{"ExpressionCell", "[", 
             RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"ListPointPlot3D", "[", 
            RowBox[{"xyz", ",", 
             RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", " ", 
             RowBox[{"Axes", "\[Rule]", "True"}], ",", 
             RowBox[{"AxesLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ",", 
             RowBox[{"PlotLabel", "\[Rule]", "\"\<u\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "plotRange"}], ",", " ", 
             RowBox[{
             "ColorFunction", "\[Rule]", "\"\<SouthwestColors\>\""}]}], "]"}],
            "}"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"xyz", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", 
            RowBox[{"u", "[", 
             RowBox[{"[", 
              RowBox[{"iu", ";;", 
               RowBox[{"-", "1"}], ";;", "ndim"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"CellPrint", "@", 
              RowBox[{"ExpressionCell", "[", 
               RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{"ListPointPlot3D", "[", 
              RowBox[{"xyz", ",", 
               RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
               RowBox[{"Axes", "\[Rule]", "True"}], ",", 
               RowBox[{"AxesLabel", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ",", 
               RowBox[{"PlotLabel", "\[Rule]", 
                RowBox[{
                "uv", "\[LeftDoubleBracket]", "iu", 
                 "\[RightDoubleBracket]"}]}], ",", " ", 
               RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
              "]"}], "}"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"iu", ",", "ndim"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyPlotPoint", "[", 
    RowBox[{"coord_List", ",", "u_List", ",", "pset_List", ",", 
     RowBox[{"plotRange_", ":", "Automatic"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Nnode", "=", 
        RowBox[{"Length", "[", "coord", "]"}]}], ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"xyz", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"uv", "=", 
        RowBox[{"{", 
         RowBox[{"\"\<u\>\"", ",", "\"\<v\>\"", ",", "\"\<w\>\""}], "}"}]}], 
       ",", "r", ",", "r2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "coord", "]"}], ">", 
         RowBox[{"Length", "[", "u", "]"}]}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Error,u is less than coord\>\"", "]"}], 
         ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
      RowBox[{"xyz", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"Nnode", ",", 
           RowBox[{"ndim", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"xyz", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "ndim"}]}], "]"}], "]"}], "=", "coord"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "u", "]"}], "\[Equal]", "Nnode"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"xyz", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", "u"}], ";", 
         RowBox[{
          RowBox[{
           RowBox[{"CellPrint", "@", 
            RowBox[{"ExpressionCell", "[", 
             RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"ListPointPlot3D", "[", 
            RowBox[{
             RowBox[{"xyz", "[", 
              RowBox[{"[", 
               RowBox[{"pset", ",", "All"}], "]"}], "]"}], ",", 
             RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", " ", 
             RowBox[{"Axes", "\[Rule]", "True"}], ",", 
             RowBox[{"AxesLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ",", 
             RowBox[{"PlotLabel", "\[Rule]", "\"\<u\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "plotRange"}], ",", " ", 
             RowBox[{
             "ColorFunction", "\[Rule]", "\"\<SouthwestColors\>\""}]}], "]"}],
            "}"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"xyz", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", 
            RowBox[{"u", "[", 
             RowBox[{"[", 
              RowBox[{"iu", ";;", 
               RowBox[{"-", "1"}], ";;", "ndim"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"CellPrint", "@", 
              RowBox[{"ExpressionCell", "[", 
               RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{"ListPointPlot3D", "[", 
              RowBox[{
               RowBox[{"xyz", "[", 
                RowBox[{"[", "pset", "]"}], "]"}], ",", 
               RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
               RowBox[{"Axes", "\[Rule]", "True"}], ",", 
               RowBox[{"AxesLabel", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ",", 
               RowBox[{"PlotLabel", "\[Rule]", 
                RowBox[{
                "uv", "\[LeftDoubleBracket]", "iu", 
                 "\[RightDoubleBracket]"}]}], ",", " ", 
               RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
              "]"}], "}"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"iu", ",", "ndim"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"L2Norm", "[", 
     RowBox[{"pvol_List", ",", "u_List", ",", "ut_List"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "u2", "}"}], ",", 
      RowBox[{
       RowBox[{"u2", "=", 
        RowBox[{"u", "-", "ut"}]}], ";", 
       RowBox[{"Sqrt", "[", 
        RowBox[{
         RowBox[{"WSquare", "[", 
          RowBox[{"u2", ",", "pvol"}], "]"}], "/", 
         RowBox[{"WSquare", "[", 
          RowBox[{"ut", ",", "pvol"}], "]"}]}], "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"L2Norm", "[", 
    RowBox[{"u_List", ",", "ut_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "u2", "}"}], ",", 
     RowBox[{
      RowBox[{"u2", "=", 
       RowBox[{"u", "-", "ut"}]}], ";", 
      RowBox[{"Sqrt", "[", 
       RowBox[{
        RowBox[{"WSquare", "[", "u2", "]"}], "/", 
        RowBox[{"WSquare", "[", "ut", "]"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WSquare", "[", "u_List", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", "s"}], "}"}], ",", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"u", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        "]"}]}], ";", 
      RowBox[{"s", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">", "0"}], ",", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
            "u", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], ".", 
            RowBox[{
            "u", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
           " ", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "u", "]"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"u", ".", "u"}]}], "]"}]}], ";", "s"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WSquare", "[", 
    RowBox[{"u_List", ",", "pvol_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", "s"}], "}"}], ",", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"u", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        "]"}]}], ";", 
      RowBox[{"s", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">", "0"}], ",", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
             "u", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], ".", 
             RowBox[{
             "u", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], "  ", 
            RowBox[{
            "pvol", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "u", "]"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
            "u", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
            RowBox[{
            "u", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "  ", 
            RowBox[{
            "pvol", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "u", "]"}]}], "}"}]}], "]"}]}], "]"}]}], 
      ";", "s"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CombineList", "[", 
    RowBox[{"x_List", ",", "y_List"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}], "\[Transpose]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CombineList", "[", 
    RowBox[{"x_List", ",", "y_List", ",", "z_List"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x", ",", "y", ",", "z"}], "}"}], "\[Transpose]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CombineList", "[", 
    RowBox[{"x_List", ",", "y_List", ",", "z_List", ",", "h_List"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x", ",", "y", ",", "z", ",", "h"}], "}"}], "\[Transpose]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ListRange", "[", "xy_List", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ndim", ",", "r"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xy", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
      RowBox[{"r", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "ndim"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"r", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "i"}], "]"}], "]"}], "=", 
          RowBox[{"Min", "[", 
           RowBox[{"xy", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"r", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "i"}], "]"}], "]"}], "=", 
          RowBox[{"Max", "[", 
           RowBox[{"xy", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", "r"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.761892732789674*^9, 3.7618927420695543`*^9}, {
  3.7618928824050407`*^9, 3.761892916372835*^9}, {3.763698275364834*^9, 
  3.7636983172762313`*^9}, {3.770556632895483*^9, 3.7705566555847807`*^9}, {
  3.7705567185243807`*^9, 3.7705567329832077`*^9}, {3.770558887543442*^9, 
  3.770558888795513*^9}, {3.77269545069656*^9, 3.77269551014896*^9}},
 CellLabel->
  "In[277]:=",ExpressionUUID->"8bf8b900-51cc-4c9e-98e1-49f3946e1aaf"],

Cell[BoxData[{
 RowBox[{"Needs", "[", "\"\<NDSolve`FEM`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MeshRangeXYZ", "[", "mm_ElementMesh", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ndim", ",", "nn", ",", "xyz"}], "}"}], ",", 
     RowBox[{
      RowBox[{"nn", "=", 
       RowBox[{"mm", "[", "\"\<Coordinates\>\"", "]"}]}], ";", 
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"nn", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
      RowBox[{"xyz", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "ndim"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"xyz", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "i"}], "]"}], "]"}], "=", 
          RowBox[{"Min", "[", 
           RowBox[{"nn", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"xyz", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "i"}], "]"}], "]"}], "=", 
          RowBox[{"Max", "[", 
           RowBox[{"nn", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", "xyz"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Round1", "[", 
    RowBox[{"x_", ",", 
     RowBox[{"n_", ":", "3"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "m", "}"}], ",", 
     RowBox[{
      RowBox[{"m", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"x", "\[Equal]", "0."}], ",", "0.", ",", 
         RowBox[{"Round", "[", 
          RowBox[{"Log10", "[", 
           RowBox[{"Abs", "[", "x", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"Round", "[", 
        RowBox[{"x", " ", 
         RowBox[{"10", "^", 
          RowBox[{"(", 
           RowBox[{"n", "-", "m"}], ")"}]}]}], "]"}], 
       RowBox[{"10.", "^", 
        RowBox[{"(", 
         RowBox[{"m", "-", "n"}], ")"}]}]}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContourLevel", "[", 
    RowBox[{"a_List", ",", 
     RowBox[{"nl_", ":", "5"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ia", "=", 
        RowBox[{"Round1", "[", 
         RowBox[{"0.98", 
          RowBox[{"Min", "[", "a", "]"}]}], "]"}]}], ",", 
       RowBox[{"xa", "=", 
        RowBox[{"Round1", "[", 
         RowBox[{"1.02", 
          RowBox[{"Max", "[", "a", "]"}]}], "]"}]}], ",", "xr", ",", "mm"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"xr", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"ia", ",", "xa", ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"xa", "-", "ia"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nl", "-", "1"}], ")"}]}]}], "]"}]}], ";", 
      RowBox[{"mm", "=", 
       RowBox[{
        RowBox[{"10.", "^", 
         RowBox[{"-", "6"}]}], "*", " ", 
        RowBox[{"Max", "[", 
         RowBox[{"Abs", "[", "xr", "]"}], "]"}]}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"xr", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{"Chop", "[", 
          RowBox[{
           RowBox[{"Round1", "[", 
            RowBox[{"xr", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", "mm"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "xr", "]"}]}], "}"}]}], "]"}], ";", "xr"}]}],
     "]"}]}], ";", 
  RowBox[{
   RowBox[{"Contour2DField", "[", 
    RowBox[{"sol_List", ",", "mesh_ElementMesh", ",", 
     RowBox[{"nint_", ":", "5"}], ",", 
     RowBox[{"cLabel_", ":", "True"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ufun", ",", "crange", ",", "smin", ",", "smax", ",", "x", ",", "y"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"ufun", "=", 
       RowBox[{"ElementMeshInterpolation", "[", 
        RowBox[{
         RowBox[{"{", "mesh", "}"}], ",", "sol"}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"smin", "=", 
         RowBox[{"Min", "[", "sol", "]"}]}], ";", 
        RowBox[{"smax", "=", 
         RowBox[{"Max", "[", "sol", "]"}]}], ";", 
        RowBox[{"crange", "=", 
         RowBox[{"Range", "[", 
          RowBox[{"smin", ",", "smax", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"smax", "-", "smin"}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{"nint", "-", "1"}], ")"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xxx", "=", "crange"}], ";"}], "*)"}], 
      RowBox[{"ContourPlot", "[", 
       RowBox[{
        RowBox[{"ufun", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "y"}], "}"}], "\[Element]", "mesh"}], ",", 
        RowBox[{"ColorFunction", "\[Rule]", "\"\<Temperature\>\""}], ",", 
        RowBox[{"AspectRatio", "\[Rule]", "Automatic"}], ",", 
        RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
        RowBox[{"ContourLabels", "\[Rule]", "cLabel"}], ",", 
        RowBox[{"Contours", "\[Rule]", "nint"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Contour3DField", "[", 
     RowBox[{"sol_List", ",", "mesh_ElementMesh", ",", 
      RowBox[{"opacity_", ":", "0.15"}], ",", 
      RowBox[{"nint_", ":", "5"}]}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"eufun", ",", 
        RowBox[{"xyzR", "=", 
         RowBox[{"MeshRangeXYZ", "[", "mesh", "]"}]}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"eufun", "=", 
        RowBox[{"ElementMeshInterpolation", "[", 
         RowBox[{
          RowBox[{"{", "mesh", "}"}], ",", "sol", ",", 
          RowBox[{"\"\<ExtrapolationHandler\>\"", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Function", "[", "Indeterminate", "]"}], ",", 
             RowBox[{"\"\<WarningMessage\>\"", "\[Rule]", "False"}]}], 
            "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"Graphics3D", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Opacity", "[", "opacity", "]"}], ",", 
            RowBox[{"EdgeForm", "[", "]"}], ",", 
            RowBox[{"ElementMeshToGraphicsComplex", "[", 
             RowBox[{"mesh", ",", "All", ",", 
              RowBox[{
              "\"\<MeshElement\>\"", "\[Rule]", 
               "\"\<BoundaryElements\>\""}]}], "]"}]}], "}"}], "]"}], ",", 
         RowBox[{"ContourPlot3D", "[", 
          RowBox[{
           RowBox[{"eufun", "[", 
            RowBox[{"x", ",", "y", ",", "z"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", 
             RowBox[{"xyzR", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"xyzR", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"y", ",", 
             RowBox[{"xyzR", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"xyzR", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"z", ",", 
             RowBox[{"xyzR", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "3"}], "]"}], "]"}], ",", 
             RowBox[{"xyzR", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
           RowBox[{"Axes", "\[Rule]", "None"}], ",", 
           RowBox[{"Contours", "\[Rule]", "nint"}]}], "]"}], ",", 
         RowBox[{"Boxed", "\[Rule]", "False"}]}], "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Slice3DField", "[", 
      RowBox[{"sol_List", ",", "mesh_ElementMesh"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "eufun", "}"}], ",", 
       RowBox[{
        RowBox[{"eufun", "=", 
         RowBox[{"ElementMeshInterpolation", "[", 
          RowBox[{
           RowBox[{"{", "mesh", "}"}], ",", "sol", ",", 
           RowBox[{"\"\<ExtrapolationHandler\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Function", "[", "Indeterminate", "]"}], ",", 
              RowBox[{"\"\<WarningMessage\>\"", "\[Rule]", "False"}]}], 
             "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Manipulate", "[", 
         RowBox[{
          RowBox[{"ContourPlot", "[", 
           RowBox[{
            RowBox[{"eufun", "[", 
             RowBox[{"x", ",", "y", ",", "z"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"y", ",", 
              RowBox[{"-", "12"}], ",", "12"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"z", ",", 
              RowBox[{"-", "11"}], ",", "0"}], "}"}], ",", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
            ",", 
            RowBox[{"Contours", "\[Rule]", 
             RowBox[{"Range", "[", 
              RowBox[{"0", ",", "1", ",", "0.2"}], "]"}]}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", "0"}], "}"}], ",", 
            RowBox[{"-", "12"}], ",", "12"}], "}"}], ",", 
          RowBox[{"SaveDefinitions", "\[Rule]", "True"}]}], "]"}]}]}], 
      "]"}]}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContourListField", "[", 
    RowBox[{"sol_List", ",", "coord_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data", ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"data", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Length", "[", "sol", "]"}], ",", 
           RowBox[{"ndim", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "ndim"}]}], "]"}], "]"}], "=", "coord"}], ";", 
      RowBox[{
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"-", "1"}]}], "]"}], "]"}], "=", "sol"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndim", "\[Equal]", "2"}], ",", 
        RowBox[{"ListContourPlot", "[", 
         RowBox[{"data", ",", 
          RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
          RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
          RowBox[{"PlotLegends", "\[Rule]", "Automatic"}]}], "]"}], ",", 
        RowBox[{"ListContourPlot3D", "[", 
         RowBox[{"data", ",", 
          RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
          RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
          RowBox[{"PlotLegends", "\[Rule]", "Automatic"}]}], "]"}]}], 
       "]"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.762586196689024*^9, 3.76258631375872*^9}, {
   3.762586440465967*^9, 3.7625865312891617`*^9}, {3.762587139450947*^9, 
   3.7625871402639933`*^9}, {3.7625871991873636`*^9, 
   3.7625872050416985`*^9}, {3.7625872947908316`*^9, 
   3.7625873118708086`*^9}, {3.7625878283553495`*^9, 
   3.7625878468964105`*^9}, {3.7625879063618116`*^9, 3.762587914989305*^9}, {
   3.7625884096926003`*^9, 3.7625884397783213`*^9}, {3.7625885609172497`*^9, 
   3.7625886035716896`*^9}, {3.762588696873026*^9, 3.7625889329945316`*^9}, {
   3.7625889773090663`*^9, 3.7625890193594713`*^9}, {3.762589260340255*^9, 
   3.7625893867334843`*^9}, {3.762589499501934*^9, 3.762589594248353*^9}, {
   3.7625896340266285`*^9, 3.762589638444881*^9}, {3.76258983774228*^9, 
   3.762589843827628*^9}, {3.7625899149476957`*^9, 3.762589919926981*^9}, {
   3.762590012734289*^9, 3.762590037439702*^9}, {3.762590133859217*^9, 
   3.762590134347245*^9}, 3.762590258584351*^9, {3.762590349331541*^9, 
   3.7625903638383713`*^9}, 3.762593050913063*^9, {3.7625998278541946`*^9, 
   3.762599850735503*^9}, {3.7626082184062614`*^9, 3.762608219516325*^9}, {
   3.7626087010778685`*^9, 3.7626087106294155`*^9}, {3.7626088557437153`*^9, 
   3.7626088725796785`*^9}, {3.7626093337840576`*^9, 3.76260934064845*^9}, {
   3.762611395887003*^9, 3.7626114387624555`*^9}, {3.7626116969582233`*^9, 
   3.762611701777499*^9}, {3.7626131145363045`*^9, 3.762613146875154*^9}, 
   3.7626133705469475`*^9, 3.762613944081752*^9, {3.7633076241913376`*^9, 
   3.763307638675166*^9}, 3.763363851238083*^9, {3.7789076984415073`*^9, 
   3.7789077000205975`*^9}, {3.9007551241237717`*^9, 
   3.900755126273508*^9}},ExpressionUUID->"d53ff229-8103-482f-81fe-\
65e66cf13b1d"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Contour3DField", ":=", 
   "\"\<Please refer \
https://reference.wolfram.com/language/FEMDocumentation/tutorial/\
FiniteElementProgramming.html\>\""}], "*)"}]], "Input",
 CellChangeTimes->{{3.7625869134710217`*^9, 3.762586954739382*^9}, 
   3.7625869958597336`*^9, 3.7625897003614225`*^9},
 CellLabel->
  "In[297]:=",ExpressionUUID->"7f432fc8-137b-4b21-b2e2-be14400381eb"],

Cell[CellGroupData[{

Cell["2D field plot functions;", "Item",
 CellChangeTimes->{{3.7537858911101*^9, 
  3.753785897957491*^9}},ExpressionUUID->"39aaa096-038c-4d3f-ac63-\
6c3949186219"],

Cell[BoxData[{
 RowBox[{"Needs", "[", "\"\<NDSolve`FEM`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Plot2DField", "[", 
     RowBox[{"vals_List", ",", "mesh_ElementMesh"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"vi", ",", "vm", ",", 
        RowBox[{"color", "=", "\"\<Rainbow\>\""}], ",", 
        RowBox[{"ntick", "=", "9"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"vm", ",", "vi"}], "}"}], "=", 
        RowBox[{"EffectiveRange", "[", 
         RowBox[{"vals", ",", "0.025"}], "]"}]}], ";", 
       RowBox[{"Legended", "[", 
        RowBox[{
         RowBox[{"Graphics", "[", 
          RowBox[{"ElementMeshToGraphicsComplex", "[", 
           RowBox[{"mesh", ",", 
            RowBox[{"VertexColors", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ColorData", "[", "color", "]"}], "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1.0", "/", 
                   RowBox[{"(", 
                    RowBox[{"vi", "-", "vm", "+", 
                    RowBox[{"10.", "^", 
                    RowBox[{"-", "20"}]}]}], ")"}]}], ")"}], 
                 RowBox[{"(", 
                  RowBox[{"vals", "-", "vm"}], ")"}]}], ")"}]}], ")"}]}]}], 
           "]"}], "]"}], ",", 
         RowBox[{"BarLegend", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"color", ",", 
             RowBox[{"{", 
              RowBox[{"vm", ",", "vi"}], "}"}]}], "}"}], ",", "ntick"}], 
          "]"}]}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Plot2DField", "[", 
      RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", "uvw_List", ",", 
       RowBox[{"color_", ":", "\"\<Rainbow\>\""}], ",", 
       RowBox[{"ntick_", ":", "10"}]}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "m2", "}"}], ",", 
       RowBox[{
        RowBox[{"m2", "=", 
         RowBox[{"ToElementMesh", "[", 
          RowBox[{
           RowBox[{"\"\<Coordinates\>\"", "\[Rule]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"mesh", "[", "\"\<Coordinates\>\"", "]"}], "+", "uvw"}],
              ")"}]}], ",", 
           RowBox[{"\"\<MeshElements\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"mesh", "[", "\"\<MeshElements\>\"", "]"}], ")"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Plot2DField", "[", 
         RowBox[{"vals", ",", "m2", ",", "color", ",", "ntick"}], "]"}]}]}], 
      "]"}]}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot2DField", "[", 
    RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", "uvw_List"}], "]"}], ":=", 
   RowBox[{"Plot2DField", "[", 
    RowBox[{"vals", ",", 
     RowBox[{"DeformMesh", "[", 
      RowBox[{"mesh", ",", "uvw"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DeformMesh", "[", 
    RowBox[{"mesh_ElementMesh", ",", "uvw_List"}], "]"}], ":=", 
   RowBox[{"ToElementMesh", "[", 
    RowBox[{
     RowBox[{"\"\<Coordinates\>\"", "\[Rule]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"mesh", "[", "\"\<Coordinates\>\"", "]"}], "+", "uvw"}], 
       ")"}]}], ",", 
     RowBox[{"\"\<MeshElements\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"mesh", "[", "\"\<MeshElements\>\"", "]"}], ")"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot2DField", "[", 
    RowBox[{"vals_List", ",", "mesh_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"Plot2DField", "[", 
      RowBox[{"vals", ",", 
       RowBox[{"MyDelaunayMesh", "[", "mesh", "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot2DField", "[", 
    RowBox[{"vals_List", ",", "mesh_List", ",", "uvw_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"Plot2DField", "[", 
      RowBox[{"vals", ",", 
       RowBox[{"MyDelaunayMesh", "[", 
        RowBox[{"mesh", ",", "uvw"}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.752728727492422*^9, 3.7527287680387416`*^9}, {
   3.752728938490491*^9, 3.7527291230200453`*^9}, {3.7527292230467663`*^9, 
   3.752729233264351*^9}, {3.7527293149710245`*^9, 3.7527293511640944`*^9}, {
   3.752729533513524*^9, 3.752729552357602*^9}, {3.7527296464099817`*^9, 
   3.7527297212562623`*^9}, {3.753694238971201*^9, 3.7536944021175327`*^9}, {
   3.7536944642000837`*^9, 3.7536944891335096`*^9}, {3.75369460173495*^9, 
   3.7536946057451797`*^9}, 3.7536950602241745`*^9, {3.7536951418018403`*^9, 
   3.753695222513457*^9}, {3.7536952610236597`*^9, 3.7536952758735085`*^9}, 
   3.753695344821452*^9, {3.753695397167446*^9, 3.7536954333225145`*^9}, {
   3.7536955488761234`*^9, 3.7536955707813764`*^9}, 3.753723090802516*^9, 
   3.7537231579033537`*^9, {3.753723237158887*^9, 3.753723248996564*^9}, {
   3.753724566284909*^9, 3.753724578038581*^9}, {3.7537248585716267`*^9, 
   3.753724861684805*^9}, {3.7537249709850564`*^9, 3.753724973655209*^9}, {
   3.7537252236975107`*^9, 3.7537252546402807`*^9}, {3.753725307558307*^9, 
   3.7537253811415157`*^9}, {3.75372546530933*^9, 3.753725471671694*^9}, {
   3.7537854381321907`*^9, 3.7537854499838686`*^9}, {3.7537857760475187`*^9, 
   3.753785777731615*^9}, {3.7583891676386547`*^9, 3.7583891729509587`*^9}, 
   3.796703961289152*^9, {3.797320549067576*^9, 3.797320559312162*^9}, {
   3.8027586420733476`*^9, 3.8027586543350487`*^9}, {3.80275871519753*^9, 
   3.802758716211588*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"1ad30bbf-db65-4bae-b16d-c67035b0446a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Plot2DField", "[", 
    RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", 
     RowBox[{"{", 
      RowBox[{"vm_", ",", "vi_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"color", "=", "\"\<Rainbow\>\""}], ",", 
       RowBox[{"ntick", "=", "9"}]}], "}"}], ",", 
     RowBox[{"Legended", "[", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"ElementMeshToGraphicsComplex", "[", 
         RowBox[{"mesh", ",", 
          RowBox[{"VertexColors", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ColorData", "[", "color", "]"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1.0", "/", 
                 RowBox[{"(", 
                  RowBox[{"vi", "-", "vm", "+", 
                   RowBox[{"10.", "^", 
                    RowBox[{"-", "20"}]}]}], ")"}]}], ")"}], 
               RowBox[{"(", 
                RowBox[{"vals", "-", "vm"}], ")"}]}], ")"}]}], ")"}]}]}], 
         "]"}], "]"}], ",", 
       RowBox[{"BarLegend", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"color", ",", 
           RowBox[{"{", 
            RowBox[{"vm", ",", "vi"}], "}"}]}], "}"}], ",", "ntick"}], 
        "]"}]}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot2DField", "[", 
    RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", "ntick_Integer", ",", 
     RowBox[{"tolRange_", ":", "0.001"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"vi", ",", "vm", ",", 
       RowBox[{"color", "=", "\"\<Rainbow\>\""}], ",", "nInc"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"vm", ",", "vi"}], "}"}], "=", 
       RowBox[{"EffectiveRange", "[", 
        RowBox[{"vals", ",", "tolRange"}], "]"}]}], ";", 
      RowBox[{"nInc", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"vi", "-", "vm", "+", 
          RowBox[{"10.", "^", 
           RowBox[{"-", "50"}]}]}], ")"}], "/", 
        RowBox[{"(", "ntick", ")"}]}]}], ";", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Graphics", "[", 
         RowBox[{"ElementMeshToGraphicsComplex", "[", 
          RowBox[{"mesh", ",", 
           RowBox[{"VertexColors", "\[Rule]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ColorData", "[", "color", "]"}], "/@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1.0", "/", 
                  RowBox[{"(", 
                   RowBox[{"vi", "-", "vm", "+", 
                    RowBox[{"10.", "^", 
                    RowBox[{"-", "50"}]}]}], ")"}]}], ")"}], 
                RowBox[{"(", 
                 RowBox[{"nInc", "*", 
                  RowBox[{"Round", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"vals", "-", "vm"}], ")"}], "/", "nInc"}], 
                   "]"}]}], ")"}]}], ")"}]}], ")"}]}]}], "]"}], "]"}], ",", 
        RowBox[{"BarLegend", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"color", ",", 
            RowBox[{"{", 
             RowBox[{"vm", ",", "vi"}], "}"}]}], "}"}], ",", 
          RowBox[{"Ticks", "\[Rule]", 
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"0", ",", "ntick"}], "]"}], "nInc"}], "+", "vm"}]}], 
          ",", 
          RowBox[{"LegendMarkerSize", "\[Rule]", "300"}]}], "]"}]}], 
       "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot2DField0", "[", 
    RowBox[{"vals_List", ",", "mesh_ElementMesh"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"color", "=", "\"\<Rainbow\>\""}], ",", 
       RowBox[{"ntick", "=", "9"}], ",", 
       RowBox[{"vm", "=", 
        RowBox[{"Min", "[", "vals", "]"}]}], ",", 
       RowBox[{"vi", "=", 
        RowBox[{"Max", "[", "vals", "]"}]}]}], "}"}], ",", 
     RowBox[{"Legended", "[", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"ElementMeshToGraphicsComplex", "[", 
         RowBox[{"mesh", ",", 
          RowBox[{"VertexColors", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ColorData", "[", "color", "]"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1.0", "/", 
                 RowBox[{"(", 
                  RowBox[{"vi", "-", "vm", "+", 
                   RowBox[{"10.", "^", 
                    RowBox[{"-", "20"}]}]}], ")"}]}], ")"}], 
               RowBox[{"(", 
                RowBox[{"vals", "-", "vm"}], ")"}]}], ")"}]}], ")"}]}]}], 
         "]"}], "]"}], ",", 
       RowBox[{"BarLegend", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"color", ",", 
           RowBox[{"{", 
            RowBox[{"vm", ",", "vi"}], "}"}]}], "}"}], ",", "ntick"}], 
        "]"}]}], "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.797317019129675*^9, 3.797317063357205*^9}, {
   3.8027587256151257`*^9, 3.802758758097984*^9}, {3.802758816113302*^9, 
   3.802758817895404*^9}, {3.813147849130043*^9, 3.8131478535212946`*^9}, {
   3.813147887384231*^9, 3.813147897949836*^9}, {3.8131480657444324`*^9, 
   3.8131481660801716`*^9}, 3.813148296615638*^9, {3.813148426950093*^9, 
   3.8131484680904455`*^9}, {3.8131488214846587`*^9, 
   3.8131488291750984`*^9}, {3.813149032924752*^9, 3.813149058665225*^9}, 
   3.813149170790638*^9, {3.8131492353493304`*^9, 3.8131492360563707`*^9}, {
   3.813149279717868*^9, 3.813149282684038*^9}, {3.813301956421686*^9, 
   3.8133019575624886`*^9}, {3.8133020360655804`*^9, 
   3.8133020433138475`*^9}, {3.813302119256543*^9, 3.8133021884259467`*^9}, {
   3.8133022435949697`*^9, 3.8133022452104197`*^9}, {3.8133022776128674`*^9, 
   3.8133022787360697`*^9}, {3.8133023721317525`*^9, 
   3.8133023736411705`*^9}, {3.8133028018245077`*^9, 
   3.8133028056701155`*^9}, {3.8133028365901856`*^9, 
   3.8133028535989575`*^9}, {3.81330288738536*^9, 3.81330289658963*^9}, {
   3.813302937826441*^9, 3.813303020010264*^9}, 3.813303319455662*^9, 
   3.813906200196001*^9},
 CellLabel->"In[19]:=",ExpressionUUID->"311d74ef-3168-4f10-baab-098d6d4561f0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"recover", " ", "data", " ", "from", " ", 
    RowBox[{"Plot2DField", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"ExtractPlot2DField", "[", "figData_", "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"rgbData", ",", "rangeData", ",", 
         RowBox[{"nn", "=", "500"}], ",", "xrgb", ",", "idList"}], "}"}], ",", 
       RowBox[{
        RowBox[{"rgbData", "=", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"FullForm", "[", "figData", "]"}], ",", 
           RowBox[{
            RowBox[{"RGBColor", "[", "data__", "]"}], "\[RuleDelayed]", 
            RowBox[{"{", "data", "}"}]}], ",", "Infinity"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rangeData", "=", 
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"FullForm", "[", "figData", "]"}], ",", 
            RowBox[{
             RowBox[{"BarLegend", "[", "x__", "]"}], "\[RuleDelayed]", "x"}], 
            ",", "Infinity"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xrgb", "=", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ColorData", "[", "\"\<Rainbow\>\"", "]"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"1", "/", "nn"}], " ", 
               RowBox[{"Range", "[", "nn", "]"}]}], ")"}]}], "//", 
            "FullForm"}], ",", 
           RowBox[{
            RowBox[{"RGBColor", "[", "data__", "]"}], "\[RuleDelayed]", 
            RowBox[{"{", "data", "}"}]}], ",", "Infinity"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"idList", "=", 
         RowBox[{
          RowBox[{"1", "/", "nn"}], "*", 
          RowBox[{"DistanceFromList", "[", 
           RowBox[{"rgbData", ",", "xrgb"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"idList", "*", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"rangeData", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", 
            RowBox[{"rangeData", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], "+", 
         RowBox[{"rangeData", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"{", 
        RowBox[{"rgbData", ",", "rangeData"}], "}"}], "*)"}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DistanceFromList", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"xL", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"id", "=", "0"}], ",", 
           RowBox[{"iv", "=", 
            RowBox[{"-", "1."}]}], ",", 
           RowBox[{"ivM", "=", 
            RowBox[{"10.", "^", "30"}]}]}], "}"}], ",", 
         RowBox[{
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"iv", "=", 
              RowBox[{"Norm", "[", 
               RowBox[{"x", "-", 
                RowBox[{"xL", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"iv", "<", "ivM"}], ",", 
               RowBox[{
                RowBox[{"id", "=", "i"}], ";", 
                RowBox[{"ivM", "=", "iv"}]}]}], "]"}], ";"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "xL", "]"}]}], "}"}]}], "]"}], ";", 
          "id"}]}], "]"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8139884843822594`*^9, 3.813988509008306*^9}, 
   3.813995629847203*^9},ExpressionUUID->"db6e76c5-0d14-43ab-8490-\
859b3d9ca1b6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EffectiveRange", "[", 
    RowBox[{"a_List", ",", 
     RowBox[{"tol_", ":", "0.025"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"st", ",", 
       RowBox[{"stl", "=", "1"}], ",", 
       RowBox[{"x1", "=", 
        RowBox[{
         RowBox[{"Length", "[", "a", "]"}], "tol"}]}], ",", 
       RowBox[{"i1", "=", "1"}], ",", 
       RowBox[{"i2", "=", "1"}], ",", 
       RowBox[{"s1", "=", "0"}]}], "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"tol", "\[Equal]", "0"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Round1", "[", 
             RowBox[{
              RowBox[{"Min", "[", "a", "]"}], ",", "4"}], "]"}], ",", 
            RowBox[{"Round1", "[", 
             RowBox[{
              RowBox[{"Max", "[", "a", "]"}], ",", "4"}], "]"}]}], "}"}], 
          "]"}]}], "]"}], ";"}], "*)"}], 
     RowBox[{
      RowBox[{"st", "=", 
       RowBox[{"N", "[", 
        RowBox[{"HistogramList", "[", "a", "]"}], "]"}]}], ";", 
      RowBox[{"stl", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"st", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"s1", "+=", 
          RowBox[{"st", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "i"}], "]"}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"s1", ">", "x1"}], ",", 
           RowBox[{
            RowBox[{"i1", "=", "i"}], ";", 
            RowBox[{"Break", "[", "]"}]}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "stl"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s1", "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"s1", "+=", 
          RowBox[{"st", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "i"}], "]"}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"s1", ">", "x1"}], ",", 
           RowBox[{
            RowBox[{"i2", "=", "i"}], ";", 
            RowBox[{"Break", "[", "]"}]}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "stl", ",", "1", ",", 
          RowBox[{"-", "1"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"st", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"i2", "+", "1"}]}], "}"}]}], "]"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7973219080483055`*^9, 3.7973219527328615`*^9}, {
   3.813303100889388*^9, 3.813303141619557*^9}, {3.8133032424544535`*^9, 
   3.813303255421986*^9}, {3.813303287690728*^9, 3.8133033111088877`*^9}, 
   3.8133896943158092`*^9},
 CellLabel->
  "In[116]:=",ExpressionUUID->"936e3ef6-695c-4e36-92ed-2549fe81c7b8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PlotField", "[", 
    RowBox[{"ndim_", ",", "vals_List", ",", "mesh_ElementMesh"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"MemberQ", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}], ",", "ndim"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ndim", "\[Equal]", "2"}], ",", 
       RowBox[{"Plot2DField", "[", 
        RowBox[{"vals", ",", "mesh"}], "]"}], ",", 
       RowBox[{"Plot3DField", "[", 
        RowBox[{"vals", ",", "mesh"}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.82318179155116*^9, 3.8231818996973457`*^9}, {
  3.8231819301410866`*^9, 3.823181949280182*^9}},
 CellLabel->
  "In[139]:=",ExpressionUUID->"f4fa9db1-3b4a-4d65-98b0-3f3a709625d5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"xPlot3DField", "[", 
    RowBox[{"vals_List", ",", "coord_List", ",", "x_", ",", "dx_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "ix", "}"}], ",", 
     RowBox[{
      RowBox[{"ix", "=", 
       RowBox[{"FindPointsC3", "[", 
        RowBox[{"coord", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "-", 
            RowBox[{"dx", "/", "2"}]}], ",", 
           RowBox[{"-", 
            RowBox[{"10.", "^", "10"}]}], ",", 
           RowBox[{"-", 
            RowBox[{"10.", "^", "10"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "+", 
            RowBox[{"dx", "/", "2"}]}], ",", 
           RowBox[{"10.", "^", "10"}], ",", 
           RowBox[{"10.", "^", "10"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"ix", "=", 
       RowBox[{"Flatten", "[", "ix", "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "ix", "]"}], "<", "3"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Too few points found\>\"", "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
      RowBox[{"Plot2DField", "[", 
       RowBox[{
        RowBox[{"vals", "[", 
         RowBox[{"[", "ix", "]"}], "]"}], ",", 
        RowBox[{"coord", "[", 
         RowBox[{"[", 
          RowBox[{"ix", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "]"}]}], "]"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"yPlot3DField", "[", 
    RowBox[{"vals_List", ",", "coord_List", ",", "x_", ",", "dx_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "ix", "}"}], ",", 
     RowBox[{
      RowBox[{"ix", "=", 
       RowBox[{"FindPointsC3", "[", 
        RowBox[{"coord", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"10.", "^", "10"}]}], ",", 
           RowBox[{"x", "-", 
            RowBox[{"dx", "/", "2"}]}], ",", 
           RowBox[{"-", 
            RowBox[{"10.", "^", "10"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"10.", "^", "10"}], ",", 
           RowBox[{"x", "+", 
            RowBox[{"dx", "/", "2"}]}], ",", 
           RowBox[{"10.", "^", "10"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"ix", "=", 
       RowBox[{"Flatten", "[", "ix", "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "ix", "]"}], "<", "3"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Too few points found\>\"", "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
      RowBox[{"Plot2DField", "[", 
       RowBox[{
        RowBox[{"vals", "[", 
         RowBox[{"[", "ix", "]"}], "]"}], ",", 
        RowBox[{"coord", "[", 
         RowBox[{"[", 
          RowBox[{"ix", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}]}], "]"}], "]"}]}], "]"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"zPlot3DField", "[", 
    RowBox[{"vals_List", ",", "coord_List", ",", "x_", ",", "dx_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "ix", "}"}], ",", 
     RowBox[{
      RowBox[{"ix", "=", 
       RowBox[{"FindPointsC3", "[", 
        RowBox[{"coord", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"10.", "^", "10"}]}], ",", 
           RowBox[{"-", 
            RowBox[{"10.", "^", "10"}]}], ",", 
           RowBox[{"x", "-", 
            RowBox[{"dx", "/", "2"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"10.", "^", "10"}], ",", 
           RowBox[{"10.", "^", "10"}], ",", 
           RowBox[{"x", "+", 
            RowBox[{"dx", "/", "2"}]}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"ix", "=", 
       RowBox[{"Flatten", "[", "ix", "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "ix", "]"}], "<", "3"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Too few points found\>\"", "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
      RowBox[{"Plot2DField", "[", 
       RowBox[{
        RowBox[{"vals", "[", 
         RowBox[{"[", "ix", "]"}], "]"}], ",", 
        RowBox[{"coord", "[", 
         RowBox[{"[", 
          RowBox[{"ix", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], "]"}]}]}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7923068078537035`*^9, 3.792306845332116*^9}, {
   3.7923068839699745`*^9, 3.7923069862304854`*^9}, {3.7923071084527082`*^9, 
   3.792307132703641*^9}, {3.792307165954157*^9, 3.792307371470041*^9}, {
   3.7923074610367994`*^9, 3.792307508784189*^9}, {3.7923076808556356`*^9, 
   3.7923077355716734`*^9}, 3.7967040063897314`*^9},
 CellLabel->
  "In[304]:=",ExpressionUUID->"eb664222-df08-448d-8f58-9445e6431beb"]
}, Open  ]],

Cell[CellGroupData[{

Cell["3D field plot functions;", "Item",
 CellChangeTimes->{{3.7517046309053206`*^9, 
  3.7517046378393426`*^9}},ExpressionUUID->"572c77ee-17c5-45c4-b817-\
4471d029ab12"],

Cell[BoxData[{
 RowBox[{"Needs", "[", "\"\<NDSolve`FEM`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot3DField", "[", 
    RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", 
     RowBox[{"ndim_", ":", "3"}], ",", 
     RowBox[{"nnode_", ":", "1"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "len", "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[NotEqual]", "3"}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", "\"\<Plot3DField Error, only for 3D mesh\>\"", "]"}], 
          ";", 
          RowBox[{"Return", "[", "]"}], ";"}]}], "]"}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "vals", "]"}], "\[NotEqual]", "nnode"}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Plot3DField Error, the number of nodes is not the same as the \
length of vals\>\"", "]"}], ";", 
          RowBox[{"Return", "[", "]"}]}]}], "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Legended", "[", 
      RowBox[{
       RowBox[{"ElementMeshSurfacePlot3D", "[", 
        RowBox[{"vals", ",", "mesh", ",", 
         RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"AxesLabel", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], "]"}], ",", 
       RowBox[{"BarLegend", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ColorFunction", "/.", 
            RowBox[{"Options", "[", "ElementMeshSurfacePlot3D", "]"}]}], "//",
            "First"}], ",", 
          RowBox[{"MinMax", "@", "vals"}]}], "}"}], "]"}]}], "]"}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot3DField", "[", 
    RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", "title_String"}], 
    "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "len", "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[NotEqual]", "3"}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", "\"\<Plot3DField Error, only for 3D mesh\>\"", "]"}], 
          ";", 
          RowBox[{"Return", "[", "]"}], ";"}]}], "]"}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "vals", "]"}], "\[NotEqual]", "nnode"}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Plot3DField Error, the number of nodes is not the same as the \
length of vals\>\"", "]"}], ";", 
          RowBox[{"Return", "[", "]"}]}]}], "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Legended", "[", 
      RowBox[{
       RowBox[{"ElementMeshSurfacePlot3D", "[", 
        RowBox[{"vals", ",", "mesh", ",", 
         RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"AxesLabel", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", "title"}]}], "]"}], ",", 
       RowBox[{"BarLegend", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ColorFunction", "/.", 
            RowBox[{"Options", "[", "ElementMeshSurfacePlot3D", "]"}]}], "//",
            "First"}], ",", 
          RowBox[{"MinMax", "@", "vals"}]}], "}"}], "]"}]}], "]"}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot3DField", "[", 
    RowBox[{"vals_List", ",", "mesh_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"Plot3DField", "[", 
      RowBox[{"vals", ",", 
       RowBox[{"MyDelaunayMesh", "[", "mesh", "]"}], ",", 
       RowBox[{"Length", "[", 
        RowBox[{"mesh", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
       RowBox[{"Length", "[", "mesh", "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot3DField", "[", 
    RowBox[{"vals_List", ",", "mesh_List", ",", "uvw_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"Plot3DField", "[", 
      RowBox[{"vals", ",", 
       RowBox[{"MyDelaunayMesh", "[", 
        RowBox[{"mesh", ",", "uvw"}], "]"}], ",", 
       RowBox[{"Length", "[", 
        RowBox[{"mesh", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
       RowBox[{"Length", "[", "mesh", "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Plot3DField", "[", 
     RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", "uvw_List", ",", 
      RowBox[{"color_", ":", "\"\<Rainbow\>\""}], ",", 
      RowBox[{"ntick_", ":", "9"}]}], "]"}], ":=", 
    RowBox[{"Plot3DField", "[", 
     RowBox[{"vals", ",", 
      RowBox[{
       RowBox[{"Print", "[", "12", "]"}], ";", 
       RowBox[{"DeformMesh", "[", 
        RowBox[{"mesh", ",", "uvw"}], "]"}]}], ",", "3", ",", 
      RowBox[{"Length", "[", "vals", "]"}]}], "]"}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "m2", "}"}], ",", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"m2", "=", 
         RowBox[{"ToElementMesh", "[", 
          RowBox[{
           RowBox[{"\"\<Coordinates\>\"", "\[Rule]", 
            RowBox[{
             RowBox[{"mesh", "[", "\"\<Coordinates\>\"", "]"}], "+", 
             "uvw"}]}], ",", 
           RowBox[{"\"\<MeshElements\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"mesh", "[", "\"\<MeshElements\>\"", "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}]}]}], "]"}]}], ";"}], 
       "*)"}], 
      RowBox[{"Plot3DField", "[", 
       RowBox[{"vals", ",", 
        RowBox[{"DeformMesh", "[", 
         RowBox[{"mesh", ",", "uvw"}], "]"}], ",", "3", ",", 
        RowBox[{"Length", "[", "vals", "]"}]}], "]"}]}], "]"}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ParseAbaqusFile", "::", "usage"}], "=", 
   "\"\<{nodes,elements,sets}=ParseAbaqusFile[FilePath];it can only read \
keywords: *node, *element, *set. Before processing the file, please convert \
the *elset to *set or *nset to *set in the input file\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ParseAbaqusFile", "[", "file_String", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "i", ",", "j", ",", "k", ",", "node", ",", "element", ",", "setList", 
       ",", "oneSet", ",", "starList", ",", "starLine", ",", "tlineStart", 
       ",", "tlineEnd", ",", "tline", ",", "strings", ",", "String2List", ",",
        " ", "i1", ",", "i2", ",", "len", ",", "pair", ",", "ei", ",", "j1"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FileExtension", "[", "file", "]"}], "\[NotEqual]", 
         "\"\<inp\>\""}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Error,the file should be Abaqus keyword file .inp\>\"", "]"}], 
         ";", 
         RowBox[{"Return", "[", "]"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"strings", "=", 
       RowBox[{"ReadList", "[", 
        RowBox[{"file", ",", "String"}], "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"strings", "\[Equal]", "$Failed"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Error,file not found\>\"", "]"}], ";", 
         RowBox[{"Return", "[", "]"}]}]}], "]"}], ";", 
      RowBox[{"i", "=", 
       RowBox[{
        RowBox[{"Dimensions", "[", "strings", "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", 
      RowBox[{"node", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"element", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"setList", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"starList", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"StringStartsQ", "[", 
            RowBox[{
             RowBox[{"strings", "[", 
              RowBox[{"[", "j", "]"}], "]"}], ",", "\"\<*\>\""}], "]"}], "&&", 
           RowBox[{"!", 
            RowBox[{"StringStartsQ", "[", 
             RowBox[{
              RowBox[{"strings", "[", 
               RowBox[{"[", "j", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"\"\<**\>\"", ",", "\"\<$\>\""}], "}"}]}], "]"}]}]}], 
          ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"starList", ",", "j"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "i"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"String2List", "[", "str_String", "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"sl", ",", "s2"}], "}"}], ",", 
         RowBox[{
          RowBox[{"s2", "=", 
           RowBox[{"StringReplace", "[", 
            RowBox[{"str", ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<E\>\"", ",", "\"\<e\>\""}], "}"}], "\[Rule]", 
              "\"\<*^\>\""}]}], "]"}]}], ";", 
          RowBox[{"sl", "=", 
           RowBox[{"StringSplit", "[", 
            RowBox[{"s2", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<,\>\"", ",", "\"\< \>\""}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"ToExpression", "[", "sl", "]"}], ",", "Null"}], 
           "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"starLine", "=", 
          RowBox[{"ToLowerCase", "[", 
           RowBox[{"strings", "[", 
            RowBox[{"[", 
             RowBox[{"starList", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tlineStart", "=", 
          RowBox[{
           RowBox[{"starList", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "+", "1"}]}], ";", 
         RowBox[{"tlineEnd", "=", 
          RowBox[{
           RowBox[{"starList", "[", 
            RowBox[{"[", 
             RowBox[{"j", "+", "1"}], "]"}], "]"}], "-", "1"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Which", "[", 
          RowBox[{
           RowBox[{"StringStartsQ", "[", 
            RowBox[{"starLine", ",", "\"\<*node\>\""}], "]"}], ",", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"tline", "=", 
               RowBox[{"strings", "[", 
                RowBox[{"[", "k", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"!", 
                 RowBox[{"StringStartsQ", "[", 
                  RowBox[{"tline", ",", "\"\<*\>\""}], "]"}]}], ",", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"node", ",", 
                  RowBox[{"String2List", "[", "tline", "]"}]}], "]"}]}], 
               "]"}], ";"}], ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "tlineStart", ",", "tlineEnd"}], "}"}]}], 
            "]"}], 
           RowBox[{"(*", "*)"}], ",", 
           RowBox[{"StringStartsQ", "[", 
            RowBox[{"starLine", ",", "\"\<*element\>\""}], "]"}], ",", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"tline", "=", 
               RowBox[{"strings", "[", 
                RowBox[{"[", "k", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"!", 
                 RowBox[{"StringStartsQ", "[", 
                  RowBox[{"tline", ",", "\"\<*\>\""}], "]"}]}], ",", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"element", ",", 
                  RowBox[{"String2List", "[", "tline", "]"}]}], "]"}]}], 
               "]"}], ";"}], ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "tlineStart", ",", "tlineEnd"}], "}"}]}], 
            "]"}], 
           RowBox[{"(*", "*)"}], ",", 
           RowBox[{"StringStartsQ", "[", 
            RowBox[{"starLine", ",", "\"\<*set\>\""}], "]"}], ",", 
           RowBox[{
            RowBox[{"oneSet", "=", 
             RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"tline", "=", 
                RowBox[{"strings", "[", 
                 RowBox[{"[", "k", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"!", 
                  RowBox[{"StringStartsQ", "[", 
                   RowBox[{"tline", ",", "\"\<*\>\""}], "]"}]}], ",", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"oneSet", ",", 
                   RowBox[{"String2List", "[", "tline", "]"}]}], "]"}]}], 
                "]"}], ";"}], ",", 
              RowBox[{"{", 
               RowBox[{"k", ",", "tlineStart", ",", "tlineEnd"}], "}"}]}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"setList", ",", 
              RowBox[{"Flatten", "[", "oneSet", "]"}]}], "]"}]}]}], 
          RowBox[{"(*", "*)"}], "]"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{
           RowBox[{"Length", "[", "starList", "]"}], "-", "1"}]}], "}"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "node", "]"}]}], ";", 
      RowBox[{"i1", "=", 
       RowBox[{"node", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
      RowBox[{"i2", "=", 
       RowBox[{"node", "[", 
        RowBox[{"[", 
         RowBox[{"len", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"i1", "\[Equal]", "1"}], " ", "&&", " ", 
         RowBox[{"i2", "\[Equal]", "len"}]}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"node", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", 
              RowBox[{"2", ";;", 
               RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", 
           RowBox[{"element", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", 
              RowBox[{"2", ";;", 
               RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", "setList"}], "}"}], 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"pair", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", "i2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"pair", "[", 
          RowBox[{"[", 
           RowBox[{"node", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "=", "i"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "element", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ei", "=", 
          RowBox[{"element", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"j1", "=", 
             RowBox[{"ei", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], ";", 
            RowBox[{
             RowBox[{"ei", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "=", 
             RowBox[{"pair", "[", 
              RowBox[{"[", "j1", "]"}], "]"}]}], ";"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "2", ",", 
             RowBox[{"Length", "[", "ei", "]"}]}], "}"}]}], "]"}], ";", 
         RowBox[{
          RowBox[{"element", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", "ei"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"node", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"2", ";;", 
            RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", 
        RowBox[{"element", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"2", ";;", 
            RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", "setList"}], "}"}]}]}],
     "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ParseAbaqusFile", "[", "file_String", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "j", ",", "node", ",", "element", ",", "setList", ",", "oneSet", ",", 
        RowBox[{"starList", "=", 
         RowBox[{"{", "}"}]}], ",", "starLine", ",", "tlineStart", ",", 
        "tlineEnd", ",", "tline", ",", "strings", ",", "String2List", ",", 
        "i1", ",", "i2", ",", "len", ",", "pair", ",", "ei", ",", "j1", ",", 
        RowBox[{"nodeRange", "=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"eleRange", "=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"setRange", "=", 
         RowBox[{"{", "}"}]}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"FileExtension", "[", "file", "]"}], "\[NotEqual]", 
          "\"\<inp\>\""}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Error,the file should be Abaqus keyword file .inp\>\"", "]"}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", "]"}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"strings", "=", 
        RowBox[{"ReadList", "[", 
         RowBox[{"file", ",", "String"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"strings", "\[Equal]", "$Failed"}], ",", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<Error,file not found\>\"", "]"}], ";", 
          RowBox[{"Return", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"StringStartsQ", "[", 
            RowBox[{
             RowBox[{"strings", "[", 
              RowBox[{"[", "j", "]"}], "]"}], ",", "\"\<*\>\""}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"starList", ",", "j"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", 
           RowBox[{"Length", "[", "strings", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"starList", ",", 
         RowBox[{"Length", "[", "strings", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"j", "=", 
           RowBox[{"starList", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", 
          RowBox[{"tline", "=", 
           RowBox[{"ToLowerCase", "[", 
            RowBox[{"strings", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"StringStartsQ", "[", 
             RowBox[{"tline", ",", "\"\<*node\>\""}], "]"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"nodeRange", ",", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"j", "+", "1"}], ",", 
                RowBox[{
                 RowBox[{"starList", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "-", "1"}]}], 
               "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"StringStartsQ", "[", 
             RowBox[{"tline", ",", "\"\<*element\>\""}], "]"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"eleRange", ",", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"j", "+", "1"}], ",", 
                RowBox[{
                 RowBox[{"starList", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "-", "1"}]}], 
               "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"StringStartsQ", "[", 
             RowBox[{"tline", ",", "\"\<*set\>\""}], "]"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"setRange", ",", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"j", "+", "1"}], ",", 
                RowBox[{
                 RowBox[{"starList", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "-", "1"}]}], 
               "]"}]}], "]"}]}], "]"}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{
            RowBox[{"Length", "[", "starList", "]"}], "-", "1"}]}], "}"}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"nodeRange", "=", 
        RowBox[{"Flatten", "[", "nodeRange", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"setRange", "=", 
        RowBox[{"Flatten", "[", "setRange", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"eleRange", "=", 
        RowBox[{"Flatten", "[", "eleRange", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"String2List", "[", "str_String", "]"}], ":=", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"sl", ",", "s2"}], "}"}], ",", 
          RowBox[{
           RowBox[{"s2", "=", 
            RowBox[{"StringReplace", "[", 
             RowBox[{"str", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\"\<E\>\"", ",", "\"\<e\>\""}], "}"}], "\[Rule]", 
               "\"\<*^\>\""}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"sl", "=", 
            RowBox[{"StringSplit", "[", 
             RowBox[{"s2", ",", 
              RowBox[{"{", 
               RowBox[{"\"\<,\>\"", ",", "\"\< \>\""}], "}"}]}], "]"}]}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"DeleteCases", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", "sl", "]"}], ",", "Null"}], 
            "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"SetAttributes", "[", 
        RowBox[{"String2List", ",", "Listable"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"node", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "nodeRange", "]"}], "<", "100000"}], ",", 
          RowBox[{"String2List", "[", 
           RowBox[{"strings", "[", 
            RowBox[{"[", "nodeRange", "]"}], "]"}], "]"}], ",", 
          RowBox[{"ParallelTable", "[", 
           RowBox[{
            RowBox[{"String2List", "[", 
             RowBox[{"strings", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "nodeRange"}], "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"element", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "eleRange", "]"}], "<", "100000"}], ",", 
          RowBox[{"String2List", "[", 
           RowBox[{"strings", "[", 
            RowBox[{"[", "eleRange", "]"}], "]"}], "]"}], ",", 
          RowBox[{"ParallelTable", "[", 
           RowBox[{
            RowBox[{"String2List", "[", 
             RowBox[{"strings", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "eleRange"}], "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"setList", "=", 
        RowBox[{"String2List", "[", 
         RowBox[{"strings", "[", 
          RowBox[{"[", "setRange", "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"len", "=", 
        RowBox[{"Length", "[", "node", "]"}]}], ";", 
       RowBox[{"i1", "=", 
        RowBox[{"node", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
       RowBox[{"i2", "=", 
        RowBox[{"node", "[", 
         RowBox[{"[", 
          RowBox[{"len", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"i1", "\[Equal]", "1"}], "&&", 
          RowBox[{"i2", "\[Equal]", "len"}]}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"node", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"2", ";;", 
                RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", 
            RowBox[{"element", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"2", ";;", 
                RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", "setList"}], "}"}],
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"pair", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "i2"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"pair", "[", 
           RowBox[{"[", 
            RowBox[{"node", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "=", "i"}],
          ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"len", "=", 
        RowBox[{"Length", "[", "element", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ei", "=", 
           RowBox[{"element", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"j1", "=", 
              RowBox[{"ei", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{"ei", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", 
              RowBox[{"pair", "[", 
               RowBox[{"[", "j1", "]"}], "]"}]}], ";"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "2", ",", 
              RowBox[{"Length", "[", "ei", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"element", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", "ei"}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"node", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"2", ";;", 
             RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", 
         RowBox[{"element", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"2", ";;", 
             RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", "setList"}], 
        "}"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AreaOf2DElement", "[", 
    RowBox[{"nodes_List", ",", "elements_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ndim", ",", "nnode", ",", "ve"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"nodes", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
      RowBox[{"nnode", "=", 
       RowBox[{"Length", "[", "elements", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndim", "\[Equal]", "2"}], ",", 
        RowBox[{"ve", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Area", "[", 
            RowBox[{"Polygon", "[", 
             RowBox[{"nodes", "[", 
              RowBox[{"[", 
               RowBox[{"elements", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "nnode"}], "}"}]}], "]"}]}], ",", 
        RowBox[{
        "Print", "[", "\"\<Error, only 2D elements are allowed\>\"", "]"}]}], 
       "]"}], ";", "ve"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Area2Nodes", "[", 
     RowBox[{"nodes_List", ",", "elements_List"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ve", ",", "ne", ",", "ei"}], "}"}], ",", 
      RowBox[{
       RowBox[{"ve", "=", 
        RowBox[{"AreaOf2DElement", "[", 
         RowBox[{"nodes", ",", "elements"}], "]"}]}], ";", 
       RowBox[{"ne", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Length", "[", "nodes", "]"}]}], "]"}]}], ";", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ei", "=", 
           RowBox[{"elements", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", 
          RowBox[{
           RowBox[{"ne", "[", 
            RowBox[{"[", "ei", "]"}], "]"}], "+=", 
           RowBox[{
            RowBox[{"ve", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "/", 
            RowBox[{"Length", "[", "ei", "]"}]}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "elements", "]"}]}], "}"}]}], "]"}], ";", 
       "ne"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ElementClassifyEc", "[", 
    RowBox[{"len_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"n", "\[Equal]", "2"}], ",", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"len", "\[Equal]", "3"}], " ", "||", " ", 
        RowBox[{"len", "\[Equal]", "6"}]}], ",", "1", ",", "2"}], "]"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"len", "\[Equal]", "4"}], "||", 
        RowBox[{"len", "\[Equal]", "10"}]}], ",", "3", ",", "4"}], "]"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ElementClassify", "[", 
     RowBox[{"mesh_", ",", "ndim_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pos", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"Length", "[", "mesh", "]"}]}], "]"}]}], ",", 
        RowBox[{"toqh", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}]}], "}"}]}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"pos", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"ElementClassifyEc", "[", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"mesh", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", "ndim"}], "]"}]}], 
          ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "mesh", "]"}]}], "}"}]}], "]"}], ";", 
       RowBox[{
        RowBox[{"toqh", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"pos", ",", "1"}], "]"}], "]"}]}], ";", 
       RowBox[{
        RowBox[{"toqh", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"pos", ",", "2"}], "]"}], "]"}]}], ";", 
       RowBox[{
        RowBox[{"toqh", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"pos", ",", "3"}], "]"}], "]"}]}], ";", 
       RowBox[{
        RowBox[{"toqh", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"pos", ",", "4"}], "]"}], "]"}]}], ";", "toqh"}]}], "]"}]}],
    ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Abaqus2Mesh", "[", 
      RowBox[{"coord_", ",", "mesh_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ec", ",", 
         RowBox[{"el", "=", 
          RowBox[{"{", "}"}]}]}], "}"}], ",", 
       RowBox[{
        RowBox[{"ec", "=", 
         RowBox[{"ElementClassify", "[", 
          RowBox[{"mesh", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"ec", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], ">", "0"}], ",", 
          RowBox[{"el", "=", 
           RowBox[{
           "el", "<>", "\"\<TriangleElement[mesh[[ec[[1]]]]],\>\""}]}]}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"ec", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], ">", "0"}], ",", 
          RowBox[{"el", "=", 
           RowBox[{"el", "<>", "\"\<QuadElement[mesh[[ec[[2]]]]],\>\""}]}]}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"ec", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "]"}], ">", "0"}], ",", 
          RowBox[{"el", "=", 
           RowBox[{
           "el", "<>", "\"\<TetrahedronElement[mesh[[ec[[3]]]]],\>\""}]}]}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"ec", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "]"}], ">", "0"}], ",", 
          RowBox[{"el", "=", 
           RowBox[{
           "el", "<>", "\"\<HexahedronElement[mesh[[ec[[4]]]]],\>\""}]}]}], 
         "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "mesh", " ", "is", " ", "not", " ", "recognized", " ", "as", " ", 
           "mesh_"}], ",", " ", 
          RowBox[{"but", " ", "as", " ", "external", " ", 
           RowBox[{"variables", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"el", "=", 
         RowBox[{"\"\<{\>\"", "<>", 
          RowBox[{"StringDrop", "[", 
           RowBox[{"el", ",", 
            RowBox[{"-", "1"}]}], "]"}], "<>", "\"\<}\>\""}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", "el", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ToElementMesh", "[", 
         RowBox[{
          RowBox[{"\"\<Coordinates\>\"", "\[Rule]", "coord"}], ",", 
          RowBox[{"\"\<MeshElements\>\"", "\[Rule]", 
           RowBox[{"ToExpression", "[", "el", "]"}]}]}], "]"}]}]}], "]"}]}], 
    ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Abaqus2Mesh", "[", 
     RowBox[{"coord_", ",", "mesh_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ec", ",", 
        RowBox[{"el", "=", 
         RowBox[{"{", "}"}]}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"ec", "=", 
        RowBox[{"ElementClassify", "[", 
         RowBox[{"mesh", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"coord", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"ec", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], ">", "0"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"el", ",", 
           RowBox[{"TriangleElement", "[", 
            RowBox[{"mesh", "[", 
             RowBox[{"[", 
              RowBox[{"ec", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}]}], "]"}]}],
         "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"ec", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], ">", "0"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"el", ",", 
           RowBox[{"QuadElement", "[", 
            RowBox[{"mesh", "[", 
             RowBox[{"[", 
              RowBox[{"ec", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}]}], "]"}]}],
         "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"ec", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], ">", "0"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"el", ",", 
           RowBox[{"TetrahedronElement", "[", 
            RowBox[{"mesh", "[", 
             RowBox[{"[", 
              RowBox[{"ec", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "]"}]}], "]"}]}],
         "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"ec", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}], ">", "0"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"el", ",", 
           RowBox[{"HexahedronElement", "[", 
            RowBox[{"mesh", "[", 
             RowBox[{"[", 
              RowBox[{"ec", "[", 
               RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], "]"}]}], "]"}]}],
         "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ToElementMesh", "[", 
        RowBox[{
         RowBox[{"\"\<Coordinates\>\"", "\[Rule]", "coord"}], ",", 
         RowBox[{"\"\<MeshElements\>\"", "\[Rule]", "el"}]}], "]"}]}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ShowMesh", "[", 
    RowBox[{"m_", ",", 
     RowBox[{"withLable_", ":", "False"}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{"withLable", ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"\"\<Wireframe\>\"", "[", 
         RowBox[{"\"\<MeshElementIDStyle\>\"", "\[Rule]", "Black"}], "]"}], 
        "]"}], ",", 
       RowBox[{"m", "[", 
        RowBox[{"\"\<Wireframe\>\"", "[", 
         RowBox[{
          RowBox[{"\"\<MeshElement\>\"", "\[Rule]", "\"\<PointElements\>\""}],
           ",", 
          RowBox[{"\"\<MeshElementIDStyle\>\"", "\[Rule]", "Red"}]}], "]"}], 
        "]"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{"m", "[", "\"\<Wireframe\>\"", "]"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"My3DpointPlot", "[", 
    RowBox[{"coord_", ",", "f_", ",", 
     RowBox[{"size_", ":", "10"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ri", "=", 
        RowBox[{"Min", "[", "f", "]"}]}], ",", 
       RowBox[{"rx", "=", 
        RowBox[{"Max", "[", "f", "]"}]}], ",", "data"}], "}"}], ",", 
     RowBox[{
      RowBox[{"data", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"coord", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"coord", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
          RowBox[{"coord", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", "f"}], "}"}], 
        "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Graphics3D", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"AbsolutePointSize", "[", "size", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Blend", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Blue", ",", "Red"}], "}"}], ",", 
               RowBox[{"Rescale", "[", 
                RowBox[{
                 RowBox[{"Last", "[", "#", "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"ri", ",", "rx"}], "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Point", "[", 
              RowBox[{"Most", "[", "#", "]"}], "]"}]}], "}"}], "&"}], "/@", 
          "data"}]}], "}"}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"data2", "=", 
     RowBox[{"GridNdim", "[", 
      RowBox[{"10", ",", "3"}], "]"}]}], ";", 
    RowBox[{"My3DpointPlot", "[", 
     RowBox[{"data2", ",", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"10", ",", 
        RowBox[{"Length", "[", "data2", "]"}]}], "]"}]}], "]"}]}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7517046847033453`*^9, 3.7517048530543337`*^9}, {
   3.751705219142398*^9, 3.751705389655447*^9}, {3.7517193725223236`*^9, 
   3.751719406846287*^9}, {3.7517198534108286`*^9, 3.7517198631733875`*^9}, {
   3.751720245228239*^9, 3.7517202522096386`*^9}, 3.7517204006221275`*^9, {
   3.7517207542603545`*^9, 3.75172075435736*^9}, 3.7517207966277776`*^9, 
   3.7517210963699217`*^9, {3.7517211341220813`*^9, 3.7517212527928686`*^9}, {
   3.751721291011055*^9, 3.75172135333562*^9}, {3.7517213861054935`*^9, 
   3.7517213912447877`*^9}, {3.751721478735792*^9, 3.7517215038692293`*^9}, {
   3.751783128151791*^9, 3.751783166031958*^9}, {3.75178320785635*^9, 
   3.751783265385641*^9}, {3.7517833253960733`*^9, 3.7517833993643036`*^9}, {
   3.751783614226593*^9, 3.7517836155086665`*^9}, {3.7517838526732316`*^9, 
   3.7517838530492535`*^9}, {3.751784066869483*^9, 3.7517840673575106`*^9}, {
   3.751784126052868*^9, 3.751784126387887*^9}, {3.751784634519835*^9, 
   3.751784637780241*^9}, {3.7517871199617405`*^9, 3.751787190521776*^9}, {
   3.7517879120910482`*^9, 3.7517879275219307`*^9}, {3.7517879828870974`*^9, 
   3.751787985596252*^9}, {3.751788034040023*^9, 3.751788051837041*^9}, {
   3.7517881095143394`*^9, 3.7517881208869905`*^9}, {3.7517884845857925`*^9, 
   3.7517884850228176`*^9}, {3.75231583068314*^9, 3.7523159406654882`*^9}, {
   3.7523159966751575`*^9, 3.752316000015131*^9}, {3.7523163350913787`*^9, 
   3.752316356969529*^9}, {3.7525798763550153`*^9, 3.7525799258083677`*^9}, {
   3.7525799960698028`*^9, 3.7525800154519787`*^9}, {3.7527298802113543`*^9, 
   3.752729983718274*^9}, {3.7558821068111334`*^9, 3.7558821076721826`*^9}, {
   3.7575131566040473`*^9, 3.757513240139825*^9}, {3.7575133312020335`*^9, 
   3.757513331465049*^9}, 3.7576960624572372`*^9, {3.7589716563509293`*^9, 
   3.758971671486795*^9}, {3.7628751701225367`*^9, 3.7628751755688486`*^9}, {
   3.762875493135012*^9, 3.762875551330341*^9}, {3.7707838712672544`*^9, 
   3.7707839238442616`*^9}, {3.772170018717564*^9, 3.7721701104938135`*^9}, {
   3.772170304312899*^9, 3.7721703978242474`*^9}, {3.7721704453759675`*^9, 
   3.77217045555855*^9}, {3.7808310585579977`*^9, 3.780831059162634*^9}, {
   3.796704031938193*^9, 3.79670403241322*^9}, {3.8059744106338563`*^9, 
   3.8059744155933228`*^9}, {3.805974591339997*^9, 3.805974602264266*^9}, 
   3.8059746397876153`*^9},ExpressionUUID->"455eddb4-95b6-4914-9c7f-\
c2011fe8cd2a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Quad2Triangle", "[", 
     RowBox[{"coord_List", ",", "ele_List"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ele2", "=", 
         RowBox[{"{", "}"}]}], ",", "ei", ",", "x1", ",", "d1", ",", "d2"}], 
       "}"}], ",", 
      RowBox[{
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ei", "=", 
           RowBox[{"ele", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "ei", "]"}], "\[NotEqual]", "4"}], ",", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"ele2", ",", "ei"}], "]"}], ";", 
             RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
          RowBox[{"x1", "=", 
           RowBox[{"coord", "[", 
            RowBox[{"[", "ei", "]"}], "]"}]}], ";", 
          RowBox[{"d1", "=", 
           RowBox[{
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "//", "N"}]}], ";", 
          RowBox[{"d2", "=", 
           RowBox[{
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{"x1", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "-", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}], "]"}], "//", "N"}]}], ";", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"d1", "\[GreaterEqual]", "d2"}], ",", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"ele2", ",", 
               RowBox[{"ei", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "2", ",", "4"}], "}"}], "]"}], "]"}]}], 
              "]"}], ";", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"ele2", ",", 
               RowBox[{"ei", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"2", ",", "3", ",", "4"}], "}"}], "]"}], "]"}]}], 
              "]"}], ";"}], ",", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"ele2", ",", 
               RowBox[{"ei", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "2", ",", "3"}], "}"}], "]"}], "]"}]}], 
              "]"}], ";", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"ele2", ",", 
               RowBox[{"ei", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "3", ",", "4"}], "}"}], "]"}], "]"}]}], 
              "]"}]}]}], "]"}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}], ";", 
       "ele2"}]}], "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.7626221669219265`*^9, 3.762622370369563*^9}, {
  3.762622433000146*^9, 3.7626226716217937`*^9}},
 CellLabel->
  "In[322]:=",ExpressionUUID->"362d68e5-35ee-4cb0-8e52-a2988714d983"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "SimplexMeshCheckQuality", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SimplexMeshCheckQuality", "[", 
    RowBox[{"coord_", ",", "ele_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"ne", "=", 
        RowBox[{"Length", "[", "ele", "]"}]}], ",", "xy", ",", "vl", ",", 
       "ei", ",", 
       RowBox[{"vm", "=", "0."}], ",", "ige"}], "}"}], ",", 
     RowBox[{
      RowBox[{"vl", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", "ne", "}"}]}], "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndim", "\[Equal]", "2"}], ",", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ei", "=", 
            RowBox[{"ele", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", 
           RowBox[{"xy", "=", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "ei", "]"}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"vl", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"AreaOfTriangle", "[", "xy", "]"}]}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "ne"}], "}"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndim", "\[Equal]", "3"}], ",", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ei", "=", 
            RowBox[{"ele", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", 
           RowBox[{"xy", "=", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "ei", "]"}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"vl", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"VolumeOfTet", "[", "xy", "]"}]}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "ne"}], "}"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"vm", "=", 
       RowBox[{
        RowBox[{"10", "^", 
         RowBox[{"-", "3"}]}], " ", 
        RowBox[{"Mean", "[", "vl", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ige", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Position", "[", 
         RowBox[{"vl", ",", 
          RowBox[{"_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", ">", "vm"}], "&"}], ")"}]}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "ige", "]"}], "<", "ne"}], ",", 
        RowBox[{"Print", "[", 
         RowBox[{
          RowBox[{"ne", "-", 
           RowBox[{"Length", "[", "ige", "]"}]}], ",", 
          "\"\< bad elements were detected and deleted!\>\""}], "]"}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", "\"\<All elements are in good condition\>\"", "]"}], 
         ";", 
         RowBox[{"ige", "=", 
          RowBox[{"{", 
           RowBox[{"-", "1"}], "}"}]}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "ige"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SimplexMeshCheckQualityFail", "[", 
    RowBox[{"coord_", ",", "ele_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"ne", "=", 
        RowBox[{"Length", "[", "ele", "]"}]}], ",", "xy", ",", "vl", ",", 
       "ei", ",", 
       RowBox[{"vm", "=", "0."}], ",", "ige"}], "}"}], ",", 
     RowBox[{
      RowBox[{"vl", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", "ne", "}"}]}], "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndim", "\[Equal]", "2"}], ",", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ei", "=", 
            RowBox[{"ele", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", 
           RowBox[{"xy", "=", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "ei", "]"}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"vl", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"AreaOfTriangle", "[", "xy", "]"}]}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "ne"}], "}"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndim", "\[Equal]", "3"}], ",", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ei", "=", 
            RowBox[{"ele", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", 
           RowBox[{"xy", "=", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "ei", "]"}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"vl", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"VolumeOfTet", "[", "xy", "]"}]}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "ne"}], "}"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"vm", "=", 
       RowBox[{
        RowBox[{"10", "^", 
         RowBox[{"-", "3"}]}], " ", 
        RowBox[{"Mean", "[", "vl", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ige", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Position", "[", 
         RowBox[{"vl", ",", 
          RowBox[{"_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "<", "vm"}], "&"}], ")"}]}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "ige"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{
  3.798022836337837*^9, {3.798023098173122*^9, 3.7980231139122267`*^9}, 
   3.7980233848144903`*^9, 3.798023477503483*^9, {3.798024389811033*^9, 
   3.7980243899010324`*^9}, {3.7980244729769983`*^9, 3.798024488579323*^9}, {
   3.798024618699971*^9, 3.7980246200929785`*^9}, {3.798024686092248*^9, 
   3.798024691617287*^9}},ExpressionUUID->"8fc51a60-a259-4f12-9e19-\
39c255bbdfe3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "MyDelaunayMesh", "]"}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"coord", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1.293", ",", "0.228"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1.", ",", "0."}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.94", ",", "0.342"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1.293", ",", "0."}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1.215", ",", "0.442"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2.", ",", "0."}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1.879", ",", "0.684"}], "}"}]}], "}"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"mesh", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "4", ",", "6"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "5", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "6", ",", "7", ",", "5"}], "}"}]}], "}"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"m", "=", 
     RowBox[{"Abaqus2Mesh", "[", 
      RowBox[{"coord", ",", "mesh"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"m", "[", 
       RowBox[{"\"\<Wireframe\>\"", "[", 
        RowBox[{"\"\<MeshElementIDStyle\>\"", "\[Rule]", "Black"}], "]"}], 
       "]"}], ",", 
      RowBox[{"m", "[", 
       RowBox[{"\"\<Wireframe\>\"", "[", 
        RowBox[{
         RowBox[{"\"\<MeshElement\>\"", "\[Rule]", "\"\<PointElements\>\""}], 
         ",", 
         RowBox[{"\"\<MeshElementIDStyle\>\"", "\[Rule]", "Red"}]}], "]"}], 
       "]"}]}], "]"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDelaunayMesh", "[", "coord_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mm", ",", "mm2", ",", "ndim", ",", "ige"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ndim", "<", "2"}], " ", "||", " ", 
         RowBox[{"ndim", ">", "3"}]}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Error, delaunayMesh only applies for 2D and 3D\>\"", "]"}], 
         ";", 
         RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mm", "=", 
       RowBox[{"DelaunayMesh", "[", "coord", "]"}]}], ";", 
      RowBox[{"mm2", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[Equal]", "2"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "2"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Polygon", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], ",", 
           RowBox[{"-", "1"}]}], "]"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "3"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Tetrahedron", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], 
           ",", 
           RowBox[{"-", "1"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ige", "=", 
       RowBox[{"SimplexMeshCheckQuality", "[", 
        RowBox[{"coord", ",", "mm2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ige", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[NotEqual]", 
         RowBox[{"-", "1"}]}], ",", 
        RowBox[{"mm2", "=", 
         RowBox[{"mm2", "[", 
          RowBox[{"[", "ige", "]"}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Abaqus2Mesh", "[", 
       RowBox[{"coord", ",", "mm2"}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDelaunayMeshRemoveCube", "[", 
    RowBox[{"coord_", ",", "xmin_", ",", "xmax_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mm", ",", "mm2", ",", "ndim", ",", "ige"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ndim", "<", "2"}], " ", "||", " ", 
         RowBox[{"ndim", ">", "3"}]}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Error, delaunayMesh only applies for 2D and 3D\>\"", "]"}], 
         ";", 
         RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mm", "=", 
       RowBox[{"DelaunayMesh", "[", "coord", "]"}]}], ";", 
      RowBox[{"mm2", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[Equal]", "2"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "2"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Polygon", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], ",", 
           RowBox[{"-", "1"}]}], "]"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "3"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Tetrahedron", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], 
           ",", 
           RowBox[{"-", "1"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ige", "=", 
       RowBox[{"SimplexMeshCheckQuality", "[", 
        RowBox[{"coord", ",", "mm2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ige", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[NotEqual]", 
         RowBox[{"-", "1"}]}], ",", 
        RowBox[{"mm2", "=", 
         RowBox[{"mm2", "[", 
          RowBox[{"[", "ige", "]"}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mm2", "=", 
       RowBox[{"mm2", "[", 
        RowBox[{"[", 
         RowBox[{"ComplementOrder", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "mm2", "]"}], "]"}], ",", 
           RowBox[{"FindElement", "[", 
            RowBox[{"coord", ",", "mm2", ",", "xmin", ",", "xmax"}], "]"}]}], 
          "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Abaqus2Mesh", "[", 
       RowBox[{"coord", ",", "mm2"}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDelaunayMeshRemoveCircle", "[", 
    RowBox[{"coord_", ",", "fun_", ",", "dist_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mm", ",", "mm2", ",", "ndim", ",", "ige"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ndim", "<", "2"}], " ", "||", " ", 
         RowBox[{"ndim", ">", "3"}]}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Error, delaunayMesh only applies for 2D and 3D\>\"", "]"}], 
         ";", 
         RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mm", "=", 
       RowBox[{"DelaunayMesh", "[", "coord", "]"}]}], ";", 
      RowBox[{"mm2", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[Equal]", "2"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "2"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Polygon", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], ",", 
           RowBox[{"-", "1"}]}], "]"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "3"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Tetrahedron", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], 
           ",", 
           RowBox[{"-", "1"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ige", "=", 
       RowBox[{"SimplexMeshCheckQuality", "[", 
        RowBox[{"coord", ",", "mm2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ige", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[NotEqual]", 
         RowBox[{"-", "1"}]}], ",", 
        RowBox[{"mm2", "=", 
         RowBox[{"mm2", "[", 
          RowBox[{"[", "ige", "]"}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mm2", "=", 
       RowBox[{"mm2", "[", 
        RowBox[{"[", 
         RowBox[{"ComplementOrder", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "mm2", "]"}], "]"}], ",", 
           RowBox[{"FindElementByCircle", "[", 
            RowBox[{"coord", ",", "mm2", ",", "fun", ",", "dist"}], "]"}]}], 
          "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Abaqus2Mesh", "[", 
       RowBox[{"coord", ",", "mm2"}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindElement", "[", 
    RowBox[{"coord_", ",", "mm2_", ",", "xmin_", ",", "xmax_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mi", ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"le", "=", 
        RowBox[{"Length", "[", "mm2", "]"}]}], ",", "xc", ",", "ie"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"xc", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", "le", "}"}], ",", 
         RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"mi", "=", 
          RowBox[{"mm2", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"xc", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "mi", "]"}], "]"}], "]"}], "/", 
           RowBox[{"Length", "[", "mi", "]"}]}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "le"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"FindPoints", "[", 
       RowBox[{"xc", ",", "xmin", ",", "xmax"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindElementByCircle", "[", 
    RowBox[{"coord_", ",", "mm2_", ",", "fun_", ",", "r_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mi", ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"le", "=", 
        RowBox[{"Length", "[", "mm2", "]"}]}], ",", "xc", ",", "ie"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"xc", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", "le", "}"}], ",", 
         RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"mi", "=", 
          RowBox[{"mm2", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"xc", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "mi", "]"}], "]"}], "]"}], "/", 
           RowBox[{"Length", "[", "mi", "]"}]}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "le"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ie", "=", 
       RowBox[{"FindPoints", "[", 
        RowBox[{"xc", ",", "fun", ",", "r"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "ie"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDelaunayMesh", "[", 
    RowBox[{"coord_", ",", "uvw_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mm", ",", "mm2", ",", "ndim"}], "}"}], ",", 
     RowBox[{
      RowBox[{"mm", "=", 
       RowBox[{"DelaunayMesh", "[", "coord", "]"}]}], ";", 
      RowBox[{"mm2", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[Equal]", "2"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "2"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Polygon", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], ",", 
           RowBox[{"-", "1"}]}], "]"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "3"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Tetrahedron", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], 
           ",", 
           RowBox[{"-", "1"}]}], "]"}]}], "]"}]}], ";", 
      RowBox[{"Abaqus2Mesh", "[", 
       RowBox[{
        RowBox[{"coord", "+", "uvw"}], ",", "mm2"}], "]"}]}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.751723878581055*^9, 3.7517239180083103`*^9}, {
   3.7517240344859724`*^9, 3.7517240386012077`*^9}, {3.75178143950527*^9, 
   3.7517814429840765`*^9}, {3.751783908300413*^9, 3.751783915168806*^9}, {
   3.751786909320693*^9, 3.7517870281564894`*^9}, {3.7525799295143623`*^9, 
   3.752579954923564*^9}, {3.7536875924658256`*^9, 3.753687593183427*^9}, {
   3.753687645755519*^9, 3.753687773301343*^9}, {3.753687853826275*^9, 
   3.753687863804846*^9}, {3.753687934991917*^9, 3.7536879599493446`*^9}, 
   3.7536885039321756`*^9, 3.7537893102536635`*^9, {3.7789923311617527`*^9, 
   3.7789923318087893`*^9}, {3.7848702338577595`*^9, 3.784870277511256*^9}, {
   3.7848703153274193`*^9, 3.784870329750244*^9}, {3.7848703647612467`*^9, 
   3.784870677581139*^9}, {3.7848711670611353`*^9, 3.7848714195535774`*^9}, {
   3.7980228124357047`*^9, 3.798022970054969*^9}, {3.798023006868639*^9, 
   3.798023007397648*^9}, {3.7980238155934258`*^9, 3.7980238189884853`*^9}, {
   3.7980246291960034`*^9, 3.798024643705061*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"e2a0f909-ed00-43dd-9290-7f6903a7f5db"],

Cell[BoxData[{
 RowBox[{"Needs", "[", "\"\<NDSolve`FEM`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Region2NOM", "[", 
    RowBox[{"region_", ",", 
     RowBox[{"hSize_", ":", "1"}], ",", 
     RowBox[{"printMesh_", ":", "0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"m1", ",", "ele", ",", "coord", ",", "nodeVolume"}], "}"}], ",", 
     RowBox[{
      RowBox[{"m1", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"$VersionNumber", "<", "10.1"}], " ", "&&", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "region", "]"}], "\[Equal]", "Cuboid"}], 
            " ", "||", " ", 
            RowBox[{
             RowBox[{"Head", "[", "region", "]"}], "\[Equal]", 
             "Rectangle"}]}], ")"}]}], ",", 
         RowBox[{"ToElementMesh2", "[", 
          RowBox[{"region", ",", "hSize"}], "]"}], ",", 
         RowBox[{"ToElementMesh", "[", 
          RowBox[{"region", ",", 
           RowBox[{"\"\<MeshOrder\>\"", "\[Rule]", "1"}], ",", 
           RowBox[{"\"\<MaxCellMeasure\>\"", "\[Rule]", "hSize"}]}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ele", "=", 
       RowBox[{
        RowBox[{"m1", "[", "\"\<MeshElements\>\"", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"coord", "=", 
       RowBox[{"m1", "[", "\"\<Coordinates\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nodeVolume", "=", 
       RowBox[{"ElementArea", "[", 
        RowBox[{"coord", ",", "ele"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"printMesh", "\[NotEqual]", "0"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"CellPrint", "@", 
           RowBox[{"ExpressionCell", "[", 
            RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"m1", "[", "\"\<Wireframe\>\"", "]"}], "}"}]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"coord", ",", "nodeVolume", ",", "ele", ",", "m1"}], "}"}]}]}],
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ElementArea", "[", 
    RowBox[{"coord_List", ",", "ele_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"nn", ",", "len", ",", "ndim", ",", "v1", ",", "vn"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{
        "coord", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        "]"}]}], ";", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "ele", "]"}]}], ";", 
      RowBox[{"nn", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"ele", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
         "]"}]}], ";", 
      RowBox[{"vn", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Length", "[", "coord", "]"}]}], "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"nn", "\[Equal]", 
         RowBox[{"(", 
          RowBox[{"ndim", "+", "1"}], ")"}]}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Simplex element\>\"", "]"}], ";", 
         RowBox[{"v1", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"SimplexVolume", "[", 
             RowBox[{"coord", "\[LeftDoubleBracket]", 
              RowBox[{
              "ele", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "\[RightDoubleBracket]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Quad element\>\"", "]"}], ";", 
         RowBox[{"v1", "=", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"CubeVolume", "[", 
             RowBox[{"coord", "\[LeftDoubleBracket]", 
              RowBox[{
              "ele", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "\[RightDoubleBracket]"}], "]"}], ",", 
            RowBox[{"Length", "[", "ele", "]"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"vn", "[", 
          RowBox[{"[", 
           RowBox[{
           "ele", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
           "]"}], "]"}], "+=", 
         RowBox[{
          RowBox[{
          "v1", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "/", 
          "nn"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "vn"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SimplexVolume", "[", "coord_List", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", 
       RowBox[{"v1", "=", 
        RowBox[{"{", "}"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "[", "coord", "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"v1", ",", 
          RowBox[{
           RowBox[{"coord", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "-", 
           RowBox[{"coord", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "2", ",", "n"}], "}"}]}], "]"}], ";", 
      RowBox[{
       RowBox[{"Abs", "[", 
        RowBox[{"Det", "[", 
         RowBox[{"v1", "//", "N"}], "]"}], "]"}], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "1"}], ")"}], "!"}], ")"}]}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CubeVolume", "[", "coord_List", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ndim", ",", 
       RowBox[{"s", "=", "0"}], ",", "s1"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{
        "coord", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"s1", "=", 
          RowBox[{"Abs", "[", 
           RowBox[{"Times", "@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
              "coord", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
               "-", 
              RowBox[{
              "coord", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"s1", ">", "s"}], ",", 
           RowBox[{"s", "=", "s1"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "2", ",", 
          RowBox[{"Length", "[", "coord", "]"}]}], "}"}]}], "]"}], ";", 
      "s"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"listProduct", "[", "x_List", "]"}], ":=", 
    RowBox[{"Times", "@@", "x"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VolumeOfH1", "[", "coord_List", "]"}], ":=", 
   RowBox[{"Total", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"VolumeOfTet", "[", 
       RowBox[{"coord", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "4", ",", "5"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "3", ",", "4", ",", "7"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"5", ",", "2", ",", "7", ",", "6"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"5", ",", "7", ",", "4", ",", "8"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "4", ",", "5", ",", "7"}], "}"}]}], "}"}]}], 
       "}"}]}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ElementAreaAbaqus", "[", 
    RowBox[{"coord_List", ",", "ele_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"nn", ",", "len", ",", "ndim", ",", "v1", ",", "vn"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{
        "coord", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        "]"}]}], ";", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "ele", "]"}]}], ";", 
      RowBox[{"nn", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"ele", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
         "]"}]}], ";", 
      RowBox[{"vn", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Length", "[", "coord", "]"}]}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"nn", "\[Equal]", 
           RowBox[{"(", 
            RowBox[{"ndim", "+", "1"}], ")"}]}], ",", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<Simplex element\>\"", "]"}], ";", 
           RowBox[{"v1", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"SimplexVolume", "[", 
               RowBox[{"coord", "\[LeftDoubleBracket]", 
                RowBox[{
                "ele", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                 "\[RightDoubleBracket]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}]}]}], 
          ",", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<Quad element\>\"", "]"}], ";", 
           RowBox[{"v1", "=", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"CubeVolume", "[", 
               RowBox[{"coord", "\[LeftDoubleBracket]", 
                RowBox[{
                "ele", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                 "\[RightDoubleBracket]"}], "]"}], ",", 
              RowBox[{"Length", "[", "ele", "]"}]}], "]"}]}]}]}], "]"}], 
        ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ndim", "==", "2"}], " ", "&&", " ", 
         RowBox[{"nn", "==", "3"}]}], ",", 
        RowBox[{"v1", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"AreaOfTriangle", "[", 
            RowBox[{"coord", "[", 
             RowBox[{"[", 
              RowBox[{"ele", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}]}]}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ndim", "==", "2"}], " ", "&&", " ", 
         RowBox[{"nn", "==", "4"}]}], ",", " ", 
        RowBox[{"v1", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"AreaOfQuad", "[", 
            RowBox[{"coord", "[", 
             RowBox[{"[", 
              RowBox[{"ele", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}]}]}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ndim", "==", "3"}], " ", "&&", " ", 
         RowBox[{"nn", "==", "4"}]}], ",", 
        RowBox[{"v1", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"VolumeOfTet", "[", 
            RowBox[{"coord", "[", 
             RowBox[{"[", 
              RowBox[{"ele", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}]}]}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ndim", "==", "3"}], " ", "&&", " ", 
         RowBox[{"nn", "==", "8"}]}], ",", " ", 
        RowBox[{"v1", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"VolumeOfH1", "[", 
            RowBox[{"coord", "[", 
             RowBox[{"[", 
              RowBox[{"ele", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}]}]}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"vn", "[", 
          RowBox[{"[", 
           RowBox[{
           "ele", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
           "]"}], "]"}], "+=", 
         RowBox[{
          RowBox[{
          "v1", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "/", 
          "nn"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "vn"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{
  3.7483422226094365`*^9, 3.7483422750155115`*^9, {3.748342341007612*^9, 
   3.7483423747326612`*^9}, {3.7483424131697187`*^9, 
   3.7483424171987247`*^9}, {3.7483448403845415`*^9, 
   3.7483448838576174`*^9}, {3.748344982830779*^9, 3.7483451105030165`*^9}, {
   3.7483451788881273`*^9, 3.7483453351803837`*^9}, {3.7483455759138517`*^9, 
   3.7483456113329115`*^9}, {3.7483456554569855`*^9, 
   3.7483458037162313`*^9}, {3.7483459025094576`*^9, 3.748345907914467*^9}, {
   3.7483461052103605`*^9, 3.7483461349484105`*^9}, {3.7483462147891097`*^9, 
   3.7483462469781704`*^9}, {3.748346429247491*^9, 3.748346429557492*^9}, {
   3.7483465883121023`*^9, 3.748346713540327*^9}, {3.748346826201527*^9, 
   3.748347263356292*^9}, 3.7483473012263584`*^9, {3.7483475760138507`*^9, 
   3.748347595062882*^9}, {3.748347628600946*^9, 3.748347628670946*^9}, {
   3.748347662433004*^9, 3.748347693375057*^9}, {3.748348456971387*^9, 
   3.748348457764389*^9}, {3.748349277746875*^9, 3.7483492896818943`*^9}, {
   3.7483495364983463`*^9, 3.748349539389352*^9}, {3.7483495956234474`*^9, 
   3.748349599542454*^9}, {3.7483496552265477`*^9, 3.7483496557465487`*^9}, {
   3.748349726004672*^9, 3.7483497669777403`*^9}, {3.7483499491460495`*^9, 
   3.7483499494460497`*^9}, {3.7483554065618935`*^9, 3.748355411054701*^9}, 
   3.7517839033711314`*^9, {3.7537869908259997`*^9, 3.7537869921370745`*^9}, {
   3.7664809668401957`*^9, 3.7664809759517174`*^9}, {3.867913879924542*^9, 
   3.8679139574605613`*^9}, {3.867914335637006*^9, 3.8679143470090847`*^9}, {
   3.8679150588623505`*^9, 3.8679152604448967`*^9}, 3.8679155288212442`*^9},
 CellLabel->
  "In[289]:=",ExpressionUUID->"bf75def9-d273-4c01-8ba5-bcf5eb9952f2"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8679143961043262`*^9, 3.867914417921978*^9}, {
   3.8679146112509446`*^9, 3.867914675913541*^9}, {3.867914709249008*^9, 
   3.867914709828594*^9}, {3.8679147637220592`*^9, 3.867914763912096*^9}, 
   3.867914842287882*^9, {3.8679149699485235`*^9, 3.8679150403858314`*^9}, 
   3.8679152519831843`*^9},ExpressionUUID->"0c0bceea-6799-4a12-8049-\
fd569d82b055"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"ShowMesh", "[", 
    RowBox[{
     RowBox[{"ToElementMesh", "[", 
      RowBox[{
       RowBox[{"\"\<Coordinates\>\"", "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "1"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"\"\<MeshElements\>\"", "->", 
        RowBox[{"{", 
         RowBox[{"HexahedronElement", "[", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{
            "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", 
             ",", "8"}], "}"}], "}"}], "]"}], "}"}]}]}], "]"}], ",", "True"}],
     "]"}], "\n", 
   Graphics3DBox[{
     {EdgeForm[GrayLevel[0]], FaceForm[None, None], 
      GraphicsComplex3DBox[{{0., 0., 0.}, {2., 0., 0.}, {2., 2., 0.}, {0., 2.,
        0.}, {0., 0., 1.}, {2., 0., 1.}, {2., 2., 1.}, {0., 2., 
       1.}}, {Polygon3DBox[{{1, 2, 3, 4}, {8, 7, 6, 5}, {1, 5, 6, 2}, {2, 6, 
         7, 3}, {3, 7, 8, 4}, {4, 8, 5, 1}}], 
        {GrayLevel[0], Text3DBox[
          FormBox["1", StandardForm], {1., 1., 0.}, {-1, -1}], Text3DBox[
          FormBox["2", StandardForm], {1., 1., 1.}, {-1, -1}], Text3DBox[
          FormBox["3", StandardForm], {1., 0., 0.5}, {-1, -1}], Text3DBox[
          FormBox["4", StandardForm], {2., 1., 0.5}, {-1, -1}], Text3DBox[
          FormBox["5", StandardForm], {1., 2., 0.5}, {-1, -1}], Text3DBox[
          FormBox["6", StandardForm], {0., 1., 0.5}, {-1, -1}]}}]}, 
     {EdgeForm[GrayLevel[0]], FaceForm[None, None], 
      GraphicsComplex3DBox[{{0., 0., 0.}, {2., 0., 0.}, {2., 2., 0.}, {0., 2.,
        0.}, {0., 0., 1.}, {2., 0., 1.}, {2., 2., 1.}, {0., 2., 
       1.}}, {Point3DBox[{1, 2, 3, 4, 5, 6, 7, 8}], 
        {RGBColor[1, 0, 0], Text3DBox[
          FormBox["1", StandardForm], {0., 0., 0.}, {-1, -1}], Text3DBox[
          FormBox["2", StandardForm], {2., 0., 0.}, {-1, -1}], Text3DBox[
          FormBox["3", StandardForm], {2., 2., 0.}, {-1, -1}], Text3DBox[
          FormBox["4", StandardForm], {0., 2., 0.}, {-1, -1}], Text3DBox[
          FormBox["5", StandardForm], {0., 0., 1.}, {-1, -1}], Text3DBox[
          FormBox["6", StandardForm], {2., 0., 1.}, {-1, -1}], Text3DBox[
          FormBox["7", StandardForm], {2., 2., 1.}, {-1, -1}], Text3DBox[
          FormBox["8", StandardForm], {0., 2., 1.}, {-1, -1}]}}]}},
    Boxed->False,
    ImageSize->{141.75, Automatic}], 
   "\"\<{1,2,4,5},{2,3,4,7},{5,2,7,6},{5,7,4,8},{2,4,5,7}\>\"", "\n", "\n", 
   RowBox[{"ShowMesh", "[", 
    RowBox[{
     RowBox[{"ToElementMesh", "[", 
      RowBox[{
       RowBox[{"\"\<Coordinates\>\"", "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"\"\<MeshElements\>\"", "->", 
        RowBox[{"{", 
         RowBox[{"QuadElement", "[", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "}"}], "]"}], 
         "}"}]}]}], "]"}], ",", "True"}], "]"}], "\n", 
   GraphicsBox[{
     {EdgeForm[GrayLevel[0]], FaceForm[None], 
      GraphicsComplexBox[{{0., 0.}, {1., 0.}, {1., 1.}, {0., 
       1.}}, {PolygonBox[{{1, 2, 3, 4}}], 
        {GrayLevel[0], InsetBox["1", {0.5, 0.5}, ImageScaled[{0, 0}]]}}]}, 
     {EdgeForm[GrayLevel[0]], FaceForm[None], 
      GraphicsComplexBox[{{0., 0.}, {1., 0.}, {1., 1.}, {0., 
       1.}}, {PointBox[{1, 2, 3, 4}], 
        {RGBColor[1, 0, 0], InsetBox["1", {0., 0.}, ImageScaled[{0, 0}]], 
         InsetBox["2", {1., 0.}, ImageScaled[{0, 0}]], 
         InsetBox["3", {1., 1.}, ImageScaled[{0, 0}]], 
         InsetBox["4", {0., 1.}, ImageScaled[{0, 0}]]}}]}},
    ImageSize->{120., Automatic}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8679142094183407`*^9, 3.8679142315346107`*^9}, 
   3.8679153073332586`*^9, {3.86791536070259*^9, 
   3.8679153646572695`*^9}},ExpressionUUID->"5bcdb1d8-1a4a-481f-8ba5-\
d050bb469a1c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"plane", ",", " ", "n0", ",", "x0", ",", " ", 
    RowBox[{"finite", " ", "plane"}], ",", " ", "n0", ",", " ", "x0", ",", 
    "x1", ",", "x2", ","}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"plData", "[", 
      RowBox[{"n0_", ",", "x0__"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"dim", "=", 
          RowBox[{"Length", "[", "n0", "]"}]}], ",", "np", ",", 
         RowBox[{"x1", "=", 
          RowBox[{"List", "[", "x0", "]"}]}]}], "}"}], ",", 
       RowBox[{
        RowBox[{"np", "=", 
         RowBox[{"Length", "[", "x1", "]"}]}], ";", 
        RowBox[{"Print", "[", 
         RowBox[{"np", ",", "x1"}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.7634488614109726`*^9, 3.763448937084301*^9}, {
  3.7634489914944134`*^9, 3.7634489957756577`*^9}, {3.7634490466215663`*^9, 
  3.763449049470729*^9}, {3.763449533940439*^9, 3.7634495647482014`*^9}, {
  3.763450278444022*^9, 3.763450302757413*^9}, {3.763450431259763*^9, 
  3.7634505020768137`*^9}, {3.763450611546075*^9, 3.7634506438749237`*^9}, {
  3.763450734073083*^9, 3.763450779165662*^9}},
 CellLabel->
  "In[335]:=",ExpressionUUID->"091b26eb-f03e-42fd-ad5d-d9b65a3c1020"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SegmentListCut2P", "[", 
    RowBox[{"segL_List", ",", "p1_", ",", "p2_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"fd", "=", "False"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"SegmentCut2P", "[", 
           RowBox[{
            RowBox[{"segL", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", "p1", ",", "p2"}], "]"}], 
          ",", 
          RowBox[{
           RowBox[{"fd", "=", "True"}], ";", 
           RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "segL", "]"}]}], "}"}]}], "]"}], ";", 
      "fd"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaneListCut2P", "[", 
    RowBox[{"p3dL_List", ",", "p1_", ",", "p2_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "fd", "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"PlaneCut2P", "[", 
           RowBox[{
            RowBox[{"p3dL", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", "p1", ",", "p2"}], "]"}], 
          ",", 
          RowBox[{
           RowBox[{"fd", "=", "True"}], ";", 
           RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "p3dL", "]"}]}], "}"}]}], "]"}], ";", 
      "fd"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.76346528345426*^9, 3.763465476715314*^9}, {
  3.763468327631377*^9, 3.7634683747400713`*^9}, {3.763468593140563*^9, 
  3.763468646653624*^9}},
 CellLabel->
  "In[336]:=",ExpressionUUID->"5ef18d52-94aa-4726-bd96-81240d4827a7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Geometrical", " ", "tools", " ", "for", " ", "intersection", " ", 
    "calculation"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SegmentCut2P", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x0_", ",", "y0_", ",", "x1_", ",", "y1_"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x2_", ",", "y2_"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x3_", ",", "y3_"}], "}"}]}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"t1", ",", "t2", ",", "t3", ",", "t4"}], "}"}], ",", 
       RowBox[{
        RowBox[{"t1", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x2", "-", "x0"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"y1", "-", "y0"}], ")"}]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"y2", "-", "y0"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"x1", "-", "x0"}], ")"}]}]}]}], ";", 
        RowBox[{"t2", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x3", "-", "x0"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"y1", "-", "y0"}], ")"}]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"y3", "-", "y0"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"x1", "-", "x0"}], ")"}]}]}]}], ";", 
        RowBox[{"t3", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x0", "-", "x2"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"y3", "-", "y2"}], ")"}]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"y0", "-", "y2"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"x3", "-", "x2"}], ")"}]}]}]}], ";", 
        RowBox[{"t4", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x1", "-", "x2"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"y3", "-", "y2"}], ")"}]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"y1", "-", "y2"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"x3", "-", "x2"}], ")"}]}]}]}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"t1", "*", "t2"}], "<", "0"}], " ", "&&", " ", 
           RowBox[{
            RowBox[{"t3", "*", "t4"}], "<", "0"}]}], ",", 
          RowBox[{"Return", "[", "True", "]"}], ",", 
          RowBox[{"Return", "[", "False", "]"}]}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PlaneCut2P", "[", 
      RowBox[{"p3d_List", ",", "p4_", ",", "p5_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "p0", ",", "n1", ",", "r0", ",", "rn", ",", "n45", ",", "nn", ",", 
         "d", ",", "p", ",", "dis", ",", "p1", ",", "p2", ",", "p3", ",", 
         "area"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "p3d", "]"}], "\[Equal]", "7"}], ",", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"//", 
             RowBox[{
              RowBox[{"/", "circle"}], " ", "plane", " ", "in", " ", "3", 
              RowBox[{"d", ":", "x0"}]}]}], ",", "y0", ",", "z0", ",", "n1", 
            ",", "n2", ",", "n3", ",", 
            RowBox[{"r0", ";"}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"p0", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"n1", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"4", ";;", "6"}], "]"}], "]"}]}], ";", 
           RowBox[{"r0", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", "7", "]"}], "]"}]}], ";", 
           RowBox[{"rn", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n1", ".", "n1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"n1", "=", 
            RowBox[{
             RowBox[{"1.", "/", "rn"}], "*", "n1"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"n45", "=", 
            RowBox[{"p5", "-", "p4"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"nn", "=", 
            RowBox[{"n1", ".", "n45"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "nn", "]"}], "<", 
              RowBox[{"10", "^", 
               RowBox[{"-", "5"}]}]}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"d", "=", 
            RowBox[{
             RowBox[{"1", "/", "nn"}], "*", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"p0", "-", "p4"}], ")"}], ".", "n1"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"d", "\[GreaterEqual]", "1"}], " ", "||", " ", 
              RowBox[{"d", "<", "0."}]}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"p", "=", 
            RowBox[{
             RowBox[{"d", " ", "n45"}], "+", "p4"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"dis", "=", 
            RowBox[{"Norm", "[", 
             RowBox[{"p", "-", "p0"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"dis", "\[LessEqual]", "r0"}], ",", 
             RowBox[{"Return", "[", "True", "]"}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "p3d", "]"}], "\[Equal]", "12"}], ",", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"//", 
             RowBox[{"plane3D", ":", 
              RowBox[{"x1", " ", "y1", " ", "z1"}]}]}], ",", 
            RowBox[{"x2", " ", "y2", " ", "z2"}], ",", 
            RowBox[{"x3", " ", "y3", " ", "z3"}], ",", 
            RowBox[{
             RowBox[{"x4", " ", "y4", " ", "z4"}], ";"}]}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"p0", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"p1", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"4", ";;", "6"}], "]"}], "]"}]}], ";", 
           RowBox[{"p2", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"7", ";;", "9"}], "]"}], "]"}]}], ";", 
           RowBox[{"p3", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"10", ";;", "12"}], "]"}], "]"}]}], ";", 
           RowBox[{"n1", "=", 
            RowBox[{"Cross", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"p1", "-", "p0"}], ")"}], ",", 
              RowBox[{"p2", "-", "p0"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"n1", "*=", 
            RowBox[{"1", "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"n1", ".", "n1"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"n45", "=", 
            RowBox[{"p5", "-", "p4"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"nn", "=", 
            RowBox[{"n1", ".", "n45"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "nn", "]"}], "<", 
              RowBox[{"10", "^", 
               RowBox[{"-", "5"}]}]}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"d", "=", 
            RowBox[{
             RowBox[{"1", "/", "nn"}], "*", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"p0", "-", "p4"}], ")"}], ".", "n1"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"d", "\[GreaterEqual]", "1."}], "||", 
              RowBox[{"d", "<", "0."}]}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"p", "=", 
            RowBox[{
             RowBox[{"d", "*", "n45"}], "+", "p4"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"area", "=", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Area3point", "[", 
                 RowBox[{"p0", ",", "p1", ",", "p"}], "]"}], ",", 
                RowBox[{"Area3point", "[", 
                 RowBox[{"p1", ",", "p2", ",", "p"}], "]"}], ",", 
                RowBox[{"Area3point", "[", 
                 RowBox[{"p2", ",", "p3", ",", "p"}], "]"}], ",", 
                RowBox[{"Area3point", "[", 
                 RowBox[{"p3", ",", "p0", ",", "p"}], "]"}]}], "}"}]}], ";"}],
             "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Cross", "[", 
              RowBox[{
               RowBox[{"p1", "-", "p0"}], ",", 
               RowBox[{"p", "-", "p0"}]}], "]"}], ",", 
             RowBox[{"Cross", "[", 
              RowBox[{
               RowBox[{"p3", "-", "p2"}], ",", 
               RowBox[{"p", "-", "p2"}]}], "]"}], ",", 
             RowBox[{"Cross", "[", 
              RowBox[{
               RowBox[{"p2", "-", "p1"}], ",", 
               RowBox[{"p", "-", "p1"}]}], "]"}], ",", 
             RowBox[{"Cross", "[", 
              RowBox[{
               RowBox[{"p0", "-", "p3"}], ",", 
               RowBox[{"p", "-", "p3"}]}], "]"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"p1", "-", "p0"}], ",", 
                  RowBox[{"p", "-", "p0"}]}], "]"}], ".", 
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"p3", "-", "p2"}], ",", 
                  RowBox[{"p", "-", "p2"}]}], "]"}]}], "\[GreaterEqual]", 
               "0."}], " ", "&&", 
              RowBox[{
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"p2", "-", "p1"}], ",", 
                  RowBox[{"p", "-", "p1"}]}], "]"}], ".", 
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"p0", "-", "p3"}], ",", 
                  RowBox[{"p", "-", "p3"}]}], "]"}]}], "\[GreaterEqual]", 
               "0."}]}], ",", 
             RowBox[{"Return", "[", "True", "]"}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Error,the plane is not well defined\>\"", ",", "p3d"}], 
         "]"}], ";", 
        RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Area3point", "[", 
      RowBox[{"p1_", ",", "p2_", ",", "p3_"}], "]"}], ":=", 
     RowBox[{"0.5", 
      RowBox[{"Norm", "[", 
       RowBox[{"Cross", "[", 
        RowBox[{
         RowBox[{"p2", "-", "p1"}], ",", 
         RowBox[{"p3", "-", "p1"}]}], "]"}], "]"}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PointOnTriangle", "[", 
      RowBox[{"v1_", ",", "p1_", ",", "p2_", ",", "p3_", ",", "eps_"}], "]"}],
      ":=", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{"3", "D", " ", "case"}], ";", 
        RowBox[{"-", "1"}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "normal"}], " ", "direction"}], ";", "0"}], ",", 
       RowBox[{
        RowBox[{"not", " ", "on"}], ";", "1"}], ",", 
       RowBox[{
        RowBox[{"normal", " ", "direction"}], ";"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x", ",", "y", ",", "z", ",", "d", ",", "x1", ",", "y1", ",", "z1", 
         ",", "x2", ",", "y2", ",", "z2", ",", "x3", ",", "y3", ",", "z3", 
         ",", "A1", ",", "A2", ",", "A", ",", "normal"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x2", ",", "y2", ",", "z2"}], "}"}], "=", 
         RowBox[{"p2", "-", "p1"}]}], ";", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x3", ",", "y3", ",", "z3"}], "}"}], "=", 
         RowBox[{"p3", "-", "p1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"normal", "=", 
         RowBox[{"Cross", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x2", ",", "y2", ",", "z2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"x3", ",", "y3", ",", "z3"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "y", ",", "z"}], "}"}], "=", 
         RowBox[{"v1", "-", "p1"}]}], ";", 
        RowBox[{"d", "=", 
         RowBox[{"normal", ".", 
          RowBox[{"{", 
           RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"d", "\[LessEqual]", 
            RowBox[{"-", "eps"}]}], " ", "||", " ", 
           RowBox[{"d", "\[GreaterEqual]", "eps"}]}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x1", ",", "y1", ",", "z1"}], "}"}], "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x", ",", "y", ",", "z"}], "}"}], "-", 
          RowBox[{"d", "*", "normal"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"A1", "=", 
         RowBox[{"normal", ".", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"y2", " ", "z1"}], "-", 
             RowBox[{"y1", " ", "z2"}]}], ",", 
            RowBox[{
             RowBox[{"z2", " ", "x1"}], "-", 
             RowBox[{"z1", " ", "x2"}]}], ",", 
            RowBox[{
             RowBox[{"x2", " ", "y1"}], "-", 
             RowBox[{"x1", " ", "y2"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"A2", "=", 
         RowBox[{"normal", ".", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"y1", " ", "z3"}], "-", 
             RowBox[{"y3", " ", "z1"}]}], ",", 
            RowBox[{
             RowBox[{"z1", " ", "x3"}], "-", 
             RowBox[{"z3", " ", "x1"}]}], ",", 
            RowBox[{
             RowBox[{"x1", " ", "y3"}], "-", 
             RowBox[{"x3", " ", "y1"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"A", "=", 
         RowBox[{"normal", ".", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"y2", " ", "z3"}], "-", 
             RowBox[{"y3", " ", "z2"}]}], ",", 
            RowBox[{
             RowBox[{"z2", " ", "x3"}], "-", 
             RowBox[{"z3", " ", "x2"}]}], ",", 
            RowBox[{
             RowBox[{"x2", " ", "y3"}], "-", 
             RowBox[{"x3", " ", "y2"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Sign", "[", "A1", "]"}], "\[NotEqual]", 
           RowBox[{"Sign", "[", "A2", "]"}]}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"A1", "+", "A2"}], "]"}], ">", 
           RowBox[{"Abs", "[", "A", "]"}]}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"d", "\[GreaterEqual]", "0"}], ",", 
          RowBox[{"Return", "[", "1", "]"}], ",", 
          RowBox[{"Return", "[", "2", "]"}]}], "]"}]}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7634523433251266`*^9, 3.763452345771267*^9}, {
  3.7634524183774195`*^9, 3.763452447218069*^9}, {3.7634524778878236`*^9, 
  3.763452493773732*^9}, {3.763452529787792*^9, 3.7634525776675305`*^9}, {
  3.763452652559814*^9, 3.7634526573040857`*^9}, {3.763463486007452*^9, 
  3.7634635033734455`*^9}, {3.7799530747853947`*^9, 3.779953086758194*^9}, {
  3.779953135612227*^9, 3.77995313622117*^9}, {3.780830392589905*^9, 
  3.780830395383935*^9}, {3.780830427051775*^9, 3.780830494025241*^9}, {
  3.780830539530507*^9, 3.780830565849052*^9}, {3.780830780843484*^9, 
  3.780830838540791*^9}},
 CellLabel->
  "In[338]:=",ExpressionUUID->"519377cf-33a2-4b21-ae82-5025826dec62"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ComplementOrder", "[", 
    RowBox[{"vs_List", ",", "vi_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"v2", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"True", ",", 
          RowBox[{"Length", "[", "vs", "]"}]}], "]"}]}], ",", "vi2"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"{", "List", "}"}], ",", 
          RowBox[{"Head", "[", "vi", "]"}]}], "]"}], ",", 
        RowBox[{"vi2", "=", "vi"}], ",", 
        RowBox[{"vi2", "=", 
         RowBox[{"{", "vi", "}"}]}]}], "]"}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"vs", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "\[Equal]", 
             RowBox[{"vi2", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"v2", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", "False"}], ";", 
             RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"Length", "[", "vs", "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "vi2", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"vs", "[", 
       RowBox[{"[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"v2", ",", "True"}], "]"}], "]"}], "]"}], "]"}]}]}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.763533979386675*^9, 3.7635340017579546`*^9}, {
  3.7635340717989607`*^9, 3.7635341616661005`*^9}, {3.7635342737525115`*^9, 
  3.7635343026651654`*^9}, {3.7635343420214167`*^9, 3.763534359429412*^9}, {
  3.7635344114963903`*^9, 3.7635344874467344`*^9}, {3.763534521009654*^9, 
  3.763534550859361*^9}, {3.763534593927825*^9, 3.763534870735657*^9}},
 CellLabel->
  "In[342]:=",ExpressionUUID->"b523d0c3-07d1-49cd-965e-6d9d735084a0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"NeighborUpdateByPlane", "[", 
    RowBox[{
    "nei_List", ",", "coord_List", ",", "geoM_List", ",", 
     "SegmentListCut2P_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Nei", ",", 
       RowBox[{"broNei", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"Length", "[", "coord", "]"}]}], "]"}]}], ",", "ni", ",", 
       "xi", ",", "xiN", ",", "broI"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Nei", "=", "broNei"}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ni", "=", 
          RowBox[{"nei", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{"xi", "=", 
          RowBox[{"coord", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{"xiN", "=", 
          RowBox[{"coord", "[", 
           RowBox[{"[", "ni", "]"}], "]"}]}], ";", 
         RowBox[{"broI", "=", 
          RowBox[{"{", "}"}]}], ";", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"SegmentListCut2P", "[", 
              RowBox[{"geoM", ",", "xi", ",", 
               RowBox[{"xiN", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"broI", ",", 
               RowBox[{"ni", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", 
             RowBox[{"Length", "[", "ni", "]"}]}], "}"}]}], "]"}], ";", 
         RowBox[{
          RowBox[{"broNei", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", "broI"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "coord", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Nei", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{"ComplementOrder", "[", 
          RowBox[{
           RowBox[{"nei", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"broNei", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "coord", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"{", 
       RowBox[{"Nei", ",", "broNei"}], "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PortionCalculate", "[", 
    RowBox[{"Nei_List", ",", "broNei_List"}], "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"N", "[", 
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"broNei", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "]"}], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"broNei", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "]"}], "+", 
         RowBox[{"Length", "[", 
          RowBox[{"Nei", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ")"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Length", "[", "Nei", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EhgDensity", "[", 
    RowBox[{"KHG_List", ",", "uvw_List", ",", "Nei_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"nnode", "=", 
        RowBox[{"Length", "[", "coord", "]"}]}], ",", "ehg", ",", "ehgB", ",",
        "ui"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ehg", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", "nnode"}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ui", "=", 
          RowBox[{"uvw", "[", 
           RowBox[{"[", 
            RowBox[{"Prepend", "[", 
             RowBox[{
              RowBox[{"Nei", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", "i"}], "]"}], "]"}], 
           "]"}]}], ";", 
         RowBox[{
          RowBox[{"ehg", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", 
          RowBox[{"Total", "[", 
           RowBox[{
            RowBox[{"0.5", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"KHG", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ".", "ui"}], ")"}], "ui"}], 
              ")"}]}], ",", 
            RowBox[{"-", "1"}]}], 
           RowBox[{"(*", 
            RowBox[{"{", "2", "}"}], "*)"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "nnode"}], "}"}]}], "]"}], ";", "ehg"}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EhgDensityList", "[", 
    RowBox[{"KHG_List", ",", "uvw_List", ",", "Nei_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"nnode", "=", 
        RowBox[{"Length", "[", "coord", "]"}]}], ",", "ehg", ",", "ehgB", ",",
        "ui"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ehg", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", "nnode"}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ui", "=", 
          RowBox[{"uvw", "[", 
           RowBox[{"[", 
            RowBox[{"Prepend", "[", 
             RowBox[{
              RowBox[{"Nei", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", "i"}], "]"}], "]"}], 
           "]"}]}], ";", 
         RowBox[{
          RowBox[{"ehg", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", 
          RowBox[{"0.5", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"KHG", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ".", "ui"}], ")"}], "ui"}], 
            ")"}]}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "nnode"}], "}"}]}], "]"}], ";", "ehg"}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EphDensity", "[", 
    RowBox[{"Ksp0_", ",", "uvwf_List", ",", "uvwA_List", ",", "udim_"}], 
    "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"fint", ",", "wint"}], "}"}], ",", 
     RowBox[{
      RowBox[{"fint", "=", 
       RowBox[{"ArrayReshape", "[", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Ksp0", ".", "uvwf"}], ")"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "uvwf", "]"}], "/", "udim"}], ",", 
           "udim"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"wint", "=", 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{"fint", " ", "uvwA"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", 
      RowBox[{"{", 
       RowBox[{"wint", ",", "fint"}], "}"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7634487706367807`*^9, 3.763448803752675*^9}, {
   3.763465157421051*^9, 3.7634651767841587`*^9}, {3.763465213394253*^9, 
   3.7634652568987412`*^9}, {3.763465490307091*^9, 3.7634655042718897`*^9}, {
   3.7634655433791265`*^9, 3.763465701332161*^9}, {3.7634657520020595`*^9, 
   3.763465891917062*^9}, 3.7634659301762505`*^9, {3.763466061609768*^9, 
   3.763466183255726*^9}, {3.763467260171322*^9, 3.763467294200268*^9}, {
   3.7634692688462114`*^9, 3.763469271410358*^9}, {3.7635349063076916`*^9, 
   3.7635349070667353`*^9}, {3.7635466933218703`*^9, 3.76354679226353*^9}, {
   3.763546839772247*^9, 3.7635470804650135`*^9}, {3.763547206400217*^9, 
   3.763547214130659*^9}, {3.7635473758609095`*^9, 3.7635474227765927`*^9}, {
   3.7635477328583283`*^9, 3.763547771747553*^9}, {3.763547858220499*^9, 
   3.7635478737043843`*^9}, {3.7635486363340044`*^9, 3.763548715733546*^9}, {
   3.7635489960605793`*^9, 3.7635490587541656`*^9}, {3.7635491084360075`*^9, 
   3.763549112758254*^9}, {3.7635491468242025`*^9, 3.7635491807231417`*^9}, {
   3.763549212596965*^9, 3.763549298550881*^9}, {3.7635498790870857`*^9, 
   3.7635499465819464`*^9}, {3.7639858902416754`*^9, 3.7639859233165665`*^9}},
 CellLabel->
  "In[343]:=",ExpressionUUID->"c2d9ce55-e8e3-404f-bdb3-d5b48520bc71"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"nearestNeighbours", "[", 
    RowBox[{"coord_List", ",", "numNei_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"cfun", ",", "nei"}], "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"$VersionNumber", ">", "10"}], ",", 
       RowBox[{
        RowBox[{"Nearest", "[", 
         RowBox[{
          RowBox[{"coord", "\[Rule]", "Automatic"}], ",", "coord", ",", 
          RowBox[{"numNei", "+", "1"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"2", ";;"}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"cfun", "=", 
         RowBox[{"Nearest", "[", 
          RowBox[{"coord", "\[Rule]", "Automatic"}], "]"}]}], ";", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"cfun", "[", 
            RowBox[{
             RowBox[{"coord", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"numNei", "+", "1"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "coord", "]"}]}], "}"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"2", ";;"}]}], "]"}], "]"}]}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nearestNeighbours", "[", 
    RowBox[{"coord_List", ",", "nodes_List", ",", "numNei_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"c1", "=", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "nodes", "]"}], "]"}]}], ",", "n1"}], "}"}], ",", 
     RowBox[{
      RowBox[{"n1", "=", 
       RowBox[{"nearestNeighbours", "[", 
        RowBox[{"c1", ",", "numNei"}], "]"}]}], ";", 
      RowBox[{"n1", "//.", 
       RowBox[{"ListRule", "[", 
        RowBox[{
         RowBox[{"Range", "[", "nodes", "]"}], ",", "nodes"}], "]"}]}]}]}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.766488225405362*^9, 3.7664882659046783`*^9}, {
  3.7664884865352983`*^9, 3.766488645638398*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"c55cda74-632b-4a5e-82fa-86f3a60aa86c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"nearestNeighbours", "[", 
    RowBox[{"coord_List", ",", "numNei_", ",", "dx_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pl", ",", 
       RowBox[{"dxMax", "=", 
        RowBox[{"Max", "[", "dx", "]"}]}], ",", "pi", ",", "pi2", ",", 
       "dpi"}], "}"}], ",", 
     RowBox[{
      RowBox[{"pl", "=", 
       RowBox[{"Nearest", "[", 
        RowBox[{
         RowBox[{"coord", "\[Rule]", "Automatic"}], ",", "coord", ",", 
         RowBox[{"{", 
          RowBox[{"\[Infinity]", ",", 
           RowBox[{"1.5", " ", "dxMax"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Round", "[", 
             RowBox[{"dxMax", "/", 
              RowBox[{"dx", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "==", "1"}], ",", 
           RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
         RowBox[{"pi", "=", 
          RowBox[{"{", "}"}]}], ";", 
         RowBox[{"pi2", "=", 
          RowBox[{"pl", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"dpi", "=", 
             RowBox[{"Norm", "[", 
              RowBox[{
               RowBox[{"coord", "[", 
                RowBox[{"[", 
                 RowBox[{"pi2", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "-", 
               RowBox[{"coord", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"dpi", "<", 
               RowBox[{"1.5", 
                RowBox[{"dx", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"pi", ",", 
                RowBox[{"pi2", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "2", ",", 
             RowBox[{"Length", "[", "pi2", "]"}]}], "}"}]}], "]"}], ";", 
         RowBox[{
          RowBox[{"pl", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", "pi"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "coord", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "pl"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.76553212610108*^9, 3.7655321367416883`*^9}, {
  3.765532185009449*^9, 3.765532698986847*^9}, {3.7655327328297825`*^9, 
  3.76553277142299*^9}},
 CellLabel->
  "In[350]:=",ExpressionUUID->"13d739a2-4761-4c8b-abbf-86ff4a33d9b8"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Nearest[coord\[Rule]Automatic,coord,{num,radius}] find at most num neighbors \
within radius, if radius too small, give the neighbors, if radius too large, \
remove the extra neighbors. For NOM, num neighbors are adequate, but the \
support domain is not spherical. However, it doesn\[CloseCurlyQuote]t matter.\
\>", "Item",
 CellChangeTimes->{{3.7554519615401783`*^9, 3.755452127056469*^9}, 
   3.793188602596173*^9},ExpressionUUID->"050a5c44-adc9-4d2a-a6b4-\
5f5d808316fc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RoundExpr", "[", "hm_", "]"}], ":=", 
   RowBox[{"Simplify", "[", 
    RowBox[{"ReleaseHold", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"HoldForm", "[", "#", "]"}], "&"}], "@", 
        RowBox[{"Expand", "[", "hm", "]"}]}], ")"}], "/.", 
      RowBox[{"c_Real", "\[RuleDelayed]", 
       RowBox[{"Round", "[", "c", "]"}]}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RoundExpr", "[", 
   RowBox[{"expr_", ",", "ndigit_Integer"}], "]"}], ":=", 
  RowBox[{"Simplify", "[", 
   RowBox[{"ReleaseHold", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"HoldForm", "[", "#", "]"}], "&"}], "@", "expr"}], ")"}], "/.", 
     RowBox[{"c_Real", "\[RuleDelayed]", 
      RowBox[{"NumberForm", "[", 
       RowBox[{"c", ",", 
        RowBox[{"{", 
         RowBox[{"\[Infinity]", ",", "ndigit"}], "}"}]}], "]"}]}]}], "]"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{3.788676353884505*^9},
 CellLabel->
  "In[351]:=",ExpressionUUID->"ff5e3f6c-5653-423f-ad0c-2a5b10a76f6a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ListRule", "[", 
    RowBox[{"var_List", ",", "values_List"}], "]"}], ":=", 
   RowBox[{"Rule", "@@@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"var", ",", "values"}], "}"}], "\[Transpose]"}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UniquePosition", "[", "a_List", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"a3", "=", 
        RowBox[{"{", "1", "}"}]}], ",", "a4"}], "}"}], ",", 
     RowBox[{
      RowBox[{"a4", "=", 
       RowBox[{"{", 
        RowBox[{"a", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "}"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"MemberQ", "[", 
            RowBox[{"a4", ",", 
             RowBox[{"a", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"a3", ",", "i"}], "]"}], ";", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"a4", ",", 
             RowBox[{"a", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "2", ",", 
          RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", "a3"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UniquePosition2", "[", "a_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"da", "=", 
       RowBox[{"DeleteDuplicates", "[", "a", "]"}]}], "}"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{"a", ",", 
          RowBox[{"da", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "da", "]"}]}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SupportNormalTangent", "[", 
    RowBox[{"coord_List", ",", "Nei_List", ",", 
     RowBox[{"tol_", ":", "0.1"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"c1", ",", "k", ",", 
       RowBox[{"nL", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"tL", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"itL", "=", 
        RowBox[{"{", "}"}]}], ",", "es", ",", "ev", ",", "ei", ",", "ndim"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"nL", "=", 
       RowBox[{"EmptyList", "[", 
        RowBox[{"Length", "[", "coord", "]"}], "]"}]}], ";", 
      RowBox[{"tL", "=", "nL"}], ";", 
      RowBox[{"itL", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Length", "[", "coord", "]"}]}], "]"}]}], ";", 
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"c1", "=", 
          RowBox[{"ListMinus", "[", 
           RowBox[{
            RowBox[{"coord", "[", 
             RowBox[{"[", 
              RowBox[{"Nei", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
         RowBox[{"k", "=", 
          RowBox[{"SupportShape", "[", "c1", "]"}]}], ";", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"es", ",", "ev"}], "}"}], "=", 
          RowBox[{"Eigensystem", "[", "k", "]"}]}], ";", 
         RowBox[{"ei", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"es", ",", 
             RowBox[{"_", "?", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#", ">", 
                 RowBox[{"tol", " ", 
                  RowBox[{"es", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}]}], "&"}], ")"}]}]}], 
            "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{
          "itL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "=", 
          "ei"}], ";", 
         RowBox[{
          RowBox[{
          "tL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "=", 
          "ev"}], ";", 
         RowBox[{
          RowBox[{
          "nL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "=", 
          "es"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "coord", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"{", 
       RowBox[{"itL", ",", "nL", ",", "tL"}], "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SupportShape", "[", "xy_List", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"k", ",", "d", ",", 
       RowBox[{"n", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"xy", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"k", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"d", "=", 
          RowBox[{"xy", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{"k", "+=", " ", 
          RowBox[{
           RowBox[{"1", "/", 
            RowBox[{"(", 
             RowBox[{"d", ".", "d"}], ")"}]}], " ", 
           RowBox[{"TensorProduct", "[", 
            RowBox[{"d", ",", "d"}], "]"}]}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "xy", "]"}]}], "}"}]}], "]"}], ";", "k"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BoundaryNormalTangent", "[", 
    RowBox[{"coord_", ",", "nodes_", ",", 
     RowBox[{"numNei_", ":", "4"}], ",", 
     RowBox[{"tol_", ":", "0.1"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"c1", ",", "nei", ",", "itL", ",", "tL", ",", "nL"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"c1", "=", 
       RowBox[{
       "coord", "\[LeftDoubleBracket]", "nodes", "\[RightDoubleBracket]"}]}], 
      ";", 
      RowBox[{"nei", "=", 
       RowBox[{"nearestNeighbours", "[", 
        RowBox[{"c1", ",", "numNei"}], "]"}]}], ";", 
      RowBox[{"SupportNormalTangent", "[", 
       RowBox[{"c1", ",", "nei", ",", "tol"}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalCheck", "[", 
    RowBox[{"coord_List", ",", "center_", ",", "normal_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"n2", "=", "normal"}], ",", "x1", ",", "x2", ",", "x3"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"x1", "=", 
          RowBox[{
           RowBox[{
           "coord", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
           "-", "center"}]}], ";", 
         RowBox[{"x2", "=", 
          RowBox[{"x1", ".", 
           RowBox[{
           "normal", "\[LeftDoubleBracket]", "i", 
            "\[RightDoubleBracket]"}]}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"x2", "<", "0"}], ",", 
           RowBox[{
            RowBox[{
            "n2", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "*=", 
            RowBox[{"-", "1"}]}]}], "]"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "coord", "]"}]}], "}"}]}], "]"}], ";", 
      "n2"}]}], "]"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.753432916965436*^9, 3.753432935497122*^9}, {
   3.753433003970106*^9, 3.753433030256585*^9}, {3.753433211600147*^9, 
   3.7534333128958597`*^9}, {3.753433344263466*^9, 3.7534333607595067`*^9}, {
   3.7534369374562473`*^9, 3.7534369696860304`*^9}, {3.753437011823783*^9, 
   3.7534371750067577`*^9}, {3.7534372144525127`*^9, 
   3.7534373946523943`*^9}, {3.7534374707729235`*^9, 3.753437471883932*^9}, {
   3.753437579498902*^9, 3.753437653139448*^9}, 3.7534377020944476`*^9, {
   3.753437754515441*^9, 3.7534378825554533`*^9}, {3.753437940731497*^9, 
   3.7534379596354427`*^9}, {3.75343799552322*^9, 3.753438123042432*^9}, {
   3.7534382619956074`*^9, 3.7534383951016226`*^9}, {3.7534384845066323`*^9, 
   3.753438542169639*^9}, {3.753438580009493*^9, 3.753438761057119*^9}, {
   3.7534418264706783`*^9, 3.753441829805815*^9}, {3.7534420364282093`*^9, 
   3.7534420398116984`*^9}, {3.753442239883874*^9, 3.7534422576905136`*^9}, {
   3.7534423289691544`*^9, 3.753442332731018*^9}, {3.753442512575365*^9, 
   3.7534425227737484`*^9}, {3.7534425967418575`*^9, 
   3.7534426559812846`*^9}, {3.7534430821443243`*^9, 3.753443151663515*^9}, {
   3.7534433786218777`*^9, 3.753443379038636*^9}, {3.7534434398871183`*^9, 
   3.7534435060045137`*^9}, {3.7534438773917093`*^9, 
   3.7534440866780043`*^9}, {3.7629510938937387`*^9, 
   3.7629510947287865`*^9}, {3.7886729242713423`*^9, 3.7886729513358903`*^9}, 
   3.7931557845748825`*^9},
 CellLabel->
  "In[353]:=",ExpressionUUID->"8b76476d-1aad-415d-9cae-34e1bffeb26d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GridNdim", "[", 
    RowBox[{"num_", ",", "ndim_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"idx", "=", 
        RowBox[{"{", 
         RowBox[{
         "\"\<i\>\"", ",", "\"\<j\>\"", ",", "\"\<k\>\"", ",", "\"\<l\>\"", 
          ",", "\"\<m\>\"", ",", "\"\<n\>\"", ",", "\"\<o\>\"", ",", 
          "\"\<p\>\"", ",", "\"\<q\>\"", ",", "\"\<r\>\"", ",", "\"\<s\>\"", 
          ",", "\"\<t\>\""}], "}"}]}], ",", 
       RowBox[{"id2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"st", "=", "\"\<Table[\>\""}], ",", "al"}], "}"}], ",", 
     RowBox[{
      RowBox[{"idx", "=", 
       RowBox[{"idx", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "ndim"}], "]"}], "]"}]}], ";", 
      RowBox[{"st", "=", 
       RowBox[{"st", "<>", 
        RowBox[{"ToString", "[", "idx", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"id2", "=", 
         RowBox[{"id2", "<>", "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"idx", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "num"}], "}"}], 
           "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
      RowBox[{"al", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"st", "<>", "id2", "<>", "\"\<]\>\""}], "]"}], "]"}]}], ";", 
      RowBox[{"ArrayReshape", "[", 
       RowBox[{"al", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "al", "]"}], "/", "ndim"}], ",", "ndim"}], 
         "}"}]}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GridNdim", "[", 
    RowBox[{"xmin_List", ",", "xmax_List", ",", "dx_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"idx", "=", 
        RowBox[{"{", 
         RowBox[{
         "\"\<i\>\"", ",", "\"\<j\>\"", ",", "\"\<k\>\"", ",", "\"\<l\>\"", 
          ",", "\"\<m\>\"", ",", "\"\<n\>\"", ",", "\"\<o\>\"", ",", 
          "\"\<p\>\"", ",", "\"\<q\>\"", ",", "\"\<r\>\"", ",", "\"\<s\>\"", 
          ",", "\"\<t\>\""}], "}"}]}], ",", 
       RowBox[{"id2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"st", "=", "\"\<Table[\>\""}], ",", "al", ",", 
       RowBox[{"nx", "=", 
        RowBox[{"Ceiling", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"xmax", "-", "xmin"}], ")"}], "/", "dx"}], "]"}]}], ",", 
       "ndx", ",", "dxL", ",", "ndim", ",", "res"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", "xmin", "]"}]}], ";", 
      RowBox[{"idx", "=", 
       RowBox[{"idx", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "ndim"}], "]"}], "]"}]}], ";", 
      RowBox[{"ndx", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"xmax", "-", "xmin"}], ")"}], "/", "nx"}]}], ";", 
      RowBox[{"st", "=", 
       RowBox[{"st", "<>", 
        RowBox[{"ToString", "[", "idx", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"id2", "=", 
         RowBox[{"id2", "<>", "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"idx", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", 
             RowBox[{"nx", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
      RowBox[{"al", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"st", "<>", "id2", "<>", "\"\<]\>\""}], "]"}], "]"}]}], ";", 
      RowBox[{"res", "=", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"al", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "al", "]"}], "/", "ndim"}], ",", "ndim"}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"res", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "i"}], "]"}], "]"}], "*=", 
         RowBox[{"ndx", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"res", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "+=", "xmin"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "res", "]"}]}], "}"}]}], "]"}], ";", 
      "res"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7502403568992233`*^9, 3.750240366617779*^9}, {
  3.752577981132473*^9, 3.7525779821404667`*^9}, {3.7525780570440083`*^9, 
  3.7525781052816877`*^9}, {3.7525781880801573`*^9, 3.7525781915781407`*^9}, {
  3.757692790342083*^9, 3.7576927912151327`*^9}, {3.7687228769811273`*^9, 
  3.768723005246464*^9}, {3.7687231016879797`*^9, 3.768723103396077*^9}, {
  3.768723146995571*^9, 3.7687231751111794`*^9}, {3.768723217814622*^9, 
  3.768723339885604*^9}, {3.7687233928036304`*^9, 3.7687234088195467`*^9}},
 CellLabel->
  "In[361]:=",ExpressionUUID->"9d5d62c2-d2e4-411d-8000-ade58c266894"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GridNdimBC", "[", 
    RowBox[{"num_", ",", "ndim_", ",", 
     RowBox[{"xLen_", ":", "1.0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"idx", "=", 
        RowBox[{"{", 
         RowBox[{
         "\"\<i\>\"", ",", "\"\<j\>\"", ",", "\"\<k\>\"", ",", "\"\<l\>\"", 
          ",", "\"\<m\>\"", ",", "\"\<n\>\"", ",", "\"\<o\>\"", ",", 
          "\"\<p\>\"", ",", "\"\<q\>\"", ",", "\"\<r\>\"", ",", "\"\<s\>\"", 
          ",", "\"\<t\>\""}], "}"}]}], ",", 
       RowBox[{"id2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"st", "=", "\"\<Table[\>\""}], ",", "a", ",", "b", ",", 
       RowBox[{"k", "=", "1"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"idx", "=", 
       RowBox[{"idx", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "ndim"}], "]"}], "]"}]}], ";", 
      RowBox[{"st", "=", 
       RowBox[{"st", "<>", 
        RowBox[{"ToString", "[", "idx", "]"}]}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"id2", "=", 
         RowBox[{"id2", "<>", "\"\<,\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"idx", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "num"}], "}"}], 
           "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
      RowBox[{"a", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"st", "<>", "id2", "<>", "\"\<]\>\""}], "]"}], "]"}]}], ";", 
      RowBox[{"a", "=", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"a", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "a", "]"}], "/", "ndim"}], ",", "ndim"}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"2", " ", "ndim", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"num", "+", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"ndim", "-", "1"}], ")"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"a", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0"}], "]"}], "||", " ", 
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"a", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "num"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"b", "[", 
            RowBox[{"[", 
             RowBox[{"k", "++"}], "]"}], "]"}], "=", "i"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"a", 
         RowBox[{"(", 
          RowBox[{"1.0", " ", 
           RowBox[{"xLen", "/", "num"}]}], ")"}]}], ",", 
        RowBox[{"b", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", 
           RowBox[{"k", "-", "1"}]}], "]"}], "]"}]}], "}"}]}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7576928039478607`*^9, 3.757692803948861*^9}, 
   3.7576929932816906`*^9, {3.796725790513712*^9, 3.796725794969967*^9}},
 CellLabel->
  "In[363]:=",ExpressionUUID->"8ad7010e-45ab-46a5-881c-7197867505e2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BCGridNdim", "[", "a_List", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"b", ",", 
       RowBox[{"k", "=", "1"}], ",", "ndim", ",", "num"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"a", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
      RowBox[{"num", "=", 
       RowBox[{
        RowBox[{"Length", "[", "a", "]"}], "^", 
        RowBox[{"(", 
         RowBox[{"1", "/", "ndim"}], ")"}]}]}], ";", 
      RowBox[{"b", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"2", " ", "ndim", " ", 
          RowBox[{
           RowBox[{"(", "num", ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"ndim", "-", "1"}], ")"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"a", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0"}], "]"}], "||", " ", 
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"a", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"num", "-", "1"}]}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"b", "[", 
            RowBox[{"[", 
             RowBox[{"k", "++"}], "]"}], "]"}], "=", "i"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b", "[", 
       RowBox[{"[", 
        RowBox[{"1", ";;", 
         RowBox[{"k", "-", "1"}]}], "]"}], "]"}]}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.750240839754841*^9, 3.7502408679674544`*^9}, {
   3.7502409479190273`*^9, 3.7502409530903234`*^9}, {3.750241329700864*^9, 
   3.7502414258333626`*^9}, {3.750241512074295*^9, 3.7502415688845444`*^9}, {
   3.750241636419407*^9, 3.750241636524413*^9}, {3.7502417385412483`*^9, 
   3.7502417447666044`*^9}, {3.7502419781879554`*^9, 
   3.7502419800060596`*^9}, {3.7502420419116*^9, 3.7502420707762513`*^9}, {
   3.750398162746918*^9, 3.750398169347973*^9}, {3.7503982153559847`*^9, 
   3.7503982157079897`*^9}, {3.7503982691489973`*^9, 3.750398269419998*^9}, 
   3.751090781544188*^9, 3.751090956747209*^9},
 CellLabel->
  "In[364]:=",ExpressionUUID->"fe5d3a1d-bc56-4726-a6c0-1f0ffc13e609"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CircleAngle", "[", 
    RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"r", ",", "t"}], "}"}], ",", 
     RowBox[{
      RowBox[{"r", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{
         RowBox[{"x", " ", "x"}], "+", 
         RowBox[{"y", " ", "y"}]}], "]"}]}], ";", 
      RowBox[{"t", "=", 
       RowBox[{"ArcSin", "[", 
        RowBox[{"y", "/", "r"}], "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"x", "<", "0"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"\[Pi]", "-", "t"}], "]"}], ",", 
        RowBox[{"Return", "[", "t", "]"}]}], "]"}]}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7500606930219183`*^9, 3.750060745052894*^9}},
 CellLabel->
  "In[365]:=",ExpressionUUID->"1278be06-d382-4d2a-b140-9e7c06b7593c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"CatMatrix", "[", 
    RowBox[{"x_List", ",", "y_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "xy", "}"}], ",", 
     RowBox[{
      RowBox[{"xy", "=", "x"}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"xy", ",", 
          RowBox[{"y", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "y", "]"}]}], "}"}]}], "]"}], ";", "xy"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CatMatrix2", "[", "x__", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"narg", ",", 
       RowBox[{"x2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"x3", "=", 
        RowBox[{"{", "x", "}"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"narg", "=", 
       RowBox[{"Length", "[", "x3", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"x2", ",", 
            RowBox[{
             RowBox[{"x3", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"x3", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "narg"}], "}"}]}], "]"}], ";", "x2"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.750069832583079*^9, 3.7500699071663446`*^9}, {
  3.762868280009445*^9, 3.762868281001502*^9}},
 CellLabel->
  "In[366]:=",ExpressionUUID->"ad1f1d08-5416-4176-99e7-1c97e28475ed"]
}, Open  ]],

Cell["Good discussion on Block, module, with", "Item",
 CellChangeTimes->{{3.750258467065997*^9, 
  3.7502584825158815`*^9}},ExpressionUUID->"7e466f42-1c56-4987-8141-\
2d8fdfc669e2"],

Cell["\<\
https://mathematica.stackexchange.com/questions/559/what-are-the-use-cases-\
for-different-scoping-constructs\
\>", "Item",
 CellChangeTimes->{{3.750258467065997*^9, 3.750258484326985*^9}, {
  3.750258524400277*^9, 
  3.7502585244052773`*^9}},ExpressionUUID->"d21948e0-03c1-41d1-823f-\
1bb07a722204"],

Cell["", "Item",
 CellChangeTimes->{{3.750258467065997*^9, 3.750258484326985*^9}, {
  3.750258524400277*^9, 
  3.750258524666292*^9}},ExpressionUUID->"c38b6a25-eca2-401c-aa86-\
c214d4179ea7"],

Cell[CellGroupData[{

Cell["\<\
x = \[OpenCurlyDoubleQuote]global\[CloseCurlyDoubleQuote]; f[] := x

Module[{x = \[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]}, {x, f[], \
Hold[x]}]
 Block[{x = \[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]}, {x, f[], \
Hold[x]}]
  With[{x = \[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]}, {x, f[], \
Hold[x]}]
which returns:

{\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote], \
\[OpenCurlyDoubleQuote]global\[CloseCurlyDoubleQuote], Hold[x$123]}        (* \
Module *)
{\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote], \
\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote],  Hold[x]}            (* \
Block *)
{\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote], \
\[OpenCurlyDoubleQuote]global\[CloseCurlyDoubleQuote], Hold[\
\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]]}      (* With *)
Executive Summary

Module: the work-horse of scoping constructs -- use it unless you have \
special needs

Block: use it when you need to temporarily change the definition of an \
existing symbol

With: use it when you need to insert values into held expressions

More details follow...

Module

Module evaluates its second argument after replacing all of the \
\[OpenCurlyDoubleQuote]local symbols\[CloseCurlyDoubleQuote] (x in this case) \
with freshly generated unique temporary symbols. Thus,

Module[{x = \[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]}, {x, f[], \
Hold[x]}]
is roughly equivalent to:

x$123 = \[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]; {x$123, f[], \
Hold[x$123]}
yielding the result:

{\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote], \
\[OpenCurlyDoubleQuote]global\[CloseCurlyDoubleQuote], Hold[x$123]}
Block

Block does not generate \[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote] \
symbols. Instead, temporarily it clears all of the definitions and attributes \
associated with the supplied symbols, evaluates the second argument, and then \
restores the cleared definitions. Thus:

Block[{x = \[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]}, {x, f[], \
Hold[x]}]
is roughly equivalent to:

ClearAll[x]; x = \[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]; {x, \
f[], Hold[x]} /. r_ :> (x = \[OpenCurlyDoubleQuote]global\
\[CloseCurlyDoubleQuote]; r)
with the result:

{\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote], \
\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote],  Hold[x]}
In practice, the clearing and restoration of the symbol x is done more \
efficiently by the Mathematica kernel. Take careful note that f[] evaluates \
to \[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]. The global \
definition of x is changed for the duration of the evaluation of the Block \
expression. This behaviour can be very surprising, so be sure that this is \
your intent before using Block.

With

With replaces all occurrences of the listed symbols in the second argument \
with the corresponding values, and then evaluates the result. Thus:

With[{x = \[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]}, {x, f[], \
Hold[x]}]
is equivalent to:

{\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote], f[], Hold[\
\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]]}
with the result:

{\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote], \
\[OpenCurlyDoubleQuote]global\[CloseCurlyDoubleQuote], Hold[\
\[OpenCurlyDoubleQuote]local\[CloseCurlyDoubleQuote]]}
Note especially that With differs from the other two constructs in that it \
can change the contents of held expressions.\
\>", "Item",
 CellChangeTimes->{{3.750258467065997*^9, 3.750258484326985*^9}, {
  3.750258524400277*^9, 
  3.7502585258653603`*^9}},ExpressionUUID->"957e1dd9-4e14-4edb-98b9-\
7e9f7417072c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"elapTime", "=", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"\"\<begin\>\"", ",", 
      RowBox[{"AbsoluteTime", "[", "]"}], ",", "0"}], "}"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ElapsedTime", "[", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{
      RowBox[{"elapTime", "=", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"\"\<begin\>\"", ",", 
          RowBox[{"AbsoluteTime", "[", "]"}], ",", "0"}], "}"}], "}"}]}], 
      ";"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ElapsedTime", "[", "str_String", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"t1", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ",", "t2"}], "}"}], ",", 
     RowBox[{
      RowBox[{"t2", "=", 
       RowBox[{"t1", "-", 
        RowBox[{"elapTime", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "2"}], "]"}], "]"}]}]}], ";", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"elapTime", ",", 
        RowBox[{"{", 
         RowBox[{"str", ",", "t1", ",", "t2"}], "}"}]}], "]"}], ";", 
      RowBox[{"Print", "[", 
       RowBox[{"str", ",", "\"\<: \>\"", ",", "t2", ",", "\"\< s\>\""}], 
       "]"}], ";"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.75033869335507*^9, 3.750338933349797*^9}, 
   3.750338967223734*^9, {3.7503390219488645`*^9, 3.750339069337575*^9}, {
   3.750342118255963*^9, 3.750342157355199*^9}, {3.7503432465995007`*^9, 
   3.750343257339115*^9}, {3.750343293398177*^9, 3.750343302875719*^9}, {
   3.750343401562364*^9, 3.750343451307209*^9}, {3.7503995982243977`*^9, 
   3.75039960524244*^9}},
 CellLabel->
  "In[368]:=",ExpressionUUID->"d7353588-95a4-4d13-ae6d-9bf89e87fabb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RandomSparse", "[", "n_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rm", ",", "t1"}], "}"}], ",", 
     RowBox[{
      RowBox[{"rm", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"t1", "=", 
          RowBox[{"Round", "[", 
           RowBox[{"RandomReal", "[", "0.52", "]"}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"t1", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{"rm", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
            RowBox[{"RandomReal", "[", "3", "]"}]}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "n"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "n"}], "}"}]}], "]"}], ";", "rm"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomSparseArray", "[", "n_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rm", ",", "t1"}], "}"}], ",", 
     RowBox[{
      RowBox[{"rm", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", "n"}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"t1", "=", 
          RowBox[{"Round", "[", 
           RowBox[{"RandomReal", "[", "0.52", "]"}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"t1", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{"rm", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"RandomReal", "[", "3", "]"}]}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "n"}], "}"}]}], "]"}], ";", "rm"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7504107685840716`*^9, 3.75041083272474*^9}, {
   3.750410864401552*^9, 3.7504108646425657`*^9}, {3.7504110063636713`*^9, 
   3.7504110496771493`*^9}, {3.7504111014081078`*^9, 3.750411178804535*^9}, {
   3.75041134062079*^9, 3.7504113806730804`*^9}, 3.750411414554019*^9, {
   3.7504116009166784`*^9, 3.750411611895306*^9}, {3.751088598990353*^9, 
   3.7510886253358603`*^9}},
 CellLabel->
  "In[371]:=",ExpressionUUID->"3af695ba-9b24-4c8f-aa98-c48c92102d16"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "SaveToCell", "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SaveToCell", "::", "usage"}], "=", 
   RowBox[{
   "\"\<SaveToCell[variable] creates an input cell that reassigns the current \
value of variable.\\n\>\"", "<>", 
    "\"\<SaveToCell[variables, display] shows 'display' on the \
right-hand-side of the assignment.\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"SaveToCell", ",", "HoldFirst"}], "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SaveToCell", "[", 
    RowBox[{"var_", ",", 
     RowBox[{"name", ":", 
      RowBox[{"Except", "[", 
       RowBox[{"_", "?", "OptionQ"}], "]"}], ":", "\"\<data\>\""}], ",", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"Compress", "[", "var", "]"}]}], ",", 
       RowBox[{"panel", "=", 
        RowBox[{"ToBoxes", "@", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Panel", "[", 
            RowBox[{"name", ",", 
             RowBox[{"FrameMargins", "\[Rule]", "Small"}]}], "]"}], ",", 
           RowBox[{"DateString", "[", "]"}]}], "]"}]}]}]}], "}"}], ",", 
     RowBox[{"CellPrint", "@", 
      RowBox[{"Cell", "[", 
       RowBox[{
        RowBox[{"BoxData", "@", 
         RowBox[{"RowBox", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"MakeBoxes", "[", "var", "]"}], ",", "\"\<=\>\"", ",", 
            RowBox[{"InterpretationBox", "[", 
             RowBox[{"panel", ",", 
              RowBox[{"Uncompress", "[", "data", "]"}]}], "]"}], ",", 
            "\"\<;\>\""}], "}"}], "]"}]}], ",", "\"\<Input\>\"", ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"prevent", " ", "deletion", " ", "by", " ", "Cell"}], ">", 
          RowBox[{"Delete", " ", "All", " ", 
           RowBox[{"Output", ":"}]}]}], "*)"}], 
        RowBox[{"GeneratedCell", "\[Rule]", "False"}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"CellLabel", " ", "is", " ", 
           RowBox[{"special", ":", 
            RowBox[{
            "last", " ", "occrrence", " ", "takes", " ", "precedence"}]}]}], 
          ",", 
          RowBox[{"so", " ", "it", " ", "comes", " ", "before", " ", 
           RowBox[{"opt", ":"}]}]}], "*)"}], 
        RowBox[{"CellLabel", "\[Rule]", "\"\<(saved)\>\""}], ",", "opt", ",", 
        RowBox[{"CellLabelAutoDelete", "\[Rule]", "False"}]}], "]"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllToCell", "[", 
    RowBox[{
     RowBox[{"name", ":", 
      RowBox[{"Except", "[", 
       RowBox[{"_", "?", "OptionQ"}], "]"}], ":", "\"\<data\>\""}], ",", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"Compress", "[", "\"\<Global`*\>\"", "]"}]}], ",", 
       RowBox[{"panel", "=", 
        RowBox[{"ToBoxes", "@", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Panel", "[", 
            RowBox[{"name", ",", 
             RowBox[{"FrameMargins", "\[Rule]", "Small"}]}], "]"}], ",", 
           RowBox[{"DateString", "[", "]"}]}], "]"}]}]}]}], "}"}], ",", 
     RowBox[{"CellPrint", "@", 
      RowBox[{"Cell", "[", 
       RowBox[{
        RowBox[{"BoxData", "@", 
         RowBox[{"RowBox", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"MakeBoxes", "[", 
             RowBox[{"Names", "[", "\"\<Global`*\>\"", "]"}], "]"}], ",", 
            "\"\<=\>\"", ",", 
            RowBox[{"InterpretationBox", "[", 
             RowBox[{"panel", ",", 
              RowBox[{"Uncompress", "[", "data", "]"}]}], "]"}], ",", 
            "\"\<;\>\""}], "}"}], "]"}]}], ",", "\"\<Input\>\"", ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"prevent", " ", "deletion", " ", "by", " ", "Cell"}], ">", 
          RowBox[{"Delete", " ", "All", " ", 
           RowBox[{"Output", ":"}]}]}], "*)"}], 
        RowBox[{"GeneratedCell", "\[Rule]", "False"}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"CellLabel", " ", "is", " ", 
           RowBox[{"special", ":", 
            RowBox[{
            "last", " ", "occrrence", " ", "takes", " ", "precedence"}]}]}], 
          ",", 
          RowBox[{"so", " ", "it", " ", "comes", " ", "before", " ", 
           RowBox[{"opt", ":"}]}]}], "*)"}], 
        RowBox[{"CellLabel", "\[Rule]", "\"\<(saved)\>\""}], ",", "opt", ",", 
        RowBox[{"CellLabelAutoDelete", "\[Rule]", "False"}]}], "]"}]}]}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.750496551031575*^9, 3.75049656248423*^9}, {
   3.7505103403640347`*^9, 3.750510345605644*^9}, {3.7635312848905582`*^9, 
   3.7635313582207527`*^9}, 3.7635314744844027`*^9, {3.76353162794118*^9, 
   3.7635316490013847`*^9}},
 CellLabel->
  "In[373]:=",ExpressionUUID->"7c6986c2-2bec-48cc-b933-e4d0350ff0c2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FuncToCell", "::", "usage"}], "=", 
   "\"\<FuncToCell[variable] creates an input cell that save the current \
function.\\n\>\""}], ";", 
  RowBox[{"SetAttributes", "[", 
   RowBox[{"FuncToCell", ",", "HoldFirst"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FuncToCell", "[", 
    RowBox[{"var_", ",", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"Compress", "[", 
         RowBox[{"ToString", "[", 
          RowBox[{"MyDefinition", "[", "var", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"panel", "=", 
        RowBox[{"ToBoxes", "@", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Panel", "[", 
            RowBox[{
             RowBox[{"\"\<Saved function: \>\"", "<>", 
              RowBox[{"ToString", "[", "var", "]"}]}], ",", 
             RowBox[{"FrameMargins", "\[Rule]", "Small"}]}], "]"}], ",", 
           RowBox[{"DateString", "[", "]"}]}], "]"}]}]}]}], "}"}], ",", 
     RowBox[{"CellPrint", "@", 
      RowBox[{"Cell", "[", 
       RowBox[{
        RowBox[{"BoxData", "@", 
         RowBox[{"RowBox", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"InterpretationBox", "[", 
             RowBox[{"panel", ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"Uncompress", "[", "data", "]"}], "]"}]}], "]"}], ",", 
            "\"\<;\>\""}], "}"}], "]"}]}], ",", "\"\<Input\>\"", ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"prevent", " ", "deletion", " ", "by", " ", "Cell"}], ">", 
          RowBox[{"Delete", " ", "All", " ", 
           RowBox[{"Output", ":"}]}]}], "*)"}], 
        RowBox[{"GeneratedCell", "\[Rule]", "False"}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"CellLabel", " ", "is", " ", 
           RowBox[{"special", ":", 
            RowBox[{
            "last", " ", "occrrence", " ", "takes", " ", "precedence"}]}]}], 
          ",", 
          RowBox[{"so", " ", "it", " ", "comes", " ", "before", " ", 
           RowBox[{"opt", ":"}]}]}], "*)"}], 
        RowBox[{"CellLabel", "\[Rule]", "\"\<(saved)\>\""}], ",", "opt", ",", 
        RowBox[{"CellLabelAutoDelete", "\[Rule]", "False"}]}], "]"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDefinition", "[", "var_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"s1", "=", 
       RowBox[{"{", "}"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "var", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"s1", ",", 
          RowBox[{"ToString", "[", 
           RowBox[{"InputForm", "[", 
            RowBox[{"Definition", "[", "var", "]"}], "]"}], "]"}]}], "]"}], 
        ",", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"s1", ",", 
            RowBox[{"ToString", "[", 
             RowBox[{"InputForm", "[", 
              RowBox[{"Definition", "[", 
               RowBox[{"Evaluate", "[", 
                RowBox[{"var", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}], "]"}]}],
            "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "var", "]"}]}], "}"}]}], "]"}]}], "]"}], 
      ";", "s1"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7525829739527216`*^9, 3.752583050403308*^9}, 
   3.7525831682993298`*^9, {3.7525833077703533`*^9, 3.752583312748343*^9}, {
   3.7525833451943445`*^9, 3.7525834068759356`*^9}, {3.752583464464616*^9, 
   3.752583469328554*^9}, {3.7525835813298693`*^9, 3.7525835817688875`*^9}, {
   3.752583825149401*^9, 3.752583826406396*^9}, {3.7525839084318933`*^9, 
   3.752583955134568*^9}, {3.7525839942063613`*^9, 3.7525839947663684`*^9}, {
   3.752584658547293*^9, 3.7525847793695574`*^9}, {3.752584830122246*^9, 
   3.752584841265182*^9}, {3.7525849739215107`*^9, 3.7525849779785094`*^9}, {
   3.752585030609517*^9, 3.7525850355625205`*^9}, {3.7525850756735287`*^9, 
   3.7525850760095277`*^9}, 3.752587861257031*^9, {3.7525879041494846`*^9, 
   3.752587907060651*^9}, {3.7617415145144444`*^9, 3.7617415218658648`*^9}, {
   3.761751319684937*^9, 3.761751358406205*^9}},
 CellLabel->
  "In[378]:=",ExpressionUUID->"98863b39-0656-46a9-b9f4-d3d08bf3adb5"]
}, Open  ]],

Cell[CellGroupData[{

Cell["https://en.wikipedia.org/wiki/Bulk_modulus", "Item",
 CellChangeTimes->{{3.752325136457952*^9, 
  3.7523251373320026`*^9}},ExpressionUUID->"abd17a81-3781-4e5b-8e37-\
c57c22cde1a0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"KG2Ev", "[", 
    RowBox[{"K_", ",", "G_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"9.", "K", " ", 
      RowBox[{"G", "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"3", "K"}], "+", "G"}], ")"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"3.", "K"}], "-", 
         RowBox[{"2.", "G"}]}], ")"}], "/", "2"}], "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"3.", "K"}], "+", "G"}], ")"}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ev2KG", "[", 
    RowBox[{"el_", ",", "v_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"el", "/", "3"}], "/", 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"2.", "v"}]}], ")"}]}], ",", 
     RowBox[{
      RowBox[{"el", "/", "2."}], "/", 
      RowBox[{"(", 
       RowBox[{"1", "+", "v"}], ")"}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LG2Ev", "[", 
    RowBox[{"\[Lambda]_", ",", "G_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1.", "G", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"3", "\[Lambda]"}], "+", 
         RowBox[{"2", " ", "G"}]}], ")"}], "/", 
       RowBox[{"(", 
        RowBox[{"\[Lambda]", "+", "G"}], ")"}]}]}], ",", 
     RowBox[{
      RowBox[{"\[Lambda]", "/", "2."}], "/", 
      RowBox[{"(", 
       RowBox[{"\[Lambda]", "+", "G"}], ")"}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ev2LG", "[", 
    RowBox[{"el_", ",", "v_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"el", " ", 
      RowBox[{"v", "/", 
       RowBox[{"(", 
        RowBox[{"1", "-", "v", "-", 
         RowBox[{"2.", 
          RowBox[{"v", "^", "2"}]}]}], ")"}]}]}], ",", 
     RowBox[{"0.5", " ", 
      RowBox[{"el", "/", 
       RowBox[{"(", 
        RowBox[{"1.", "+", "v"}], ")"}]}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KG2LG", "[", 
    RowBox[{"K_", ",", "G_"}], "]"}], ":=", 
   RowBox[{"Ev2LG", "@@", 
    RowBox[{"KG2Ev", "[", 
     RowBox[{"K", ",", "G"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LG2KG", "[", 
    RowBox[{"\[Lambda]_", ",", "G_"}], "]"}], ":=", 
   RowBox[{"Ev2KG", "@@", 
    RowBox[{"LG2Ev", "[", 
     RowBox[{"\[Lambda]", ",", "G"}], "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7523248168119125`*^9, 3.752324952254897*^9}, {
  3.7523249992569532`*^9, 3.752325104651993*^9}, {3.756630003510415*^9, 
  3.7566300118378916`*^9}, {3.756630113107684*^9, 3.7566301426263723`*^9}, {
  3.7566302345266285`*^9, 3.756630363733019*^9}},
 CellLabel->
  "In[381]:=",ExpressionUUID->"0acf3d70-ccc4-41e8-8c79-c4dadfc907f0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"NormList", "[", "v_List", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"s", "=", 
       RowBox[{"RandomReal", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"Length", "[", "v", "]"}], "}"}]}], "]"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"s", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{"Norm", "[", 
           RowBox[{"v", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "//", "N"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "s", "]"}]}], "}"}]}], "]"}], ";", "s"}]}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.752819938963932*^9, 3.752820032408223*^9}, {
  3.752820139647029*^9, 3.7528201617193317`*^9}, {3.752820560895073*^9, 
  3.752820572816231*^9}},
 CellLabel->
  "In[387]:=",ExpressionUUID->"4090ae40-02f3-46ef-8885-1cd57c70f6c8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MatrixUpTriList", "[", "m_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"sl", "=", 
       RowBox[{"{", "}"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"sl", ",", 
          RowBox[{"m", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", 
             RowBox[{"i", ";;", 
              RowBox[{"-", "1"}]}]}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "m", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"Flatten", "[", "sl", "]"}]}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.757073898509691*^9, 3.757073985538263*^9}, {
  3.7570740486186996`*^9, 3.7570740517867002`*^9}},
 CellLabel->
  "In[388]:=",ExpressionUUID->"23e46948-120e-4a5e-b829-70c6d17999ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PertubNodesInBox", "[", 
     RowBox[{"coord_List", ",", "xmin_List", ",", "xmax_List", ",", "dx_"}], 
     "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"bList", ",", "bb", ",", "c2", ",", "ndim"}], "}"}], ",", 
      RowBox[{
       RowBox[{"bList", "=", 
        RowBox[{"FindPoints", "[", 
         RowBox[{"coord", ",", 
          RowBox[{"xmin", "+", "dx"}], ",", 
          RowBox[{"xmax", "-", "dx"}]}], "]"}]}], ";", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Length[bList]\>\"", ",", 
         RowBox[{"Length", "[", "bList", "]"}]}], "]"}], ";", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
       RowBox[{"c2", "=", "coord"}], ";", 
       RowBox[{"bb", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"False", ",", 
          RowBox[{"Length", "[", "coord", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"bb", "[", 
         RowBox[{"[", "bList", "]"}], "]"}], "=", "True"}], ";", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"bb", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"c2", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "+=", 
            RowBox[{
             RowBox[{"RandomReal", "[", 
              RowBox[{"dx", ",", "ndim"}], "]"}], "-", 
             RowBox[{"0.5", "dx"}]}]}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "c2", "]"}]}], "}"}]}], "]"}], ";", 
       "c2"}]}], "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.757511910262761*^9, 3.7575120072203064`*^9}, {
   3.757512072723053*^9, 3.757512139427868*^9}, {3.757512195395069*^9, 
   3.757512355875248*^9}, {3.7575125375516396`*^9, 3.75751257759293*^9}, {
   3.757512631741027*^9, 3.7575126429106655`*^9}, {3.7575127239302998`*^9, 
   3.757512746279578*^9}, 3.7575127891550303`*^9, {3.757512824862073*^9, 
   3.7575128260081387`*^9}, {3.7575128564638805`*^9, 3.7575128571409187`*^9}, 
   3.757513476337335*^9, {3.7575173957205105`*^9, 3.7575174204789267`*^9}, {
   3.759559539200638*^9, 3.759559541935794*^9}},
 CellLabel->
  "In[393]:=",ExpressionUUID->"5229475c-b39b-448b-b04d-2afbc05939d3"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
https://mathematica.stackexchange.com/questions/19778/how-to-form-a-block-\
diagonal-matrix-from-a-list-of-matrices\
\>", "Item",
 CellChangeTimes->{{3.756657819819417*^9, 
  3.7566578206664658`*^9}},ExpressionUUID->"7b601118-711e-42d9-8129-\
45a3007a47c4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"diagF", "=", 
   RowBox[{
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"Band", "[", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], "]"}], "\[Rule]", 
      RowBox[{"{", "##", "}"}]}], "]"}], "&"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.756657719496679*^9, 3.756657719498679*^9}, 
   3.756657829103948*^9},
 CellLabel->
  "In[397]:=",ExpressionUUID->"4fff793b-625d-4492-b5d5-a636615665b1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Region2Mesh", "[", 
    RowBox[{"region_", ",", 
     RowBox[{"hSize_", ":", "1"}], ",", 
     RowBox[{"meshOrder_", ":", "1"}], ",", 
     RowBox[{"printMesh_", ":", "0"}], ",", 
     RowBox[{"sc_", ":", "1."}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"m1", ",", "ele", ",", "coord", ",", "eleB", ",", "eleP"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"m1", "=", 
       RowBox[{"ToElementMesh", "[", 
        RowBox[{"region", ",", 
         RowBox[{"\"\<MeshOrder\>\"", "\[Rule]", "meshOrder"}], ",", 
         RowBox[{"\"\<MaxCellMeasure\>\"", "\[Rule]", "hSize"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ele", "=", 
       RowBox[{
        RowBox[{"m1", "[", "\"\<MeshElements\>\"", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"eleB", "=", 
       RowBox[{
        RowBox[{"m1", "[", "\"\<BoundaryElements\>\"", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"eleP", "=", 
       RowBox[{
        RowBox[{"m1", "[", "\"\<PointElements\>\"", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"coord", "=", 
       RowBox[{"m1", "[", "\"\<Coordinates\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"sc", "\[NotEqual]", "1."}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<ok\>\"", "]"}], ";", 
         RowBox[{"coord", "*=", "sc"}], ";", 
         RowBox[{"m1", "=", 
          RowBox[{"Abaqus2Mesh", "[", 
           RowBox[{"coord", ",", "ele"}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"printMesh", "\[NotEqual]", "0"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"CellPrint", "@", 
           RowBox[{"ExpressionCell", "[", 
            RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"m1", "[", "\"\<Wireframe\>\"", "]"}], "}"}]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"m1", ",", "coord", ",", "ele", ",", "eleB", ",", 
        RowBox[{"Flatten", "[", "eleP", "]"}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Mesh2pureList", "::", "usage"}], "=", 
   "\"\<elementMesh->{nodes, elements, boundary element, point \
element}\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Mesh2pureList", "[", "m1_ElementMesh", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"m1", "[", "\"\<Coordinates\>\"", "]"}], ",", 
     RowBox[{
      RowBox[{"m1", "[", "\"\<MeshElements\>\"", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{"m1", "[", "\"\<BoundaryElements\>\"", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{"m1", "[", "\"\<PointElements\>\"", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7576956830175343`*^9, 3.7576957149963636`*^9}, {
  3.757695763927162*^9, 3.7576958109088492`*^9}, {3.757695847704954*^9, 
  3.7576958953726807`*^9}, {3.7576961082518563`*^9, 3.757696148925183*^9}, {
  3.757696191289606*^9, 3.7576964175385466`*^9}, {3.757696641341347*^9, 
  3.7576966459636116`*^9}, {3.759862115947049*^9, 3.7598621846279774`*^9}, {
  3.759862473905523*^9, 3.7598624780137577`*^9}},
 CellLabel->
  "In[398]:=",ExpressionUUID->"fc563faa-08c1-4666-8f5b-86fd9dfbb25d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Region2Mesh", "[", 
     RowBox[{"region_", ",", "holeXmin_", ",", "holeXmax_", ",", 
      RowBox[{"hSize_", ":", "1"}], ",", 
      RowBox[{"meshOrder_", ":", "1"}], ",", 
      RowBox[{"printMesh_", ":", "0"}], ",", 
      RowBox[{"sc_", ":", "1."}]}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "m1", ",", "ele", ",", "coord", ",", "eleB", ",", "eleP", ",", "fe1", 
        ",", "feRemain", ",", "nodeDelete", ",", "nodeRedex", ",", "k", ",", 
        "nodeRemain", ",", "nodeRule"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"m1", ",", "coord", ",", "ele", ",", "eleB", ",", "eleP"}], 
         "}"}], "=", 
        RowBox[{"Region2Mesh", "[", 
         RowBox[{
         "region", ",", "hSize", ",", "meshOrder", ",", "0", ",", "sc"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"fe1", "=", 
        RowBox[{"FindElement", "[", 
         RowBox[{"coord", ",", "ele", ",", "holeXmin", ",", "holeXmax"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"feRemain", "=", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "ele", "]"}], "]"}], ",", "fe1"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nodeDelete", "=", 
        RowBox[{"Sort", "[", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"ele", "[", 
             RowBox[{"[", "fe1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"Intersection", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"ele", "[", 
               RowBox[{"[", "fe1", "]"}], "]"}], "]"}], ",", 
             RowBox[{"Flatten", "[", 
              RowBox[{"ele", "[", 
               RowBox[{"[", "feRemain", "]"}], "]"}], "]"}]}], "]"}]}], "]"}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nodeRedex", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"1", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", "coord", "]"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"nodeRedex", "[", 
         RowBox[{"[", "nodeDelete", "]"}], "]"}], "=", "0"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"k", "=", "1"}], ";", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"nodeRedex", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[NotEqual]", "0"}], ",", 
            RowBox[{
             RowBox[{"nodeRedex", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "=", 
             RowBox[{"k", "++"}]}]}], "]"}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "coord", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nodeRemain", "=", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "coord", "]"}], "]"}], ",", "nodeDelete"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nodeRule", "=", 
        RowBox[{"Dispatch", "[", 
         RowBox[{"ListRule", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "coord", "]"}], "]"}], ",", "nodeRedex"}], 
          "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ele", "=", 
        RowBox[{"ele", "/.", "nodeRule"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ele", "=", 
        RowBox[{"ele", "[", 
         RowBox[{"[", "feRemain", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"coord", "=", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "nodeRemain", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m1", "=", 
        RowBox[{"Abaqus2Mesh", "[", 
         RowBox[{"coord", ",", "ele"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"eleB", "=", 
        RowBox[{
         RowBox[{"m1", "[", "\"\<BoundaryElements\>\"", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"eleP", "=", 
        RowBox[{
         RowBox[{"m1", "[", "\"\<PointElements\>\"", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"sc", "\[NotEqual]", "1."}], ",", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<ok\>\"", "]"}], ";", 
          RowBox[{"coord", "*=", "sc"}], ";", 
          RowBox[{"m1", "=", 
           RowBox[{"Abaqus2Mesh", "[", 
            RowBox[{"coord", ",", "ele"}], "]"}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"printMesh", "\[NotEqual]", "0"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"CellPrint", "@", 
            RowBox[{"ExpressionCell", "[", 
             RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"m1", "[", "\"\<Wireframe\>\"", "]"}], "}"}]}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"m1", ",", "coord", ",", "ele", ",", "eleB", ",", 
         RowBox[{"Flatten", "[", "eleP", "]"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Example", ":", " ", "res1"}], "=", 
     RowBox[{"Region2Mesh", "[", 
      RowBox[{
       RowBox[{"Rectangle", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"10", ",", "10"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"8", ",", "8"}], "}"}], ",", "1", ",", "1", ",", "0"}], 
      "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"ShowMesh", "[", 
       RowBox[{
        RowBox[{"res1", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", "True"}], "]"}], 
      "\[IndentingNewLine]", "res1"}], "=", 
     RowBox[{"Region2Mesh", "[", 
      RowBox[{
       RowBox[{"Rectangle", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"10", ",", "10"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"8", ",", "8"}], "}"}], ",", "1", ",", "2", ",", "0"}], 
      "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"ShowMesh", "[", 
     RowBox[{
      RowBox[{"res1", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "True"}], "]"}]}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Region2MeshHoleList", "[", 
     RowBox[{"region_", ",", "holeXminList_", ",", "holeXmaxList_", ",", 
      RowBox[{"hSize_", ":", "1"}], ",", 
      RowBox[{"meshOrder_", ":", "1"}], ",", 
      RowBox[{"printMesh_", ":", "0"}], ",", 
      RowBox[{"sc_", ":", "1."}]}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "m1", ",", "ele", ",", "coord", ",", "eleB", ",", "xc", ",", "eleP", 
        ",", "fe1", ",", "feRemain", ",", "nodeDelete", ",", "nodeRedex", ",",
         "k", ",", "nodeRemain", ",", "nodeRule"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"m1", ",", "coord", ",", "ele", ",", "eleB", ",", "eleP"}], 
         "}"}], "=", 
        RowBox[{"Region2Mesh", "[", 
         RowBox[{
         "region", ",", "hSize", ",", "meshOrder", ",", "0", ",", "sc"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"xc", "=", 
        RowBox[{"ElementCenter1", "[", 
         RowBox[{"coord", ",", "ele"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"fe1", "=", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"FindPoints", "[", 
             RowBox[{"xc", ",", 
              RowBox[{"holeXminList", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"holeXmaxList", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "holeXmaxList", "]"}]}], "}"}]}], "]"}], 
          "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"fe1", "=", 
          RowBox[{"FindElement", "[", 
           RowBox[{"coord", ",", "ele", ",", "holeXmin", ",", "holeXmax"}], 
           "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"feRemain", "=", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "ele", "]"}], "]"}], ",", "fe1"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nodeDelete", "=", 
        RowBox[{"Sort", "[", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"ele", "[", 
             RowBox[{"[", "fe1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"Intersection", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"ele", "[", 
               RowBox[{"[", "fe1", "]"}], "]"}], "]"}], ",", 
             RowBox[{"Flatten", "[", 
              RowBox[{"ele", "[", 
               RowBox[{"[", "feRemain", "]"}], "]"}], "]"}]}], "]"}]}], "]"}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nodeRedex", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"1", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", "coord", "]"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"nodeRedex", "[", 
         RowBox[{"[", "nodeDelete", "]"}], "]"}], "=", "0"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"k", "=", "1"}], ";", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"nodeRedex", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[NotEqual]", "0"}], ",", 
            RowBox[{
             RowBox[{"nodeRedex", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "=", 
             RowBox[{"k", "++"}]}]}], "]"}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "coord", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nodeRemain", "=", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "coord", "]"}], "]"}], ",", "nodeDelete"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nodeRule", "=", 
        RowBox[{"Dispatch", "[", 
         RowBox[{"ListRule", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "coord", "]"}], "]"}], ",", "nodeRedex"}], 
          "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ele", "=", 
        RowBox[{"ele", "/.", "nodeRule"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ele", "=", 
        RowBox[{"ele", "[", 
         RowBox[{"[", "feRemain", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"coord", "=", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "nodeRemain", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m1", "=", 
        RowBox[{"Abaqus2Mesh", "[", 
         RowBox[{"coord", ",", "ele"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"eleB", "=", 
        RowBox[{
         RowBox[{"m1", "[", "\"\<BoundaryElements\>\"", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"eleP", "=", 
        RowBox[{
         RowBox[{"m1", "[", "\"\<PointElements\>\"", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"sc", "\[NotEqual]", "1."}], ",", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<ok\>\"", "]"}], ";", 
          RowBox[{"coord", "*=", "sc"}], ";", 
          RowBox[{"m1", "=", 
           RowBox[{"Abaqus2Mesh", "[", 
            RowBox[{"coord", ",", "ele"}], "]"}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"printMesh", "\[NotEqual]", "0"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"CellPrint", "@", 
            RowBox[{"ExpressionCell", "[", 
             RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"m1", "[", "\"\<Wireframe\>\"", "]"}], "}"}]}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"m1", ",", "coord", ",", "ele", ",", "eleB", ",", 
         RowBox[{"Flatten", "[", "eleP", "]"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   TemplateBox[{
     RowBox[{"\"Wed 15 Sep 2021 11:25:16\"", 
       StyleBox[
        RowBox[{"\"GMT+\"", "\[InvisibleSpace]", 
          StyleBox["2.`", NumberMarks -> False, StripOnInput -> False]}], 
        FontColor -> GrayLevel[0.5]]}], 
     RowBox[{"DateObject", "[", 
       RowBox[{
         RowBox[{"{", 
           
           RowBox[{"2021", ",", "9", ",", "15", ",", "11", ",", "25", ",", 
             "16.3729992`8.966703186122855"}], "}"}], ",", "\"Instant\"", ",",
          "\"Gregorian\"", ",", "2.`"}], "]"}]},
    "DateObject",
    Editable->False], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ElementCenter1", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"xyz", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ele", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ndim", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"xyz", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "xc", ",", 
         RowBox[{"le", "=", 
          RowBox[{"Length", "[", "ele", "]"}]}], ",", 
         RowBox[{"ne", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"ele", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "xi", ",", "ei"}], 
        "}"}], ",", 
       RowBox[{
        RowBox[{"xc", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", "le", "}"}], ",", 
           RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xi", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"xi", "=", 
            RowBox[{"Table", "[", 
             RowBox[{"0.", ",", 
              RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", 
           RowBox[{"ei", "=", 
            RowBox[{"ele", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"xi", "+=", 
              RowBox[{"xyz", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "ei"}], "}"}]}], "]"}], ";", 
           RowBox[{
            RowBox[{"xc", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"xi", "/", "ne"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "le"}], "}"}]}], "]"}], ";", "xc"}]}], "]"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NonzeroIndexList2D", "[", "ele_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ie", "=", 
       RowBox[{"{", "}"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"ele", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0"}], "]"}]}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ie", ",", "i"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"Flatten", "[", "ie", "]"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8405214897038527`*^9, 3.8405217237067833`*^9}, {
   3.8405217643498087`*^9, 3.840521991743266*^9}, {3.8405220916800175`*^9, 
   3.8405222429621477`*^9}, {3.8405224947473545`*^9, 
   3.8405225163650613`*^9}, {3.8405225469294624`*^9, 3.840522602836703*^9}, {
   3.8405226398635683`*^9, 3.8405226575935974`*^9}, {3.840522711857461*^9, 
   3.8405228139870667`*^9}, {3.8405228439946914`*^9, 3.84052286578568*^9}, {
   3.8405230180710354`*^9, 3.840523021171317*^9}, {3.8405230528518744`*^9, 
   3.8405230613399234`*^9}, {3.8405231578596907`*^9, 3.840523158311514*^9}, {
   3.84052405047186*^9, 3.840524052600749*^9}, {3.840524116401745*^9, 
   3.840524117626752*^9}, {3.8405250996292877`*^9, 3.8405251008212495`*^9}, {
   3.840525212696459*^9, 3.8405252151454215`*^9}, {3.840525265044029*^9, 
   3.8405252855537567`*^9}, {3.8405254363642893`*^9, 
   3.8405254860228753`*^9}, {3.840525573075923*^9, 3.840525582123767*^9}, 
   3.840525682434944*^9, {3.8405257284525285`*^9, 3.8405257339382205`*^9}, {
   3.8406863090850253`*^9, 3.8406863222157664`*^9}, {3.8406866340127373`*^9, 
   3.8406868822228146`*^9}},
 CellLabel->"In[28]:=",ExpressionUUID->"e92473e4-815e-4c33-b3e3-01ae656a2d02"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "boolFun", " ", "is", " ", "a", " ", "function", " ", "return", " ", 
     "bool"}], ",", " ", 
    RowBox[{
     RowBox[{"for", " ", 
      RowBox[{"example", ":", " ", 
       RowBox[{"boolFun", "[", 
        RowBox[{"x_", ",", "y_"}], "]"}]}]}], ":=", 
     RowBox[{"x", ">", "y"}]}]}], "*)"}], 
  RowBox[{
   RowBox[{
    RowBox[{"Region2MeshWithRefine", "[", 
     RowBox[{"region_", ",", "boolFun_", ",", 
      RowBox[{"hSize_", ":", "1"}], ",", 
      RowBox[{"meshOrder_", ":", "1"}], ",", 
      RowBox[{"printMesh_", ":", "0"}], ",", 
      RowBox[{"sc_", ":", "1."}]}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "m1", ",", "ele", ",", "coord", ",", "eleB", ",", "xc", ",", "eleP", 
        ",", "fe1", ",", "feRemain", ",", "nodeDelete", ",", "nodeRedex", ",",
         "k", ",", "nodeRemain", ",", "nodeRule"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"m1", ",", "coord", ",", "ele", ",", "eleB", ",", "eleP"}], 
         "}"}], "=", 
        RowBox[{"Region2Mesh", "[", 
         RowBox[{
         "region", ",", "hSize", ",", "meshOrder", ",", "0", ",", "sc"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"xc", "=", 
        RowBox[{"ElementCenter1", "[", 
         RowBox[{"coord", ",", "ele"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"fe1", "=", 
          RowBox[{"DeleteDuplicates", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"FindPoints", "[", 
               RowBox[{"xc", ",", 
                RowBox[{"holeXminList", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"holeXmaxList", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "[", "holeXmaxList", "]"}]}], "}"}]}], 
             "]"}], "]"}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"fe1", "=", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"FindPointsByRule", "[", 
           RowBox[{"xc", ",", "boolFun"}], "]"}], ";"}], "*)"}], 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"boolFun", "@@@", "xc"}], ",", "True"}], "]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"fe1", "=", 
          RowBox[{"FindElement", "[", 
           RowBox[{"coord", ",", "ele", ",", "holeXmin", ",", "holeXmax"}], 
           "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"feRemain", "=", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "ele", "]"}], "]"}], ",", "fe1"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nodeDelete", "=", 
        RowBox[{"Sort", "[", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"ele", "[", 
             RowBox[{"[", "fe1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"Intersection", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"ele", "[", 
               RowBox[{"[", "fe1", "]"}], "]"}], "]"}], ",", 
             RowBox[{"Flatten", "[", 
              RowBox[{"ele", "[", 
               RowBox[{"[", "feRemain", "]"}], "]"}], "]"}]}], "]"}]}], "]"}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nodeRedex", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"1", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", "coord", "]"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"nodeRedex", "[", 
         RowBox[{"[", "nodeDelete", "]"}], "]"}], "=", "0"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"k", "=", "1"}], ";", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"nodeRedex", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[NotEqual]", "0"}], ",", 
            RowBox[{
             RowBox[{"nodeRedex", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "=", 
             RowBox[{"k", "++"}]}]}], "]"}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "coord", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nodeRemain", "=", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "coord", "]"}], "]"}], ",", "nodeDelete"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nodeRule", "=", 
        RowBox[{"Dispatch", "[", 
         RowBox[{"ListRule", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "coord", "]"}], "]"}], ",", "nodeRedex"}], 
          "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ele", "=", 
        RowBox[{"ele", "/.", "nodeRule"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ele", "=", 
        RowBox[{"ele", "[", 
         RowBox[{"[", "feRemain", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"coord", "=", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "nodeRemain", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m1", "=", 
        RowBox[{"Abaqus2Mesh", "[", 
         RowBox[{"coord", ",", "ele"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"eleB", "=", 
        RowBox[{
         RowBox[{"m1", "[", "\"\<BoundaryElements\>\"", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"eleP", "=", 
        RowBox[{
         RowBox[{"m1", "[", "\"\<PointElements\>\"", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"sc", "\[NotEqual]", "1."}], ",", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<ok\>\"", "]"}], ";", 
          RowBox[{"coord", "*=", "sc"}], ";", 
          RowBox[{"m1", "=", 
           RowBox[{"Abaqus2Mesh", "[", 
            RowBox[{"coord", ",", "ele"}], "]"}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"printMesh", "\[NotEqual]", "0"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"CellPrint", "@", 
            RowBox[{"ExpressionCell", "[", 
             RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"m1", "[", "\"\<Wireframe\>\"", "]"}], "}"}]}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"m1", ",", "coord", ",", "ele", ",", "eleB", ",", 
         RowBox[{"Flatten", "[", "eleP", "]"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.895049081065833*^9, 3.8950490854285526`*^9}, {
  3.8950491172861867`*^9, 3.895049119476467*^9}, {3.8950492495133133`*^9, 
  3.895049312931423*^9}, {3.895049595322367*^9, 3.895049612186632*^9}, {
  3.895050257811528*^9, 
  3.895050285256752*^9}},ExpressionUUID->"b665b527-0506-4c3a-a7b2-\
c4703986585f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Region2FEM", "[", 
    RowBox[{"region_", ",", 
     RowBox[{"hSize_", ":", "1"}], ",", 
     RowBox[{"meshOrder_", ":", "1"}], ",", 
     RowBox[{"printMesh_", ":", "0"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"m1", ",", "ele", ",", "coord", ",", "nodeVolume"}], "}"}], ",", 
     RowBox[{
      RowBox[{"m1", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"$VersionNumber", "<", "10.1"}], " ", "&&", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "region", "]"}], "\[Equal]", "Cuboid"}], 
            " ", "||", " ", 
            RowBox[{
             RowBox[{"Head", "[", "region", "]"}], "\[Equal]", 
             "Rectangle"}]}], ")"}]}], ",", 
         RowBox[{"ToElementMesh2", "[", 
          RowBox[{"region", ",", "hSize"}], "]"}], ",", 
         RowBox[{"ToElementMesh", "[", 
          RowBox[{"region", ",", 
           RowBox[{"\"\<MeshOrder\>\"", "\[Rule]", "meshOrder"}], ",", 
           RowBox[{"\"\<MaxCellMeasure\>\"", "\[Rule]", "hSize"}]}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ele", "=", 
       RowBox[{
        RowBox[{"m1", "[", "\"\<MeshElements\>\"", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"coord", "=", 
       RowBox[{"m1", "[", "\"\<Coordinates\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nodeVolume", "=", 
       RowBox[{"ElementAreaFEM", "[", 
        RowBox[{"coord", ",", "ele"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"printMesh", "\[NotEqual]", "0"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"CellPrint", "@", 
           RowBox[{"ExpressionCell", "[", 
            RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"m1", "[", "\"\<Wireframe\>\"", "]"}], "}"}]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"coord", ",", "nodeVolume", ",", "ele"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ElementAreaFEM", "[", 
    RowBox[{"coord_List", ",", "ele_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v1", ",", "et", ",", "ndim"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{
        "coord", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"et", "=", 
       RowBox[{"ElementType", "[", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"ele", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
         RowBox[{"Length", "[", 
          RowBox[{"coord", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "\"\<T1\>\"", ",", "\"\<T2\>\"", ",", "\"\<O1\>\"", ",", 
            "\"\<O2\>\""}], "}"}], ",", "et"}], "]"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Simplex element\>\"", "]"}], ";", 
         RowBox[{"v1", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"SimplexVolume", "[", 
             RowBox[{"coord", "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{
               "ele", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"1", ";;", 
                RowBox[{"ndim", "+", "1"}]}], "\[RightDoubleBracket]"}], 
              "\[RightDoubleBracket]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Quad element\>\"", "]"}], ";", 
         RowBox[{"v1", "=", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"CubeVolume", "[", 
             RowBox[{"coord", "\[LeftDoubleBracket]", 
              RowBox[{
              "ele", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "\[RightDoubleBracket]"}], "]"}], ",", 
            RowBox[{"Length", "[", "ele", "]"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", "v1"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ElementAreaFEM", "[", 
    RowBox[{"coord_List", ",", "ele_List", ",", "nonUniform_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v1", ",", "et", ",", "ndim"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{
        "coord", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"et", "=", 
       RowBox[{"ElementType", "[", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"ele", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
         RowBox[{"Length", "[", 
          RowBox[{"coord", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "\"\<T1\>\"", ",", "\"\<T2\>\"", ",", "\"\<O1\>\"", ",", 
            "\"\<O2\>\""}], "}"}], ",", "et"}], "]"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Simplex element\>\"", "]"}], ";", 
         RowBox[{"v1", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"AreaOfTriangle", "[", 
             RowBox[{"coord", "\[LeftDoubleBracket]", 
              RowBox[{
              "ele", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "\[RightDoubleBracket]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<Quad element\>\"", "]"}], ";", 
         RowBox[{"v1", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"AreaOfQuad", "[", 
             RowBox[{"coord", "\[LeftDoubleBracket]", 
              RowBox[{
              "ele", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "\[RightDoubleBracket]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}]}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", "v1"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Element2NodeArea", "[", 
    RowBox[{"coord_", ",", "ele_", ",", "nonUniform_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"v1", "=", 
        RowBox[{"ElementAreaFEM", "[", 
         RowBox[{"coord", ",", "ele", ",", "nonUniform"}], "]"}]}], ",", 
       RowBox[{"v2", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", "coord", "]"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"vn", "=", 
        RowBox[{"1.", "/", 
         RowBox[{"Length", "[", 
          RowBox[{"ele", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"v2", "[", 
          RowBox[{"[", 
           RowBox[{"ele", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "+=", 
         RowBox[{"vn", " ", 
          RowBox[{"v1", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "v1", "]"}]}], "}"}]}], "]"}], ";", "v2"}]}],
     "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.757695304843904*^9, 3.7576953053629336`*^9}, {
  3.7576955105836716`*^9, 3.757695511061699*^9}, {3.757695649649626*^9, 
  3.757695667418642*^9}, {3.757696085773571*^9, 3.7576960958501472`*^9}, {
  3.7652627453489227`*^9, 3.765262746933013*^9}, {3.7664807979975386`*^9, 
  3.7664809116780405`*^9}, {3.797170255227725*^9, 3.7971702789280806`*^9}, {
  3.7971708704799156`*^9, 3.7971709202727633`*^9}, {3.797171473369399*^9, 
  3.7971716459882727`*^9}},
 CellLabel->
  "In[107]:=",ExpressionUUID->"b8bcd98e-414d-41b6-b527-42a88e6cd74d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AreaOfTriangle", "[", "v_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"v12", "=", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
       RowBox[{"v13", "=", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}]}], "}"}], ",", 
     RowBox[{"0.5", 
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"v12", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", 
         RowBox[{"v13", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "-", 
        RowBox[{
         RowBox[{"v12", "[", 
          RowBox[{"[", "2", "]"}], "]"}], 
         RowBox[{"v13", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VolumeOfTet", "[", "v_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "a11", ",", "a12", ",", "a13", ",", "a21", ",", "a22", ",", "a23", ",", 
       "a31", ",", "a32", ",", "a33"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a11", ",", "a12", ",", "a13"}], "}"}], "=", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "-", 
        RowBox[{"v", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a21", ",", "a22", ",", "a23"}], "}"}], "=", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "-", 
        RowBox[{"v", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a31", ",", "a32", ",", "a33"}], "}"}], "=", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "-", 
        RowBox[{"v", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
      RowBox[{
       RowBox[{"1.", "/", "6"}], 
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "a13"}], " ", "a22", " ", "a31"}], "+", 
         RowBox[{"a12", " ", "a23", " ", "a31"}], "+", 
         RowBox[{"a13", " ", "a21", " ", "a32"}], "-", 
         RowBox[{"a11", " ", "a23", " ", "a32"}], "-", 
         RowBox[{"a12", " ", "a21", " ", "a33"}], "+", 
         RowBox[{"a11", " ", "a22", " ", "a33"}]}], "]"}]}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AreaOfQuad", "[", "v_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"v12", "=", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
       RowBox[{"v14", "=", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
       RowBox[{"v32", "=", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}]}], ",", 
       RowBox[{"v34", "=", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}]}]}], "}"}], ",", 
     RowBox[{"0.5", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"v12", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", 
           RowBox[{"v14", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"v12", "[", 
            RowBox[{"[", "2", "]"}], "]"}], 
           RowBox[{"v14", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], "+", 
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"v32", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", 
           RowBox[{"v34", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"v32", "[", 
            RowBox[{"[", "2", "]"}], "]"}], 
           RowBox[{"v34", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], ")"}]}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.797170543389207*^9, 3.797170814536716*^9}, {
  3.798022027550261*^9, 3.7980221237562466`*^9}},
 CellLabel->
  "In[238]:=",ExpressionUUID->"3a0a0eca-2b75-46b7-95c4-aaa70c748d40"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"DofIndexValue", "[", 
      RowBox[{"pL_List", ",", "vl_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "udim", ",", "pi", ",", "pu", ",", "dofIndex", ",", "dofValue", ",", 
         RowBox[{"k", "=", "1"}]}], "}"}], ",", 
       RowBox[{
        RowBox[{"udim", "=", 
         RowBox[{"Length", "[", 
          RowBox[{
          "vl", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}]}], ";", 
        RowBox[{"dofIndex", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"udim", " ", 
            RowBox[{"Length", "[", "pL", "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dofValue", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"udim", " ", 
            RowBox[{"Length", "[", "pL", "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pi", "=", 
         RowBox[{"Range", "[", "udim", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pu", "=", 
            RowBox[{"pi", "+", 
             RowBox[{"udim", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                "pL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                "-", "1"}], ")"}]}]}]}], ";", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"vl", "\[LeftDoubleBracket]", 
                 RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "<", 
                RowBox[{"10", "^", "10"}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "dofIndex", "\[LeftDoubleBracket]", "k", 
                  "\[RightDoubleBracket]"}], "=", 
                 RowBox[{
                 "pu", "\[LeftDoubleBracket]", "j", 
                  "\[RightDoubleBracket]"}]}], ";", 
                RowBox[{
                 RowBox[{"dofValue", "\[LeftDoubleBracket]", 
                  RowBox[{"k", "++"}], "\[RightDoubleBracket]"}], "=", 
                 RowBox[{"vl", "\[LeftDoubleBracket]", 
                  RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}]}]}]}], 
              "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "udim"}], "}"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "pL", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"dofIndex", "\[LeftDoubleBracket]", 
           RowBox[{"1", ";;", 
            RowBox[{"k", "-", "1"}]}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{"dofValue", "\[LeftDoubleBracket]", 
           RowBox[{"1", ";;", 
            RowBox[{"k", "-", "1"}]}], "\[RightDoubleBracket]"}]}], "}"}]}]}],
       "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{"usingCompile", ",", 
        RowBox[{
         RowBox[{"DofIndexValue", "=", 
          RowBox[{"Compile", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"pL", ",", "_Integer", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"vl", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "udim", ",", "pi", ",", "pu", ",", "dofIndex", ",", "dofValue",
                 ",", 
                RowBox[{"k", "=", "1"}]}], "}"}], ",", 
              RowBox[{
               RowBox[{"udim", "=", 
                RowBox[{"Length", "[", 
                 RowBox[{
                 "vl", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                  "]"}]}], ";", 
               RowBox[{"dofIndex", "=", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{"udim", " ", 
                   RowBox[{"Length", "[", "pL", "]"}]}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"dofValue", "=", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{"0.", ",", 
                  RowBox[{"udim", " ", 
                   RowBox[{"Length", "[", "pL", "]"}]}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"pi", "=", 
                RowBox[{"Range", "[", "udim", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"pu", "=", 
                   RowBox[{"pi", "+", 
                    RowBox[{"udim", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "pL", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], "-", "1"}], ")"}]}]}]}], ";", 
                  RowBox[{"Do", "[", 
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"vl", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "<", 
                    RowBox[{"10.", "^", "10"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "dofIndex", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}], "=", 
                    RowBox[{
                    "pu", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}]}], ";", 
                    RowBox[{
                    RowBox[{"dofValue", "\[LeftDoubleBracket]", 
                    RowBox[{"k", "++"}], "\[RightDoubleBracket]"}], "=", 
                    RowBox[{"vl", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}]}]}]}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", "udim"}], "}"}]}], "]"}]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", 
                   RowBox[{"Length", "[", "pL", "]"}]}], "}"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"dofIndex", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ";;", 
                   RowBox[{"k", "-", "1"}]}], "\[RightDoubleBracket]"}], ",", 
                 RowBox[{"dofValue", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ";;", 
                   RowBox[{"k", "-", "1"}]}], "\[RightDoubleBracket]"}]}], 
                "}"}]}]}], "]"}]}], "]"}]}], ";"}]}], "]"}], ";"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"BCValuesFunc", "[", 
      RowBox[{"pL_List", ",", "coord_List", ",", "fun_", ",", "udim_"}], 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"v", ",", "ndim", ",", "fdim"}], "}"}], ",", 
       RowBox[{
        RowBox[{"ndim", "=", 
         RowBox[{"Length", "[", 
          RowBox[{
          "coord", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}]}], ";", 
        RowBox[{"fdim", "=", 
         RowBox[{"fun", "[", 
          RowBox[{"coord", "\[LeftDoubleBracket]", 
           RowBox[{
           "pL", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           "\[RightDoubleBracket]"}], "]"}]}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"udim", "\[NotEqual]", "fdim"}], ",", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<Error, the dimension of fun must be the same as the number \
of multiple fields\>\"", "]"}], ";", 
           RowBox[{"Return", "[", "]"}]}]}], "]"}], ";", 
        RowBox[{"v", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0.0", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", "pL", "]"}], ",", "udim"}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "v", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "+=", 
           RowBox[{"fun", "[", 
            RowBox[{"coord", "\[LeftDoubleBracket]", 
             RowBox[{
             "pL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
             "\[RightDoubleBracket]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "pL", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "v"}]}], "]"}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"DirichletApply", ",", "HoldAll"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"NeumannApply", ",", "HoldFirst"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"pL", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "19"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0.1", ",", "0.2", ",", "0"}], "}"}]}], "}"}]}], 
     ",", " ", 
     RowBox[{"the", " ", "index", " ", "in", " ", "Ksp", " ", 
      RowBox[{"(", 
       RowBox[{"Sparse", " ", "Stiffness", " ", "matrix"}], ")"}]}], ",", " ", 
     RowBox[{"the", " ", "value", " ", "list", " ", "in", " ", "Ksp"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DirichletApply", "[", 
      RowBox[{"Ksp_", ",", "Rsp_", ",", "pL_", ",", "pen_", ",", 
       RowBox[{"scale_", ":", "1.0"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "pi", "}"}], ",", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pi", "=", 
            RowBox[{"pL", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "i"}], "\[RightDoubleBracket]"}]}], ";", 
           RowBox[{
            RowBox[{"Ksp", "\[LeftDoubleBracket]", 
             RowBox[{"pi", ",", "pi"}], "\[RightDoubleBracket]"}], "*=", 
            "pen"}], ";", 
           RowBox[{
            RowBox[{
            "Rsp", "\[LeftDoubleBracket]", "pi", "\[RightDoubleBracket]"}], 
            "=", 
            RowBox[{
             RowBox[{"Ksp", "\[LeftDoubleBracket]", 
              RowBox[{"pi", ",", "pi"}], "\[RightDoubleBracket]"}], " ", 
             RowBox[{"pL", "\[LeftDoubleBracket]", 
              RowBox[{"2", ",", "i"}], "\[RightDoubleBracket]"}], " ", 
             "scale"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
             "pL", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             "]"}]}], "}"}]}], "]"}], ";"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SparseDiag", "[", "a_List", "]"}], ":=", 
     RowBox[{"SparseArray", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "i_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{"a", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
       RowBox[{"Length", "[", "a", "]"}]}], "]"}]}], ";"}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "s", "}"}], ",", 
       RowBox[{
        RowBox[{"s", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", "a", "]"}], ",", 
             RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"s", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "i"}], "]"}], "]"}], "=", 
           RowBox[{"a", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", "s"}]}],
       "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SparseDiag", "[", 
      RowBox[{"a_List", ",", "ia_List", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "b", "}"}], ",", 
       RowBox[{
        RowBox[{"b", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ia", ",", "ia"}], "}"}], "\[Transpose]"}]}], ";", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"b", "\[Rule]", "a"}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DirichletApply", "[", 
      RowBox[{"Ksp_", ",", "Rsp_", ",", "pL_", ",", "pen_", ",", 
       RowBox[{"scale_", ":", "1.0"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pi", ",", "tk", ",", "tk2"}], "}"}], ",", 
       RowBox[{
        RowBox[{"tk", "=", 
         RowBox[{
          RowBox[{"Diagonal", "[", "Ksp", "]"}], "//", "Normal"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tk2", "=", "tk"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tk2", "[", 
          RowBox[{"[", 
           RowBox[{"pL", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "*=", 
         RowBox[{"(", 
          RowBox[{"pen", "+", "1."}], ")"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tk2", "-=", "tk"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Ksp", "+=", 
         RowBox[{"SparseDiag", "[", "tk2", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pi", "=", 
            RowBox[{"pL", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "i"}], "\[RightDoubleBracket]"}]}], ";", 
           RowBox[{
            RowBox[{
            "Rsp", "\[LeftDoubleBracket]", "pi", "\[RightDoubleBracket]"}], 
            "=", 
            RowBox[{
             RowBox[{"tk2", "[", 
              RowBox[{"[", "pi", "]"}], "]"}], " ", 
             RowBox[{"pL", "\[LeftDoubleBracket]", 
              RowBox[{"2", ",", "i"}], "\[RightDoubleBracket]"}], " ", 
             "scale"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
             "pL", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             "]"}]}], "}"}]}], "]"}], ";"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"DirichletApply2", ",", "HoldAll"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DirichletApply2", "[", 
      RowBox[{"Ksp_", ",", "Rsp_", ",", "pL_", ",", "pen_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pi", ",", "dk"}], "}"}], ",", 
       RowBox[{
        RowBox[{"dk", "=", 
         RowBox[{"Diagonal", "[", "Ksp", "]"}]}], ";", 
        RowBox[{
         RowBox[{"dk", "[", 
          RowBox[{"[", 
           RowBox[{
           "pL", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           "]"}], "]"}], "*=", "pen"}], ";", 
        RowBox[{
         RowBox[{"Rsp", "[", 
          RowBox[{"[", 
           RowBox[{"pL", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "+=", 
         RowBox[{
          RowBox[{"dk", "[", 
           RowBox[{"[", 
            RowBox[{
            "pL", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "]"}], " ", 
          RowBox[{"pL", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Ksp", "\[LeftDoubleBracket]", 
            RowBox[{"i", ",", "i"}], "\[RightDoubleBracket]"}], "=", 
           RowBox[{"dk", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "dk", "]"}]}], "}"}]}], "]"}], ";"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"DirichletApplyK", ",", "HoldAll"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DirichletApplyK", "[", 
      RowBox[{"Ksp_", ",", "pL_", ",", "pen_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"pi", "=", 
          RowBox[{"Dimensions", "[", "Ksp", "]"}]}], ",", "dk", ",", "dk2", 
         ",", "id"}], "}"}], ",", 
       RowBox[{
        RowBox[{"id", "=", 
         RowBox[{"UnionTuple", "[", 
          RowBox[{
           RowBox[{"pL", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"pi", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
        RowBox[{"dk", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"id", "\[Rule]", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"-", "1."}], ",", 
              RowBox[{"Length", "[", "id", "]"}]}], "]"}]}], ",", "pi"}], 
          "]"}]}], ";", 
        RowBox[{"dk2", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pL", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"pL", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "\[Transpose]"}], 
            "\[Rule]", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{"pen", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"pL", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ",", "pi"}],
           "]"}]}], ";", 
        RowBox[{"Ksp", "+=", 
         RowBox[{"Ksp", " ", "dk"}]}], ";", 
        RowBox[{"Ksp", "+=", "dk2"}], ";"}]}], " ", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"UnionTuple", "[", 
      RowBox[{"a_List", ",", "nmax_Integer"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"nl", "=", 
          RowBox[{"Range", "[", "nmax", "]"}]}], ",", "ar"}], "}"}], ",", 
       RowBox[{
        RowBox[{"ar", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{"nl", ",", "a"}], "]"}]}], ";", 
        RowBox[{"ArrayFlatten", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Tuples", "[", 
             RowBox[{"{", 
              RowBox[{"a", ",", "ar"}], "}"}], "]"}], ",", 
            RowBox[{"Tuples", "[", 
             RowBox[{"{", 
              RowBox[{"ar", ",", "a"}], "}"}], "]"}], ",", 
            RowBox[{"Tuples", "[", 
             RowBox[{"{", 
              RowBox[{"a", ",", "a"}], "}"}], "]"}]}], "}"}], ",", "1"}], 
         "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NeumannApply", "[", 
      RowBox[{"Rsp_", ",", "pL_", ",", 
       RowBox[{"scale_", ":", "1.0"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Rsp", "\[LeftDoubleBracket]", 
          RowBox[{
          "pL", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "\[RightDoubleBracket]"}], "+=", 
         RowBox[{
          RowBox[{
          "pL", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          "scale"}]}], ";"}]}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.74844175920568*^9, 3.748441843786979*^9}, {
   3.7484419095529895`*^9, 3.748441951506134*^9}, {3.7484421889772816`*^9, 
   3.748442230080413*^9}, {3.7485116530414553`*^9, 3.7485117513996277`*^9}, {
   3.7485121779716406`*^9, 3.7485121785186415`*^9}, {3.748512266584404*^9, 
   3.7485123670647926`*^9}, {3.748512547013126*^9, 3.748512561582353*^9}, {
   3.748512717701643*^9, 3.7485129368490515`*^9}, {3.748512972435917*^9, 
   3.7485129856233416`*^9}, {3.748513171704961*^9, 3.74851340076659*^9}, {
   3.7485134638389063`*^9, 3.7485136303672123`*^9}, {3.7485136611290693`*^9, 
   3.7485136782915*^9}, {3.748514071407445*^9, 3.748514158873609*^9}, {
   3.748514245721975*^9, 3.748514460751774*^9}, {3.7485145377889166`*^9, 
   3.748514655876335*^9}, {3.74851468609639*^9, 3.748514711142637*^9}, {
   3.748516193970865*^9, 3.748516266843399*^9}, {3.74851630010286*^9, 
   3.748516514887861*^9}, {3.7485166099186373`*^9, 3.7485166113382397`*^9}, {
   3.748517274422844*^9, 3.7485173649940166`*^9}, {3.7485190504882936`*^9, 
   3.748519056665107*^9}, {3.7485195953147373`*^9, 3.7485196247217937`*^9}, {
   3.7485214796735764`*^9, 3.748521486407961*^9}, {3.7485216450400343`*^9, 
   3.7485216541975584`*^9}, {3.7485228446986513`*^9, 3.748522848132848*^9}, {
   3.7485304460303307`*^9, 3.7485304521885443`*^9}, {3.7485307506954703`*^9, 
   3.7485307891485424`*^9}, {3.7485308229318047`*^9, 3.748530908520564*^9}, {
   3.748532090649798*^9, 3.7485321130072412`*^9}, {3.7485321526737137`*^9, 
   3.748532167349141*^9}, {3.7485321993324003`*^9, 3.748532248068093*^9}, {
   3.748532666329398*^9, 3.7485326918608456`*^9}, {3.748532889955017*^9, 
   3.748532923620083*^9}, {3.74853304929652*^9, 3.7485330524089265`*^9}, {
   3.748533098147211*^9, 3.748533098662012*^9}, {3.748533174297152*^9, 
   3.7485331776883583`*^9}, {3.748533530514829*^9, 3.748533552491474*^9}, {
   3.750340144966097*^9, 3.7503401789060383`*^9}, {3.750340222204515*^9, 
   3.7503403502808404`*^9}, {3.750340472739845*^9, 3.7503404753189926`*^9}, {
   3.7503405172313895`*^9, 3.7503405445879545`*^9}, {3.750340616876089*^9, 
   3.7503406211213317`*^9}, {3.750341038271191*^9, 3.7503410529770327`*^9}, {
   3.7503994730924067`*^9, 3.750399478068363*^9}, {3.7504170188035636`*^9, 
   3.7504170302152166`*^9}, {3.7504179129247046`*^9, 3.750417930469708*^9}, {
   3.750421311209426*^9, 3.750421318486842*^9}, {3.750752365229139*^9, 
   3.7507524244155245`*^9}, {3.7507530403647547`*^9, 3.750753042777892*^9}, {
   3.7511171792268744`*^9, 3.751117256002265*^9}, {3.7523052192882495`*^9, 
   3.752305247544083*^9}, {3.752309524416724*^9, 3.7523095247926903`*^9}, {
   3.752902799728328*^9, 3.7529028046333456`*^9}, {3.7529028362053113`*^9, 
   3.752902843674307*^9}, {3.752902922282363*^9, 3.7529029408753233`*^9}, {
   3.7529029719393773`*^9, 3.7529030057813826`*^9}, {3.7529031449574127`*^9, 
   3.7529031452433805`*^9}, {3.752903199067419*^9, 3.7529032050754204`*^9}, {
   3.7529032417544265`*^9, 3.752903264155396*^9}, {3.7529033318280163`*^9, 
   3.7529033423809495`*^9}, {3.7707244928809013`*^9, 3.770724551693266*^9}, {
   3.7707246156719246`*^9, 3.770724657769333*^9}, {3.770724878204674*^9, 
   3.7707248812098455`*^9}, {3.770733448975791*^9, 3.770733454741121*^9}, {
   3.7707340598977337`*^9, 3.7707342276933312`*^9}, {3.770734274684019*^9, 
   3.770734307672906*^9}, {3.7707348293567443`*^9, 3.7707348739522953`*^9}, {
   3.7707349848376374`*^9, 3.7707349853446665`*^9}, 3.770735101937335*^9, {
   3.770737643321694*^9, 3.7707376736524286`*^9}, {3.7726952554673934`*^9, 
   3.7726952614327345`*^9}, {3.7726956089176097`*^9, 3.7726956167790594`*^9}, 
   3.772696081184622*^9, 3.7726962916786613`*^9},
 CellLabel->
  "In[403]:=",ExpressionUUID->"b6d651c0-bc7b-4029-8f68-bedb71f7b444"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Vector2Matrix", "[", 
    RowBox[{"uv_List", ",", "udim_Integer"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "m", "}"}], ",", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"udim", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"m", "=", 
          RowBox[{
           RowBox[{"{", "uv", "}"}], "\[Transpose]"}]}], 
         RowBox[{"(*", 
          RowBox[{
           TemplateBox[{
             RowBox[{"\"Thu 26 Aug 2021 12:01:40\"", 
               StyleBox[
                RowBox[{"\"GMT+\"", "\[InvisibleSpace]", 
                  StyleBox[
                  "2.`", NumberMarks -> False, StripOnInput -> False]}], 
                FontColor -> GrayLevel[0.5]]}], 
             RowBox[{"DateObject", "[", 
               RowBox[{
                 RowBox[{"{", 
                   
                   RowBox[{
                    "2021", ",", "8", ",", "26", ",", "12", ",", "1", ",", 
                    "40.0611895`9.3552987203138"}], "}"}], ",", "\"Instant\"",
                  ",", "\"Gregorian\"", ",", "2.`"}], "]"}]},
            "DateObject",
            Editable->False], ",", " ", 
           RowBox[{"modification", " ", "to", " ", "output", " ", "nx1", " ", 
            RowBox[{"matrix", "."}]}]}], "*)"}], ";", 
         RowBox[{"Return", "[", "m", "]"}]}]}], "]"}], ";", 
      RowBox[{"m", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "uv", "]"}], "/", "udim"}], ",", "udim"}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", " ", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{
             RowBox[{"udim", " ", 
              RowBox[{"(", 
               RowBox[{"i", "-", "1"}], ")"}]}], "+", "1"}], ";;", 
            RowBox[{"udim", " ", "i"}]}], "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "m", "]"}]}], "}"}]}], "]"}], ";", "m"}]}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{
  3.7726954254601164`*^9, {3.8389608773017883`*^9, 3.8389609277972527`*^9}},
 CellLabel->
  "In[179]:=",ExpressionUUID->"d563575d-f5b8-491b-8dde-ef901836448d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MergePoints", "[", 
    RowBox[{"XYZ_List", ",", "tot_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"nn", ",", "nflag", ",", "ni", ",", "coord"}], "}"}], ",", 
     RowBox[{
      RowBox[{"coord", "=", 
       RowBox[{"N", "[", "XYZ", "]"}]}], ";", 
      RowBox[{"nflag", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Length", "[", "coord", "]"}]}], "]"}]}], ";", 
      RowBox[{"nn", "=", 
       RowBox[{"Nearest", "[", 
        RowBox[{
         RowBox[{"coord", "\[Rule]", "Automatic"}], ",", "coord", ",", 
         RowBox[{"{", 
          RowBox[{"\[Infinity]", ",", "tot"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"nn", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ">", "1"}], " ", "&&", 
           " ", 
           RowBox[{
            RowBox[{"nflag", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "\[Equal]", "0"}]}], ",", 
          RowBox[{
           RowBox[{"ni", "=", 
            RowBox[{"nn", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"nflag", "[", 
               RowBox[{"[", 
                RowBox[{"ni", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "=", "i"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "2", ",", 
               RowBox[{"Length", "[", "ni", "]"}]}], "}"}]}], "]"}]}]}], 
         "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "nn", "]"}]}], "}"}]}], "]"}], ";", 
      "nflag"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MeshMergePoints", "[", 
     RowBox[{"coord_", ",", "ele_", ",", 
      RowBox[{"tot_", ":", 
       RowBox[{"10.", "^", 
        RowBox[{"-", "3"}]}]}]}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"nflag", ",", "c2", ",", "e2", ",", "nc", ",", "nrepeat"}], 
       "}"}], ",", 
      RowBox[{
       RowBox[{"nflag", "=", 
        RowBox[{"MergePoints", "[", 
         RowBox[{"coord", ",", "tot"}], "]"}]}], ";", 
       RowBox[{"nc", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"nflag", ",", "0"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nrepeat", "=", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "coord", "]"}], "]"}], ",", "nc"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"c2", "=", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "nc", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"e2", "=", 
        RowBox[{"ele", "/.", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"nrepeat", ",", 
            RowBox[{"nflag", "[", 
             RowBox[{"[", "nrepeat", "]"}], "]"}]}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"e2", "=", 
        RowBox[{"e2", "/.", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"nc", ",", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "nc", "]"}], "]"}]}], "]"}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"c2", ",", "e2"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Dispath", " ", "version", " ", "of", " ", "MeshMergePoints"}], 
    ",", " ", 
    RowBox[{"which", " ", "is", " ", "1000", " ", "times", " ", 
     RowBox[{"faster", "."}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MeshMergePoints", "[", 
    RowBox[{"coord_", ",", "ele_", ",", 
     RowBox[{"tot_", ":", 
      RowBox[{"10.", "^", 
       RowBox[{"-", "3"}]}]}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"nflag", ",", "c2", ",", "e2", ",", "nc", ",", "nrepeat"}], 
      "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{"Print", "[", 
       RowBox[{"AbsoluteTiming", "["}]}], "*)"}], 
     RowBox[{
      RowBox[{"nflag", "=", 
       RowBox[{"MergePoints", "[", 
        RowBox[{"coord", ",", "tot"}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"]", "]"}], ";"}], "*)"}], 
      RowBox[{"nc", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Position", "[", 
         RowBox[{"nflag", ",", "0"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nrepeat", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "coord", "]"}], "]"}], ",", "nc"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"c2", "=", 
       RowBox[{"coord", "[", 
        RowBox[{"[", "nc", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"e2", "=", 
       RowBox[{"ele", "/.", 
        RowBox[{"Dispatch", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"nrepeat", ",", 
            RowBox[{"nflag", "[", 
             RowBox[{"[", "nrepeat", "]"}], "]"}]}], "]"}], "]"}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"e2", "=", 
       RowBox[{"e2", "/.", 
        RowBox[{"Dispatch", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"nc", ",", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "nc", "]"}], "]"}]}], "]"}], "]"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"c2", ",", "e2"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.759926307681136*^9, 3.759926324629105*^9}, {
  3.7599265186662035`*^9, 3.7599265745644007`*^9}, {3.7599266458084755`*^9, 
  3.7599266480096016`*^9}, {3.7599267840363817`*^9, 3.7599268275308695`*^9}, {
  3.7599268727454557`*^9, 3.7599271045367136`*^9}, {3.7599275690732837`*^9, 
  3.759927597474908*^9}, {3.7599307360044217`*^9, 3.7599307364414463`*^9}, {
  3.7599307906105447`*^9, 3.759930797931964*^9}, {3.877853843128534*^9, 
  3.8778538625991426`*^9}, {3.899887404508323*^9, 3.8998874265032277`*^9}, {
  3.899887460711931*^9, 3.8998874859002266`*^9}, {3.8998876324740505`*^9, 
  3.8998876681424828`*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"75af13f3-5fa7-4ee0-8e05-8fd2e60ac6b8"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"r1", "=", "1"}], ";", 
   RowBox[{"r2", "=", "2"}], ";", 
   RowBox[{"\[Theta]1", "=", "0"}], ";", 
   RowBox[{"\[Theta]2", "=", 
    RowBox[{"2", " ", "\[Pi]"}]}], ";", 
   RowBox[{"z1", "=", "0"}], ";", 
   RowBox[{"z2", "=", "3"}], ";", "\[IndentingNewLine]", 
   RowBox[{"rg", "=", 
    RowBox[{"Cuboid", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"r1", ",", "\[Theta]1", ",", "z1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"r2", ",", "\[Theta]2", ",", "z2"}], "}"}]}], "]"}]}], ";", 
   RowBox[{"sc", "=", "1"}], ";", 
   RowBox[{"dx", "=", "0.2"}], ";", 
   RowBox[{"ndim", "=", "3"}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ele2", ",", "coord", ",", "ele", ",", "eleB", ",", "eleP"}], 
     "}"}], "=", 
    RowBox[{"Region2Mesh", "[", 
     RowBox[{"rg", ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"sc", " ", "dx"}], ")"}], "^", "ndim"}], ",", "1", ",", "0", 
      ",", 
      RowBox[{"1", "/", "sc"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fun3", "[", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", " ", 
       RowBox[{"Cos", "[", 
        RowBox[{"y", "/", "2"}], "]"}]}], ",", 
      RowBox[{"x", " ", 
       RowBox[{"Sin", "[", 
        RowBox[{"y", "/", "2"}], "]"}]}], ",", "z"}], "}"}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"c4", "=", 
    RowBox[{"fun3", "@@@", "coord"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Plot3DField", "[", 
     RowBox[{
      RowBox[{"RandomReal", "[", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", "c4", "]"}]}], "]"}], ",", 
      RowBox[{"Abaqus2Mesh", "[", 
       RowBox[{"c4", ",", "ele"}], "]"}]}], "]"}], "\n", 
    TemplateBox[{"", 
      FormBox[
       FormBox[
        TemplateBox[{
          FormBox["", TraditionalForm]}, "BarLegend", 
         DisplayFunction -> (#& ), 
         InterpretationFunction :> (RowBox[{"BarLegend", "[", 
            RowBox[{"{", 
              RowBox[{"\"TemperatureMap\"", ",", 
                RowBox[{"{", 
                  
                  RowBox[{
                   "0.00017719819830119832`", ",", "0.9995350379369445`"}], 
                  "}"}]}], "}"}], "]"}]& )], TraditionalForm], 
       TraditionalForm]},
     "Legended",
     DisplayFunction->(GridBox[{{
         TagBox[
          ItemBox[
           PaneBox[
            TagBox[#, "SkipImageSizeLevel"], Alignment -> {Center, Baseline}, 
            BaselinePosition -> Baseline], DefaultBaseStyle -> "Labeled"], 
          "SkipImageSizeLevel"], 
         ItemBox[#2, DefaultBaseStyle -> "LabeledLabel"]}}, 
       GridBoxAlignment -> {"Columns" -> {{Center}}, "Rows" -> {{Center}}}, 
       AutoDelete -> False, GridBoxItemSize -> Automatic, 
       BaselinePosition -> {1, 1}]& ),
     Editable->True,
     InterpretationFunction->(RowBox[{"Legended", "[", 
        RowBox[{#, ",", 
          RowBox[{"Placed", "[", 
            RowBox[{#2, ",", "After"}], "]"}]}], "]"}]& )]}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.7599320356267557`*^9, 3.759932068383629*^9}, {
   3.7599321442549686`*^9, 3.7599321694794116`*^9}, 3.7599322240225315`*^9, {
   3.8437151797583055`*^9, 
   3.8437151834077053`*^9}},ExpressionUUID->"ce9d8726-c797-497e-9314-\
b3e2f40d110e"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"r1", "=", "1"}], ";", 
   RowBox[{"r2", "=", "2"}], ";", 
   RowBox[{"\[Theta]1", "=", "0"}], ";", 
   RowBox[{"\[Theta]2", "=", 
    RowBox[{"2", "\[Pi]"}]}], ";", 
   RowBox[{"z1", "=", "0"}], ";", 
   RowBox[{"z2", "=", "3"}], ";", "\[IndentingNewLine]", 
   RowBox[{"rg", "=", 
    RowBox[{"Rectangle", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"r1", ",", "\[Theta]1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"r2", ",", "\[Theta]2"}], "}"}]}], "]"}]}], ";", 
   RowBox[{"sc", "=", "1"}], ";", 
   RowBox[{"dx", "=", "0.2"}], ";", 
   RowBox[{"ndim", "=", "2"}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ele2", ",", "coord", ",", "ele", ",", "eleB", ",", "eleP"}], 
     "}"}], "=", 
    RowBox[{"Region2Mesh", "[", 
     RowBox[{"rg", ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"sc", " ", "dx"}], ")"}], "^", "ndim"}], ",", "1", ",", "0", 
      ",", 
      RowBox[{"1", "/", "sc"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fun2", "[", 
     RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", " ", 
       RowBox[{"Cos", "[", "y", "]"}]}], ",", 
      RowBox[{"x", " ", 
       RowBox[{"Sin", "[", "y", "]"}]}]}], "}"}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"c2", "=", 
    RowBox[{"fun2", "@@@", "coord"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"c3", ",", "e3"}], "}"}], "=", 
    RowBox[{"MeshMergePoints", "[", 
     RowBox[{"c2", ",", "ele"}], "]"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"ShowMesh", "[", 
    RowBox[{"Abaqus2Mesh", "[", 
     RowBox[{"c3", ",", "e3"}], "]"}], "]"}]}], "\n", "*)"}]], "Input",
 CellChangeTimes->{{3.75993210213056*^9, 3.7599321381596203`*^9}, 
   3.759932181360091*^9, 3.7599322135519323`*^9, 
   3.8437152502988663`*^9},ExpressionUUID->"164d402d-d927-45c8-a2a0-\
ad5ea7cd5b7e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SaveAll", "[", 
    RowBox[{"fileName_String", ":", "\"\<Data\>\""}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"DumpSave", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"NotebookDirectory", "[", "]"}], "<>", "fileName", "<>", 
        "\"\<.mx\>\""}], ",", "\"\<Global`\>\""}], "]"}], ";", 
     RowBox[{
     "Print", "[", 
      "\"\<All variables have been saved, which can be loaded by typing:\>\"",
       "]"}], ";", 
     RowBox[{"\"\<<<\\\"\>\"", "<>", 
      RowBox[{"NotebookDirectory", "[", "]"}], "<>", "fileName", "<>", 
      "\"\<.mx\\\"\>\""}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Beep1", "[", 
    RowBox[{"n_", ":", "1"}], "]"}], ":=", 
   RowBox[{"Do", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Beep", "[", "]"}], ";", 
      RowBox[{"Pause", "[", "0.25", "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Min", "[", 
        RowBox[{"4", ",", "n"}], "]"}]}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7652784974708924`*^9, 3.7652786444552994`*^9}, {
  3.765278713199231*^9, 3.7652787497753234`*^9}, {3.765278997139472*^9, 
  3.765279063866288*^9}, {3.765279172313491*^9, 3.7652791802989483`*^9}, {
  3.765300890949726*^9, 3.7653009247876616`*^9}, {3.7653009556684275`*^9, 
  3.7653009856181407`*^9}, {3.765301118987769*^9, 3.76530113805186*^9}},
 CellLabel->
  "In[444]:=",ExpressionUUID->"519d7920-feab-4cdb-89db-c329968ef2d6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AreaQuad", "[", "c_List", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"n1", "=", 
        RowBox[{
         RowBox[{"c", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "-", 
         RowBox[{"c", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
       RowBox[{"n2", "=", 
        RowBox[{
         RowBox[{"c", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "-", 
         RowBox[{"c", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
       RowBox[{"n3", "=", 
        RowBox[{
         RowBox[{"c", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "-", 
         RowBox[{"c", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}]}], ",", 
       RowBox[{"n4", "=", 
        RowBox[{
         RowBox[{"c", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "-", 
         RowBox[{"c", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}]}], ",", "a", ",", "ci"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"a", "=", 
       RowBox[{"0.5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Norm", "[", 
           RowBox[{"MyCross", "[", 
            RowBox[{"n2", ",", "n1"}], "]"}], "]"}], "+", 
          RowBox[{"Norm", "[", 
           RowBox[{"MyCross", "[", 
            RowBox[{"n3", ",", "n4"}], "]"}], "]"}]}], ")"}]}]}], ";", 
      RowBox[{"ci", "=", 
       RowBox[{"0.25", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"c", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "+", 
          RowBox[{"c", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "+", 
          RowBox[{"c", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "+", 
          RowBox[{"c", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], ")"}]}]}], ";", 
      RowBox[{"{", 
       RowBox[{"ci", ",", "a"}], "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"QuadCenter", "[", 
   RowBox[{"coord_List", ",", "ele_List"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ce", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"Length", "[", "ele", "]"}]}], "]"}]}], ",", "ci"}], "}"}], 
    ",", 
    RowBox[{
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ci", "=", 
         RowBox[{"coord", "[", 
          RowBox[{"[", 
           RowBox[{"ele", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ce", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1.", " ", 
            RowBox[{"Total", "[", 
             RowBox[{"ci", ",", 
              RowBox[{"{", "1", "}"}]}], "]"}]}], ")"}], "/", 
          RowBox[{"Length", "[", "ci", "]"}]}]}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}], ";", "ce"}]}],
    "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Quad2Particle", "[", 
    RowBox[{"coord_List", ",", "ele_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ci", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0.", ",", "0."}], "}"}], ",", 
          RowBox[{"Length", "[", "ele", "]"}]}], "]"}]}], ",", 
       RowBox[{"ai", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"Length", "[", "ele", "]"}]}], "]"}]}], ",", "j"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"j", "=", 
          RowBox[{"AreaQuad", "[", 
           RowBox[{"coord", "[", 
            RowBox[{"[", 
             RowBox[{"ele", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"ai", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", 
          RowBox[{"j", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"ci", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", 
          RowBox[{"j", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ele", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"{", 
       RowBox[{"ci", ",", "ai"}], "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"QuadRefine0", "[", 
    RowBox[{"x_List", ",", "ele_List", ",", "nmax_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"c2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"e2", "=", 
        RowBox[{"{", "}"}]}], ",", "n1"}], "}"}], ",", 
     RowBox[{
      RowBox[{"AppendTo", "[", 
       RowBox[{"c2", ",", 
        RowBox[{"0.5", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"x", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "+", 
           RowBox[{"x", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}]}], "]"}], ";", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"c2", ",", 
        RowBox[{"0.5", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"x", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "+", 
           RowBox[{"x", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ")"}]}]}], "]"}], ";", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"c2", ",", 
        RowBox[{"0.5", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"x", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "+", 
           RowBox[{"x", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], ")"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"c2", ",", 
        RowBox[{"0.5", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"x", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "+", 
           RowBox[{"x", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], ")"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"c2", ",", 
        RowBox[{"0.5", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"c2", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "+", 
           RowBox[{"c2", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ")"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n1", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4", ",", "5"}], "}"}], "+", 
        "nmax"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"e2", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ele", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "5", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"e2", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ele", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "5", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"e2", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ele", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "5", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"e2", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ele", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "5", "]"}], "]"}], ",", 
          RowBox[{"n1", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"c2", ",", "e2"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"QuadRefine", "[", 
    RowBox[{"coord_List", ",", "ele_List", ",", "rele_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"cc", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"ee", "=", 
        RowBox[{"{", "}"}]}], ",", "c2", ",", "e2", ",", 
       RowBox[{"nmax", "=", 
        RowBox[{"Length", "[", "coord", "]"}]}], ",", "elei"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"elei", "=", 
          RowBox[{"ele", "[", 
           RowBox[{"[", 
            RowBox[{"rele", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"c2", ",", "e2"}], "}"}], "=", 
          RowBox[{"QuadRefine0", "[", 
           RowBox[{
            RowBox[{"coord", "[", 
             RowBox[{"[", "elei", "]"}], "]"}], ",", "elei", ",", 
            RowBox[{"nmax", "+", 
             RowBox[{"Length", "[", "cc", "]"}]}]}], "]"}]}], ";", 
         RowBox[{"cc", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"cc", ",", "c2"}], "]"}]}], ";", 
         RowBox[{"ee", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"ee", ",", "e2"}], "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "rele", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"coord", ",", "cc"}], "]"}], ",", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"ele", "[", 
           RowBox[{"[", 
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "ele", "]"}], "]"}], ",", "rele"}], 
             "]"}], "]"}], "]"}], ",", "ee"}], "]"}]}], "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"QuadRefineToParticle", "[", 
    RowBox[{"coord_List", ",", "ele_List", ",", "boxL_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ce", ",", 
       RowBox[{"c2", "=", "coord"}], ",", 
       RowBox[{"e2", "=", "ele"}], ",", "ls", ",", "bi", ",", "cd1", ",", 
       "pv1"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ce", "=", 
          RowBox[{"QuadCenter", "[", 
           RowBox[{"c2", ",", "e2"}], "]"}]}], ";", 
         RowBox[{"bi", "=", 
          RowBox[{"boxL", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ls", "=", 
          RowBox[{"FindPoints", "[", 
           RowBox[{"ce", ",", 
            RowBox[{"bi", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"bi", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"c2", ",", "e2"}], "}"}], "=", 
          RowBox[{"QuadRefine", "[", 
           RowBox[{"c2", ",", "e2", ",", "ls"}], "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "boxL", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"cd1", ",", "pv1"}], "}"}], "=", 
       RowBox[{"Quad2Particle", "[", 
        RowBox[{"c2", ",", "e2"}], "]"}]}], ";", 
      RowBox[{"{", 
       RowBox[{"c2", ",", "e2", ",", "cd1", ",", "pv1"}], "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotDisk", "[", 
    RowBox[{"loc_", ",", "r_"}], "]"}], ":=", 
   RowBox[{"Graphics", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Opacity", "[", "0.2", "]"}], ",", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"r", ">", "0"}], ",", "Blue", ",", "Red"}], "]"}], ",", 
      RowBox[{"EdgeForm", "[", "Black", "]"}], ",", 
      RowBox[{"Disk", "[", 
       RowBox[{"loc", ",", 
        RowBox[{"Abs", "[", "r", "]"}]}], "]"}]}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Show", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"PlotDisk", "[", 
       RowBox[{"i", ",", 
        RowBox[{"RandomReal", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "2"}], ",", "2"}], "}"}], "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"RandomReal", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"100", ",", "2"}], "}"}]}], "]"}]}], "}"}]}], "]"}], "]"}],
    "*)"}]}]}], "Input",
 CellLabel->
  "In[446]:=",ExpressionUUID->"5eb2973d-b4e5-4986-846a-8a997ad80f58"],

Cell[BoxData[
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"$VersionNumber", "<", "10.1"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"StringStartsQ", "[", 
       RowBox[{"s1_String", ",", "s2_String"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"StringTake", "[", 
        RowBox[{"s1", ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"StringLength", "[", "s1", "]"}], ",", 
             RowBox[{"StringLength", "[", "s2", "]"}]}], "]"}]}], "}"}]}], 
        "]"}], "\[Equal]", "s2"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"StringDelete", "[", 
       RowBox[{"s1_String", ",", "s_String"}], "]"}], ":=", 
      RowBox[{"StringJoin", "[", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"s1", ",", "s"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"StringDelete", "[", 
       RowBox[{"s1_String", ",", "s_List"}], "]"}], ":=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"s2", "=", "s1"}], "}"}], ",", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"s2", "=", 
            RowBox[{"StringDelete", "[", 
             RowBox[{"s2", ",", 
              RowBox[{"s", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "s", "]"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "s2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MinMax", "[", "a_List", "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Min", "[", "a", "]"}], ",", 
        RowBox[{"Max", "[", "a", "]"}]}], "}"}]}], ";"}]}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7664777899544888`*^9, 3.766477789955488*^9}},
 CellLabel->
  "In[453]:=",ExpressionUUID->"96d017a4-6495-428a-83e1-03aea584db81"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Region2Mesh2", "[", 
    RowBox[{"rg_", ",", "vol_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"h", "=", 
        RowBox[{"Head", "[", "rg", "]"}]}], ",", "x1", ",", "x2", ",", "ndim",
        ",", "dx", ",", "cd", ",", "ele"}], "}"}], ",", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"h", "\[Equal]", "Cuboid"}], " ", "||", " ", 
         RowBox[{"h", "\[Equal]", "Rectangle"}]}], ",", 
        RowBox[{
         RowBox[{"x1", "=", 
          RowBox[{"First", "@", "rg"}]}], ";", 
         RowBox[{"x2", "=", 
          RowBox[{"Last", "@", "rg"}]}], ";"}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", "\"\<region should be Cuboid or Rectangle\>\"", "]"}], 
         ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", "x1", "]"}]}], ";", 
      RowBox[{"dx", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1.0", "vol"}], ")"}], "^", 
        RowBox[{"(", 
         RowBox[{"1", "/", "ndim"}], ")"}]}]}], ";", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"cd", ",", "ele"}], "}"}], "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[Equal]", "2"}], ",", 
         RowBox[{"RectangleMesh", "[", 
          RowBox[{"x1", ",", "x2", ",", "dx"}], "]"}], ",", 
         RowBox[{"CuboidMesh", "[", 
          RowBox[{"x1", ",", "x2", ",", "dx"}], "]"}]}], "]"}]}], ";", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Abaqus2Mesh", "[", 
         RowBox[{"cd", ",", "ele"}], "]"}], ",", "cd", ",", "ele", ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}]}], "}"}]}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7664795568945513`*^9, 3.766479612321722*^9}, {
  3.7664800981755114`*^9, 3.766480149233432*^9}, {3.7664804670486097`*^9, 
  3.766480470293795*^9}, {3.766480601997328*^9, 3.7664806055395308`*^9}, {
  3.813906146232638*^9, 
  3.81390614740827*^9}},ExpressionUUID->"7cf8cf19-05c9-4829-925c-\
1b4962692ad7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ToElementMesh2", "[", 
    RowBox[{"rg_", ",", "vol_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"h", "=", 
        RowBox[{"Head", "[", "rg", "]"}]}], ",", "x1", ",", "x2", ",", "ndim",
        ",", "dx", ",", "cd", ",", "ele"}], "}"}], ",", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"h", "\[Equal]", "Cuboid"}], " ", "||", " ", 
         RowBox[{"h", "\[Equal]", "Rectangle"}]}], ",", 
        RowBox[{
         RowBox[{"x1", "=", 
          RowBox[{"First", "@", "rg"}]}], ";", 
         RowBox[{"x2", "=", 
          RowBox[{"Last", "@", "rg"}]}], ";"}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", "\"\<region should be Cuboid or Rectangle\>\"", "]"}], 
         ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", "x1", "]"}]}], ";", 
      RowBox[{"dx", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1.0", "vol"}], ")"}], "^", 
        RowBox[{"(", 
         RowBox[{"1", "/", "ndim"}], ")"}]}]}], ";", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"cd", ",", "ele"}], "}"}], "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[Equal]", "2"}], ",", 
         RowBox[{"RectangleMesh", "[", 
          RowBox[{"x1", ",", "x2", ",", "dx"}], "]"}], ",", 
         RowBox[{"CuboidMesh", "[", 
          RowBox[{"x1", ",", "x2", ",", "dx"}], "]"}]}], "]"}]}], ";", 
      RowBox[{"Abaqus2Mesh", "[", 
       RowBox[{"cd", ",", "ele"}], "]"}]}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.766480769780925*^9, 3.766480783173691*^9}, {
  3.8139061521052833`*^9, 
  3.8139061532311106`*^9}},ExpressionUUID->"8b675a3e-bdab-4a77-84f1-\
0778138c51af"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RectangleMesh", "[", 
    RowBox[{"x1_", ",", "x2_", ",", "dx_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n1", ",", "n2", ",", "cd", ",", 
       RowBox[{"ele", "=", 
        RowBox[{"{", "}"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n1", ",", "n2"}], "}"}], "=", 
       RowBox[{
        RowBox[{"Ceiling", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"x2", "-", "x1"}], ")"}], "/", "dx"}], "]"}], "+", "1"}]}],
       ";", 
      RowBox[{"cd", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"i", "-", "1"}], ",", 
             RowBox[{"j", "-", "1"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "n1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "n2"}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cd", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{"cd", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"x2", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"x1", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", 
           RowBox[{"(", 
            RowBox[{"n1", "-", "1"}], ")"}]}], ")"}]}], "+", 
        RowBox[{"x1", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cd", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{"cd", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"x2", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", 
             RowBox[{"x1", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "/", 
           RowBox[{"(", 
            RowBox[{"n2", "-", "1"}], ")"}]}], ")"}]}], "+", 
        RowBox[{"x1", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"ele", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"i", "-", "1"}], ")"}], " ", "n1"}], "+", "j"}], ",", 
            RowBox[{
             RowBox[{"i", " ", "n1"}], "+", "j"}], ",", 
            RowBox[{
             RowBox[{"i", " ", "n1"}], "+", "j", "+", "1"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"i", "-", "1"}], ")"}], "n1"}], "+", "j", "+", "1"}]}],
            "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"n2", "-", "1"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"n1", "-", "1"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"{", 
       RowBox[{"cd", ",", "ele"}], "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CuboidMesh", "[", 
    RowBox[{"x1_", ",", "x2_", ",", "dx_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n1", ",", "n2", ",", "n3", ",", "cd", ",", 
       RowBox[{"ele", "=", 
        RowBox[{"{", "}"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n1", ",", "n2", ",", "n3"}], "}"}], "=", 
       RowBox[{
        RowBox[{"Ceiling", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"x2", "-", "x1"}], ")"}], "/", "dx"}], "]"}], "+", "1"}]}],
       ";", 
      RowBox[{"cd", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"i", "-", "1"}], ",", 
             RowBox[{"j", "-", "1"}], ",", 
             RowBox[{"k", "-", "1"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "n1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "n2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", "n3"}], "}"}]}], "]"}], ",", "2"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cd", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{"cd", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"x2", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"x1", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", 
           RowBox[{"(", 
            RowBox[{"n1", "-", "1"}], ")"}]}], ")"}]}], "+", 
        RowBox[{"x1", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cd", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{"cd", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"x2", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", 
             RowBox[{"x1", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "/", 
           RowBox[{"(", 
            RowBox[{"n2", "-", "1"}], ")"}]}], ")"}]}], "+", 
        RowBox[{"x1", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cd", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "3"}], "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{"cd", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "3"}], "]"}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"x2", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "-", 
             RowBox[{"x1", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], ")"}], "/", 
           RowBox[{"(", 
            RowBox[{"n3", "-", "1"}], ")"}]}], ")"}]}], "+", 
        RowBox[{"x1", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"ele", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], " ", "n1"}], "+", "j", "-", 
                "1"}], ")"}], "n2"}], "+", "k"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", "i", ")"}], " ", "n1"}], "+", "j", "-", "1"}], 
               ")"}], "n2"}], "+", "k"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", "i", ")"}], " ", "n1"}], "+", "j"}], ")"}], 
              "n2"}], "+", "k"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], " ", "n1"}], "+", "j"}], 
               ")"}], "n2"}], "+", "k"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], " ", "n1"}], "+", "j", "-", 
                "1"}], ")"}], "n2"}], "+", "k", "+", "1"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", "i", ")"}], " ", "n1"}], "+", "j", "-", "1"}], 
               ")"}], "n2"}], "+", "k", "+", "1"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", "i", ")"}], " ", "n1"}], "+", "j"}], ")"}], 
              "n2"}], "+", "k", "+", "1"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], " ", "n1"}], "+", "j"}], 
               ")"}], "n2"}], "+", "k", "+", "1"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "1", ",", 
          RowBox[{"n3", "-", "1"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"n2", "-", "1"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"n1", "-", "1"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"{", 
       RowBox[{"cd", ",", "ele"}], "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"RectangleMesh", "[", 
      RowBox[{"x1_", ",", "x2_", ",", "dx_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n1", ",", "n2", ",", "cd", ",", 
         RowBox[{"ele", "=", 
          RowBox[{"{", "}"}]}]}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n1", ",", "n2"}], "}"}], "=", 
         RowBox[{
          RowBox[{"Round", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x2", "-", "x1"}], ")"}], "/", "dx"}], "]"}], "+", 
          "1"}]}], ";", 
        RowBox[{"cd", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"i", "-", "1"}], ",", 
               RowBox[{"j", "-", "1"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "n1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "n2"}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"ele", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"i", "-", "1"}], ")"}], " ", "n1"}], "+", "j"}], ",", 
              RowBox[{
               RowBox[{"i", " ", "n1"}], "+", "j"}], ",", 
              RowBox[{
               RowBox[{"i", " ", "n1"}], "+", "j", "+", "1"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"i", "-", "1"}], ")"}], "n1"}], "+", "j", "+", 
               "1"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", 
            RowBox[{"n2", "-", "1"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"n1", "-", "1"}]}], "}"}]}], "]"}], ";", 
        RowBox[{"{", 
         RowBox[{"cd", ",", "ele"}], "}"}]}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"CuboidMesh", "[", 
      RowBox[{"x1_", ",", "x2_", ",", "dx_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n1", ",", "n2", ",", "n3", ",", "cd", ",", 
         RowBox[{"ele", "=", 
          RowBox[{"{", "}"}]}]}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n1", ",", "n2", ",", "n3"}], "}"}], "=", 
         RowBox[{
          RowBox[{"Round", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x2", "-", "x1"}], ")"}], "/", "dx"}], "]"}], "+", 
          "1"}]}], ";", 
        RowBox[{"cd", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"i", "-", "1"}], ",", 
               RowBox[{"j", "-", "1"}], ",", 
               RowBox[{"k", "-", "1"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "n1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "n2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "n3"}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"ele", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], " ", "n1"}], "+", "j", 
                  "-", "1"}], ")"}], "n2"}], "+", "k"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", "i", ")"}], " ", "n1"}], "+", "j", "-", "1"}],
                  ")"}], "n2"}], "+", "k"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", "i", ")"}], " ", "n1"}], "+", "j"}], ")"}], 
                "n2"}], "+", "k"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], " ", "n1"}], "+", "j"}], 
                 ")"}], "n2"}], "+", "k"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], " ", "n1"}], "+", "j", 
                  "-", "1"}], ")"}], "n2"}], "+", "k", "+", "1"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", "i", ")"}], " ", "n1"}], "+", "j", "-", "1"}],
                  ")"}], "n2"}], "+", "k", "+", "1"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", "i", ")"}], " ", "n1"}], "+", "j"}], ")"}], 
                "n2"}], "+", "k", "+", "1"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], " ", "n1"}], "+", "j"}], 
                 ")"}], "n2"}], "+", "k", "+", "1"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "1", ",", 
            RowBox[{"n3", "-", "1"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", 
            RowBox[{"n2", "-", "1"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"n1", "-", "1"}]}], "}"}]}], "]"}], ";", 
        RowBox[{"{", 
         RowBox[{"cd", ",", "ele"}], "}"}]}]}], "]"}]}], ";"}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7664780198646383`*^9, 3.7664781798477893`*^9}, {
  3.7664784399196644`*^9, 3.766478451106304*^9}, {3.7664785154859867`*^9, 
  3.7664785465167613`*^9}, {3.766478670697864*^9, 3.7664788568195095`*^9}, {
  3.7664788881633024`*^9, 3.766478892444547*^9}, {3.766478923156304*^9, 
  3.7664789234833226`*^9}, {3.766479005556017*^9, 3.7664791026505704`*^9}, {
  3.7664794166595306`*^9, 3.7664794230928984`*^9}, {3.7664794590879574`*^9, 
  3.766479460248024*^9}, {3.766479633923958*^9, 3.7664797955101995`*^9}, {
  3.7664798595258613`*^9, 3.7664798818191366`*^9}, {3.7664800366559925`*^9, 
  3.7664800444344373`*^9}, {3.7664805773339176`*^9, 3.766480577604933*^9}},
 CellLabel->
  "In[456]:=",ExpressionUUID->"17024ff7-cee8-4403-9d7d-be8b41330e8b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NOMCombineVarsToArray", "[", "x__", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"narg", ",", 
      RowBox[{"x2", "=", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"x3", "=", 
       RowBox[{"{", "x", "}"}]}], ",", 
      RowBox[{"ds", "=", 
       RowBox[{"{", "}"}]}], ",", "dsi", ",", "nnode", ",", "nnodeMax", ",", 
      "res", ",", 
      RowBox[{"len", "=", "1"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"narg", "=", 
      RowBox[{"Length", "[", "x3", "]"}]}], ";", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"dsi", "=", 
         RowBox[{"Dimensions", "[", 
          RowBox[{"x3", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ";", 
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "dsi", "]"}], "\[Equal]", "0"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ds", ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "1"}], "}"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"Length", "[", "dsi", "]"}], "\[Equal]", "1"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ds", ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", 
              RowBox[{"dsi", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"Length", "[", "dsi", "]"}], "\[Equal]", "2"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ds", ",", "dsi"}], "]"}], ",", 
          RowBox[{
           RowBox[{"Length", "[", "dsi", "]"}], ">", "2"}], ",", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<Error,\>\"", ",", "i", ",", 
             "\"\<-th variable is not scalar, vector, or matrix, Abort\>\""}],
             "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "narg"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"nnode", "=", 
      RowBox[{"Max", "[", 
       RowBox[{"ds", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"nnode", "<", "3"}], ",", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Warning, only \>\"", ",", 
          RowBox[{"ToString", "[", "nnode", "]"}], ",", 
          "\"\< node(s) in the model, please check\>\""}], "]"}], ";"}]}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "nnode"}], "}"}], ",", 
            RowBox[{"ds", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "]"}]}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Error, two length of matrice detected,please check\>\"", 
           "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "narg"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"res", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", 
        RowBox[{"{", 
         RowBox[{"nnode", ",", 
          RowBox[{"Total", "[", 
           RowBox[{"ds", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ds", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "1"}], "]"}], "]"}], "\[Equal]", "1"}], " ", "&&",
            " ", 
           RowBox[{
            RowBox[{"ds", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2"}], "]"}], "]"}], ">", "1"}]}], ",", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"res", "[", 
              RowBox[{"[", 
               RowBox[{"j", ",", 
                RowBox[{"len", ";;", 
                 RowBox[{"(", 
                  RowBox[{"len", "+", 
                   RowBox[{"ds", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}], 
                  ")"}]}]}], "]"}], "]"}], "=", 
             RowBox[{"x3", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "nnode"}], "}"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"res", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", 
              RowBox[{"len", ";;", 
               RowBox[{"(", 
                RowBox[{"len", "+", 
                 RowBox[{"ds", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}], 
                ")"}]}]}], "]"}], "]"}], "=", 
           RowBox[{"x3", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}], ";", 
        RowBox[{"len", "+=", 
         RowBox[{"ds", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "2"}], "]"}], "]"}]}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "narg"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "res"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"res", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "5"}], "}"}]}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"version", " ", "number", " ", "10.1"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"res", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], "=", 
      RowBox[{"{", 
       RowBox[{"2", ",", "3"}], "}"}]}], ";", 
     RowBox[{
      RowBox[{"res", "//", 
       RowBox[{"MatrixForm", "\n", 
        TagBox[
         RowBox[{
          RowBox[{
           RowBox[{"when", " ", "row", " ", "of", " ", "res"}], "=", 
           RowBox[{"length", "[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "3"}], "}"}], "]"}]}], ",", 
          RowBox[{"wrong", " ", 
           RowBox[{"output", ":", 
            RowBox[{"(", "\[NoBreak]", GridBox[{
               {"0", "2", "2", "0", "0"},
               {"0", "3", "3", "0", "0"}
              },
              
              GridBoxAlignment->{
               "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
                "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
              GridBoxSpacings->{"Columns" -> {
                  Offset[0.27999999999999997`], {
                   Offset[0.7]}, 
                  Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, 
                "Rows" -> {
                  Offset[0.2], {
                   Offset[0.4]}, 
                  Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", 
             ")"}]}]}]}],
         Function[BoxForm`e$, 
          MatrixForm[BoxForm`e$]]], "\n", "res"}]}], "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "5"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"res", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], "=", 
      RowBox[{"{", 
       RowBox[{"2", ",", "3"}], "}"}]}], ";", 
     RowBox[{"res", "//", 
      RowBox[{
       RowBox[{
       "MatrixForm", "\n", "when", " ", "row", " ", "number", " ", "of", " ", 
        "res"}], "!=", 
       RowBox[{"length", "[", 
        RowBox[{"{", 
         RowBox[{"2", ",", "3"}], "}"}], "]"}]}]}]}], ",", 
    RowBox[{"output", ":", 
     TagBox[
      RowBox[{"(", "\[NoBreak]", GridBox[{
         {"0", "2", "3", "0", "0"},
         {"0", "2", "3", "0", "0"},
         {"0", "2", "3", "0", "0"}
        },
        GridBoxAlignment->{
         "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
          "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
        GridBoxSpacings->{"Columns" -> {
            Offset[0.27999999999999997`], {
             Offset[0.7]}, 
            Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
            Offset[0.2], {
             Offset[0.4]}, 
            Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
      Function[BoxForm`e$, 
       MatrixForm[BoxForm`e$]]]}]}], "*)"}]}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdzDtIQgEAhWGVMAgpMQsqUSs0HKxuaA+oyIQICSKbQjAxQ0OzMGgIETEo
lyDUCsGiQF1CKUJ6iINRi4GZBhllCm4ltNRmD88dDh9n+Vu1S8p5GoVC4VQG
1+gqsam+JGMMi7phIOyTQvWOrw/qrgSTUOEPzsKzTaUeWgoMAzQYo1aYjlBt
8NWpd8AGzaoTPgrat+DuYe4I+mOJAMx0SYKQqZCEoMpaPIe3jfQY7CTUGcih
PWXhCNX/Dr8XiDKsHStVL1ZscwdZcONSyIbllL0Fbnu8PBg6fhHCwkVTB3SF
bXLocJdIkyliBlaJpaR83r6W/NEQaZLP9sPRtJnUs5xNQM1BzR18vuFm4Nde
hHQ8cv8GB8uiPDQRzYQZnZU6CTz5FPbD6/LfAJyw2OVQMjQ3DT9Op3SQ+WAm
jeeNLpizF72wN5756Vkvybgu1i/8B5UKzF0=
  "],ExpressionUUID->"c9aef998-52e3-4ac2-a96a-3ecc4fd468a5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MyReplaceAll", "[", 
   RowBox[{"a_", ",", "rule_"}], "]"}], ":=", "\n", 
  RowBox[{"Block", "[", "\n", "    ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sop", ",", "vop", ",", "v1", ",", "v2", ",", "r2"}], "}"}], ",",
     "\n", "\t", 
    RowBox[{
     RowBox[{"vop", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "rule", "}"}], "]"}]}], ";", "\n", "\t", 
     RowBox[{"v1", "=", 
      RowBox[{"vop", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
     RowBox[{"v2", "=", 
      RowBox[{"vop", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
     RowBox[{"v1", "=", 
      RowBox[{"ToStringList", "[", "v1", "]"}]}], ";", 
     RowBox[{"v2", "=", 
      RowBox[{"ToStringList", "[", "v2", "]"}]}], ";", "\n", "\t", 
     RowBox[{"r2", "=", 
      RowBox[{"Rule", "@@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"v1", ",", "v2"}], "}"}], "\[Transpose]"}], ")"}]}]}], ";", 
     "\n", "\t", 
     RowBox[{"sop", "=", 
      RowBox[{"ToString", "[", 
       RowBox[{"InputForm", "[", "a", "]"}], "]"}]}], ";", "\n", "\t", 
     RowBox[{"sop", "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{"sop", ",", "r2"}], "]"}]}], ";", "\n", "\t", 
     RowBox[{"ToExpression", "[", "sop", "]"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToStringList", "[", "v_", "]"}], ":=", 
   RowBox[{"ToString", "[", 
    RowBox[{"InputForm", "[", "v", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ToStringList", "[", "v_List", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"ToStringList", "[", "#", "]"}], "&"}], "/@", "v"}]}], 
  ";"}]}], "Input",
 CellLabel->
  "In[471]:=",ExpressionUUID->"a61ac640-34d1-4e25-9eee-2c5edfd1e743"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Poly2Fraction", "[", "a_", "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"at", "=", 
       RowBox[{"Together", "[", "a", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Numerator", "[", "at", "]"}], ",", 
       RowBox[{"Denominator", "[", "at", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Poly2Fraction", "[", "a_List", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Poly2Fraction", "[", "#", "]"}], "&"}], "/@", "a"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7694822476327767`*^9, 3.769482253587117*^9}},
 CellLabel->
  "In[474]:=",ExpressionUUID->"3fdd37c4-14fd-4677-90fa-d15cdc879fee"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ListMemo", "[", "]"}], ":=", 
   RowBox[{"Column", "@", 
    RowBox[{"Thread", "@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Names", "[", "\"\<Global`*\>\"", "]"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"ByteCount", "[", "#", "]"}], "&"}], "/@", 
        RowBox[{"ToExpression", "/@", 
         RowBox[{"Names", "[", "\"\<Global`*\>\"", "]"}]}]}]}], "}"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ListMemo2", "[", 
    RowBox[{"mByte_", ":", "1."}], "]"}], ":=", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"Sort", "[", 
      RowBox[{
       RowBox[{"Thread", "@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Names", "[", "\"\<Global`*\>\"", "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ByteCount", "[", "#", "]"}], "/", 
             RowBox[{"1024.", "^", "2"}]}], "&"}], "/@", 
           RowBox[{"ToExpression", "/@", 
            RowBox[{"Names", "[", "\"\<Global`*\>\"", "]"}]}]}]}], "}"}]}], 
       ",", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ">", 
         RowBox[{"#2", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "&"}]}], "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ">", "mByte"}], " ", "&"}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ClearInOut", "[", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"s1", "=", 
       RowBox[{"MemoryInUse", "[", "]"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Unprotect", "[", 
       RowBox[{"In", ",", "Out"}], "]"}], ";", "\n", 
      RowBox[{"Clear", "[", 
       RowBox[{"In", ",", "Out"}], "]"}], ";", 
      RowBox[{"Protect", "[", 
       RowBox[{"In", ",", "Out"}], "]"}], ";", 
      RowBox[{"s1", "-", 
       RowBox[{"MemoryInUse", "[", "]"}]}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyLauchKernel", "[", 
    RowBox[{"n_", ":", "$ProcessorCount"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"$KernelCount", "<", 
      RowBox[{"Min", "[", 
       RowBox[{"n", ",", "$ProcessorCount"}], "]"}]}], ",", 
     RowBox[{"LaunchKernels", "[", 
      RowBox[{
       RowBox[{"Min", "[", 
        RowBox[{"n", ",", "$ProcessorCount"}], "]"}], "-", "$KernelCount"}], 
      "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyCloseKernel`count", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyCloseKernel", "[", 
    RowBox[{"interval_", ":", "0"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"$KernelCount", "\[NotEqual]", "0"}], ",", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MyCloseKernel`count", "\[Equal]", "interval"}], ",", 
        RowBox[{
         RowBox[{"CloseKernels", "[", "]"}], ";", 
         RowBox[{"MyCloseKernel`count", "=", "0"}], ";"}], ",", 
        RowBox[{
         RowBox[{"MyCloseKernel`count", "++"}], ";"}]}], "]"}], ";"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FreeRAM`count", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FreeRAM", "[", 
    RowBox[{"interval_", ":", "0"}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"nk", "=", "$KernelCount"}], "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"FreeRAM`count", "\[Equal]", "interval"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Unprotect", "[", 
         RowBox[{"In", ",", "Out"}], "]"}], ";", 
        RowBox[{"Clear", "[", 
         RowBox[{"In", ",", "Out"}], "]"}], ";", 
        RowBox[{"Protect", "[", 
         RowBox[{"In", ",", "Out"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"nk", ">", "0"}], ",", 
          RowBox[{
           RowBox[{"CloseKernels", "[", "]"}], ";", 
           RowBox[{"LaunchKernels", "[", "nk", "]"}], ";"}]}], "]"}], ";", 
        RowBox[{"FreeRAM`count", "=", "0"}], ";"}], ",", 
       RowBox[{
        RowBox[{"FreeRAM`count", "++"}], ";"}]}], "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{
  3.7695194329826574`*^9, {3.769519571434576*^9, 3.769519585261367*^9}, {
   3.7695198118743286`*^9, 3.7695198126283717`*^9}, {3.7695750606272335`*^9, 
   3.769575161108981*^9}, {3.7695751962679915`*^9, 3.769575279591758*^9}, 
   3.769575398579563*^9, {3.769575711582466*^9, 3.769575737211932*^9}, {
   3.769575826502039*^9, 3.769575840843859*^9}, {3.769575922564533*^9, 
   3.7695759360273037`*^9}, {3.769576289646529*^9, 3.769576305830455*^9}, {
   3.769576529923272*^9, 3.7695766198434153`*^9}, 3.7695766697572703`*^9, {
   3.7733169496329465`*^9, 3.7733169553372726`*^9}},
 CellLabel->
  "In[476]:=",ExpressionUUID->"01653314-93c2-4dbe-94cc-37ab4f1c0723"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MyDot", "[", 
    RowBox[{"v1_", ",", "v2_"}], "]"}], ":=", 
   RowBox[{"v1", " ", "v2"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDot", "[", 
    RowBox[{"v1_List", ",", "v2_List"}], "]"}], ":=", 
   RowBox[{"v1", ".", "v2"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDot", "[", 
    RowBox[{"v1_", ",", "v2_List"}], "]"}], ":=", 
   RowBox[{"Print", "[", "\"\<Error,scalar.List\>\"", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDot", "[", 
    RowBox[{"v1_List", ",", "v2_"}], "]"}], ":=", 
   RowBox[{"Print", "[", "\"\<Error,List.scalar\>\"", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.770446282355153*^9, 3.7704463644318976`*^9}, {
  3.7704576155871096`*^9, 3.770457709326471*^9}},
 CellLabel->
  "In[484]:=",ExpressionUUID->"5488d6bd-65ed-4fec-a8bb-7f971a081be0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Symbol2Func", "[", 
    RowBox[{"f_", ",", "X_List"}], "]"}], ":=", 
   RowBox[{"f", "@@", "X"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Symbol2Func", "[", 
    RowBox[{"f_List", ",", "X_List"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Symbol2Func", "[", 
      RowBox[{"#", ",", "X"}], "]"}], "&"}], "/@", "f"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.770447337445609*^9, 3.7704473462772245`*^9}},
 CellLabel->
  "In[488]:=",ExpressionUUID->"713e086b-655d-48ad-8924-02c51b32bb52"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FunProperty", "[", "a_", "]"}], ":=", 
  RowBox[{
   RowBox[{"a", "[", 
    RowBox[{"{", "1", "}"}], "]"}], "[", "\"\<Methods\>\"", "]"}]}]], "Input",
 CellChangeTimes->{{3.7704741293096404`*^9, 3.770474151714922*^9}},
 CellLabel->
  "In[490]:=",ExpressionUUID->"c7ea3069-280a-4840-8226-42574a58bdfc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"allNumericQ", "[", "a_SparseArray", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ae", "=", 
        RowBox[{"a", "[", "\"\<NonzeroValues\>\"", "]"}]}], ",", 
       RowBox[{"res", "=", "True"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"NumericQ", "[", 
             RowBox[{"ae", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"res", "=", "False"}], ";", 
            RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ae", "]"}]}], "}"}]}], "]"}], ";", 
      "res"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"allNumericQ", "[", "a_", "]"}], ":=", 
   RowBox[{"NumericQ", "[", "a", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"allNumericQ", "[", "a_List", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"al", "=", 
        RowBox[{"Flatten", "[", "a", "]"}]}], ",", 
       RowBox[{"res", "=", "True"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"allNumericQ", "[", 
             RowBox[{"al", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"res", "=", "False"}], ";", 
            RowBox[{"Break", "[", "]"}]}]}], "]"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "al", "]"}]}], "}"}]}], "]"}], ";", 
      "res"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.770483411171877*^9, 3.7704834317790556`*^9}, {
  3.7704836252271204`*^9, 3.770483723896764*^9}, {3.7704837789539127`*^9, 
  3.7704838722252474`*^9}, {3.7704839427172794`*^9, 3.7704839436373324`*^9}, {
  3.77048397663922*^9, 3.7704839942232256`*^9}, {3.7704841191573715`*^9, 
  3.7704841748765583`*^9}},
 CellLabel->
  "In[491]:=",ExpressionUUID->"f062aafa-da9e-4dc0-85f5-499410fd3c08"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
https://mathematica.stackexchange.com/questions/1782/how-to-force-compile-to-\
return-multiple-results\
\>", "Subsection",
 CellChangeTimes->{
  3.793512160938863*^9},ExpressionUUID->"d98d7d3e-8dc7-4005-814f-\
17f35b61ef7b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"extractLists", "[", 
   RowBox[{"list_", "?", "VectorQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"vars", "=", 
       RowBox[{"Round", "@", 
        RowBox[{"First", "@", "list"}]}]}], ",", "rank", ",", "dim"}], "}"}], 
    ",", 
    RowBox[{
     RowBox[{"rank", "=", 
      RowBox[{"Round", "@", 
       RowBox[{"list", "[", 
        RowBox[{"[", 
         RowBox[{"2", ";;", 
          RowBox[{"1", "+", "vars"}]}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dim", "=", 
      RowBox[{"Round", "@", 
       RowBox[{"Internal`PartitionRagged", "[", 
        RowBox[{
         RowBox[{"list", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", "+", "vars"}], ";;", 
            RowBox[{"1", "+", "vars", "+", 
             RowBox[{"Total", "@", "rank"}]}]}], "]"}], "]"}], ",", "rank"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MapThread", "[", 
      RowBox[{"ArrayReshape", ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Internal`PartitionRagged", "[", 
          RowBox[{
           RowBox[{"list", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"2", "+", "vars", "+", 
               RowBox[{"Total", "@", "rank"}]}], ";;"}], "]"}], "]"}], ",", 
           RowBox[{"Times", "@@@", "dim"}]}], "]"}], ",", "dim"}], "}"}]}], 
      "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{"cf1", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"m", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "8", ",", "1", ",", "7"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "9", ",", "2", ",", "6"}], "}"}]}], "}"}]}], 
          ",", 
          RowBox[{"n", "=", 
           RowBox[{"{", 
            RowBox[{"0.301", ",", "0.98"}], "}"}]}], ",", 
          RowBox[{"p", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"2", ",", "7"}], "}"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"2", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0"}], "}"}]}], "}"}]}], "}"}]}]}], "}"}], 
        ",", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", "3", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"TensorRank", "[", "m", "]"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"TensorRank", "[", "n", "]"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"TensorRank", "[", "p", "]"}], "}"}], ",", 
          RowBox[{"Dimensions", "[", "m", "]"}], ",", 
          RowBox[{"Dimensions", "[", "n", "]"}], ",", 
          RowBox[{"Dimensions", "[", "p", "]"}], ",", 
          RowBox[{"Flatten", "@", "m"}], ",", 
          RowBox[{"Flatten", "@", "n"}], ",", 
          RowBox[{"Flatten", "@", "p"}]}], "]"}]}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7728072837171993`*^9, 3.7728072837181993`*^9}, 
   3.7728073550232773`*^9, {3.7935123101933994`*^9, 3.793512319553935*^9}},
 CellLabel->
  "In[494]:=",ExpressionUUID->"173de568-b680-4732-8881-dcdb3f737a44"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"cf1Test$$$", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"m", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "8", ",", "1", ",", "7"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "9", ",", "2", ",", "6"}], "}"}]}], "}"}]}], 
         ",", 
         RowBox[{"n", "=", 
          RowBox[{"{", 
           RowBox[{"0.301", ",", "0.98"}], "}"}]}], ",", 
         RowBox[{"p", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", "7"}], "}"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"2", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}]}], "}"}]}], "}"}]}]}], "}"}], 
       ",", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "3", "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"TensorRank", "[", "m", "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"TensorRank", "[", "n", "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"TensorRank", "[", "p", "]"}], "}"}], ",", 
         RowBox[{"Dimensions", "[", "m", "]"}], ",", 
         RowBox[{"Dimensions", "[", "n", "]"}], ",", 
         RowBox[{"Dimensions", "[", "p", "]"}], ",", 
         RowBox[{"Flatten", "@", "m"}], ",", 
         RowBox[{"Flatten", "@", "n"}], ",", 
         RowBox[{"Flatten", "@", "p"}]}], "]"}]}], "]"}]}], "]"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.77280735261614*^9, 3.7728073669599605`*^9}, 
   3.834033415046801*^9},ExpressionUUID->"b6d5d201-19b5-4e4c-8f26-\
093dd6097fbb"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Result output to external files", "Section",
 CellChangeTimes->{{3.778345222552436*^9, 
  3.778345241201502*^9}},ExpressionUUID->"4919b444-bf6c-49bb-8106-\
7de361890102"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"CompactString", "[", 
    RowBox[{"a_List", ",", 
     RowBox[{"ndigit_", ":", "6"}], ",", 
     RowBox[{"sep_", ":", "\"\< \>\""}], ",", 
     RowBox[{"tol_", ":", 
      RowBox[{"10.", "^", 
       RowBox[{"-", "20"}]}]}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"as", "=", "\"\<\>\""}], ",", "ai", ",", "af", ",", "ais"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"NumberQ", "[", 
             RowBox[{"a", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"as", "=", 
             RowBox[{"StringJoin", "[", 
              RowBox[{"as", ",", "sep", ",", "\"\<NaN\>\""}], "]"}]}], ";", 
            RowBox[{"Continue", "[", "]"}]}]}], "]"}], ";", 
         RowBox[{"ai", "=", 
          RowBox[{"IntegerPart", "[", 
           RowBox[{"a", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ";", 
         RowBox[{"af", "=", 
          RowBox[{"FractionalPart", "[", 
           RowBox[{"a", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ";", 
         RowBox[{"ais", "=", "\[IndentingNewLine]", 
          RowBox[{"If", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"af", "==", "0."}], ",", "\[IndentingNewLine]", 
            RowBox[{"ToString", "[", "ai", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ai", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Abs", "[", "af", "]"}], "<", "tol"}], ",", 
                "\"\<0\>\"", ",", 
                RowBox[{"ToString", "[", 
                 RowBox[{"ScientificForm", "[", 
                  RowBox[{"af", ",", "ndigit", ",", 
                   RowBox[{"NumberFormat", "\[Rule]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Row", "[", 
                    RowBox[{"{", 
                    RowBox[{"#1", ",", "\"\<e\>\"", ",", "#3"}], "}"}], "]"}],
                     "&"}], ")"}]}]}], "]"}], "]"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Abs", "[", "ai", "]"}], "<", "10"}], ",", 
                RowBox[{"ToString", "[", 
                 RowBox[{"ScientificForm", "[", 
                  RowBox[{
                  "a", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                   "]"}], "]"}], ",", 
                RowBox[{"ToString", "[", 
                 RowBox[{"ScientificForm", "[", 
                  RowBox[{
                   RowBox[{
                   "a", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], ",", "ndigit", ",", 
                   RowBox[{"NumberFormat", "\[Rule]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Row", "[", 
                    RowBox[{"{", 
                    RowBox[{"#1", ",", "\"\<e\>\"", ",", "#3"}], "}"}], "]"}],
                     "&"}], ")"}]}]}], "]"}], "]"}]}], "]"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"as", "=", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"as", ",", "sep", ",", "ais"}], "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", "as"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CompactString2", "[", 
    RowBox[{"a_List", ",", 
     RowBox[{"ndigit_", ":", "6"}], ",", 
     RowBox[{"sep_", ":", "\"\< \>\""}], ",", 
     RowBox[{"tol_", ":", 
      RowBox[{"10.", "^", 
       RowBox[{"-", "20"}]}]}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"as", "=", "\"\<\>\""}], ",", "ai", ",", "af", ",", "ais"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ai", "=", 
          RowBox[{"N", "[", 
           RowBox[{"a", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"NumberQ", "[", 
             RowBox[{"a", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"as", "=", 
             RowBox[{"StringJoin", "[", 
              RowBox[{"as", ",", "sep", ",", "\"\<NaN\>\""}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Continue", "[", "]"}]}]}], "]"}], ";", 
         RowBox[{"ais", "=", 
          RowBox[{"Internal`DoubleToString", "[", 
           RowBox[{"ai", ",", "False", ",", "ndigit"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"as", "=", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"as", ",", "sep", ",", "ais"}], "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", "as"}]}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DoubleListToString", "[", 
    RowBox[{"a_List", ",", 
     RowBox[{"ndigit_", ":", "8"}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"as", "=", "\"\<\>\""}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"as", "=", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"as", ",", "\"\< \>\"", ",", 
            RowBox[{"Internal`DoubleToString", "[", 
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", "False", ",", "ndigit"}], 
             "]"}]}], "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"StringReplace", "[", 
       RowBox[{"as", ",", 
        RowBox[{"\"\<*^\>\"", "\[Rule]", "\"\<e\>\""}]}], "]"}]}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7781724331413574`*^9, 3.778172460336913*^9}, {
   3.7781725202693415`*^9, 3.7781725826939116`*^9}, {3.778172641668285*^9, 
   3.778172797294186*^9}, 3.7781728324911995`*^9, {3.7781728636379805`*^9, 
   3.778172865612094*^9}, {3.77817396264631*^9, 3.778173974532221*^9}, {
   3.7781740638643746`*^9, 3.7781741111730804`*^9}, {3.7781741474901576`*^9, 
   3.778174236094226*^9}, {3.7781744887272177`*^9, 3.7781744993588257`*^9}, {
   3.778174530714619*^9, 3.778174615537471*^9}, {3.7781747253617525`*^9, 
   3.778174824010395*^9}, {3.7781748588853893`*^9, 3.7781749558599358`*^9}, {
   3.778175105600501*^9, 3.7781752059412403`*^9}, {3.778175254411012*^9, 
   3.778175386485566*^9}, {3.7781755562362757`*^9, 3.778175621740022*^9}, {
   3.778204301774688*^9, 3.7782043458447657`*^9}, {3.7782044347025213`*^9, 
   3.778204484544609*^9}, {3.7782045816547794`*^9, 3.7782046324016685`*^9}, 
   3.778204744597066*^9, {3.7782049163221674`*^9, 3.7782049332637973`*^9}, {
   3.7782050027337193`*^9, 3.7782050152917414`*^9}, {3.7782051893735695`*^9, 
   3.778205224996607*^9}, {3.7782053930412183`*^9, 3.7782054832913804`*^9}, {
   3.7782055157972393`*^9, 3.7782055379695077`*^9}, {3.7782121031407146`*^9, 
   3.778212131439164*^9}, {3.7782121740896387`*^9, 3.778212181874053*^9}, {
   3.7782122479557686`*^9, 3.7782123663131766`*^9}, {3.7783276804734535`*^9, 
   3.7783276874578524`*^9}, {3.778327801281363*^9, 3.7783278356733303`*^9}, 
   3.7783279004730363`*^9, {3.7783279431674786`*^9, 3.7783279886020775`*^9}, {
   3.778328043480216*^9, 3.778328067062565*^9}, {3.778328136958563*^9, 
   3.7783281421868615`*^9}, {3.778328642750492*^9, 3.778328722915077*^9}, 
   3.7783288270130315`*^9, 3.7783292976747103`*^9, {3.778329328704485*^9, 
   3.7783293849037*^9}, {3.7783296768823996`*^9, 3.7783297099782925`*^9}, {
   3.778329796617248*^9, 3.778329797088275*^9}, {3.778329837103564*^9, 
   3.77832985854279*^9}, {3.778330014330701*^9, 3.7783300508287883`*^9}, {
   3.778330098674525*^9, 3.778330113068348*^9}, {3.7783302098868856`*^9, 
   3.7783302206385007`*^9}, {3.7783341364513984`*^9, 
   3.7783341647220154`*^9}, {3.7783421705513325`*^9, 
   3.7783421979606543`*^9}, {3.7783422707388167`*^9, 3.77834232674002*^9}, {
   3.778342370197506*^9, 3.77834237062453*^9}, {3.7783424242615976`*^9, 
   3.778342424528613*^9}},
 CellLabel->
  "In[496]:=",ExpressionUUID->"f275bb74-c552-4c60-bbbf-81cfc0cbe699"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CreateFolder", "[", "mydir_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"sn", "=", 
        RowBox[{"NotebookDirectory", "[", "]"}]}], ",", "dirname"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"dirname", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"sn", ",", "mydir"}], "}"}], "]"}]}], ";", 
      RowBox[{"Switch", "[", 
       RowBox[{
        RowBox[{"FileType", "[", "dirname", "]"}], ",", "None", ",", 
        RowBox[{"CreateDirectory", "[", "dirname", "]"}], " ", 
        RowBox[{"(*", 
         RowBox[{"create", " ", "dir"}], "*)"}], ",", "Directory", ",", 
        "Null", " ", 
        RowBox[{"(*", 
         RowBox[{"do", " ", "nothing"}], "*)"}], ",", "File", ",", 
        RowBox[{
        "Print", "[", "\"\<File with same name already exists!!\>\"", "]"}]}],
        " ", 
       RowBox[{"(*", 
        RowBox[{"error", "!"}], "*)"}], "]"}], ";", 
      RowBox[{"dirname", "<>", 
       RowBox[{"StringTake", "[", 
        RowBox[{"sn", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}]}]}]}], "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[499]:=",ExpressionUUID->"9a188ad9-b892-4484-abfc-a42f47d860b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OvitoOutput0", "[", 
    RowBox[{
    "path_String", ",", "fname_String", ",", "istep_", ",", "tag_", ",", 
     "x__"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"file", ",", "str", ",", 
       RowBox[{"xd", "=", 
        RowBox[{"{", "x", "}"}]}], ",", "len", ",", "num", ",", "al", ",", 
       "als", ",", "strl"}], "}"}], ",", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"path", ",", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"fname", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.txt\>\""}], 
           "]"}]}], "}"}], "]"}]}], ";", 
      RowBox[{"str", "=", 
       RowBox[{"OpenWrite", "[", "file", "]"}]}], ";", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "xd", "]"}]}], ";", 
      RowBox[{"num", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xd", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"strl", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"\"\<\>\"", ",", 
         RowBox[{"5", "+", "num"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteLine", "[", 
       RowBox[{"str", ",", "\"\<ITEM: TIMESTEP\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteLine", "[", 
       RowBox[{"str", ",", "istep"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteLine", "[", 
       RowBox[{"str", ",", "\"\<ITEM: NUMBER OF ATOMS\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteLine", "[", 
       RowBox[{"str", ",", "num"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteLine", "[", 
       RowBox[{"str", ",", 
        RowBox[{"\"\<ITEM: ATOMS id type \>\"", "<>", "tag"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"al", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"xd", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "i"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{"als", "=", 
          RowBox[{
           RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\< 1 \>\"", "<>", 
           RowBox[{"CompactString", "[", "al", "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"WriteLine", "[", 
          RowBox[{"str", ",", "als"}], "]"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "str", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Output: \>\"", ",", "file"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.778212748611598*^9, 3.7782127744450755`*^9}, {
   3.77821282837216*^9, 3.778212854623661*^9}, {3.77821294411578*^9, 
   3.7782129501711264`*^9}, {3.7782136557364826`*^9, 
   3.7782138360037932`*^9}, {3.7782138673575864`*^9, 
   3.7782139860513754`*^9}, {3.778214196908306*^9, 3.778214200896534*^9}, {
   3.7782142539845705`*^9, 3.7782142557836733`*^9}, {3.7782143993578854`*^9, 
   3.7782144590593*^9}, {3.778214493410265*^9, 3.7782145037558565`*^9}, {
   3.778214557612937*^9, 3.7782145615571623`*^9}, {3.778214750719982*^9, 
   3.7782147657688427`*^9}, {3.7782148645794945`*^9, 
   3.7782148650305204`*^9}, {3.778214970329543*^9, 3.7782149873775177`*^9}, {
   3.778215359615809*^9, 3.7782154061804724`*^9}, {3.778215458906488*^9, 
   3.7782155382060237`*^9}, {3.7782162177640524`*^9, 3.7782162530300694`*^9}, 
   3.7782194211253986`*^9, {3.7782194524741917`*^9, 3.778219461800725*^9}, {
   3.7782195144967394`*^9, 3.77821952744248*^9}, {3.778219632362481*^9, 
   3.7782196355376625`*^9}, 3.7782213233622007`*^9, 3.778223552308611*^9, {
   3.778223606824729*^9, 3.7782236124050484`*^9}},
 CellLabel->
  "In[500]:=",ExpressionUUID->"83a8766e-5b9e-4ba9-8b60-83854c7470a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OvitoOutput1", "[", 
    RowBox[{
    "path_String", ",", "fname_String", ",", "istep_", ",", "tag_", ",", 
     "x__"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"file", ",", "str", ",", 
       RowBox[{"xd", "=", 
        RowBox[{"{", "x", "}"}]}], ",", "len", ",", "num", ",", "al", ",", 
       "als", ",", "strl"}], "}"}], ",", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"path", ",", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"fname", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.txt\>\""}], 
           "]"}]}], "}"}], "]"}]}], ";", 
      RowBox[{"str", "=", 
       RowBox[{"OpenWrite", "[", "file", "]"}]}], ";", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "xd", "]"}]}], ";", 
      RowBox[{"num", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xd", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"strl", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"\"\<\>\"", ",", 
         RowBox[{"5", "+", "num"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteLine", "[", 
       RowBox[{"str", ",", "\"\<ITEM: TIMESTEP\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteLine", "[", 
       RowBox[{"str", ",", "istep"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteLine", "[", 
       RowBox[{"str", ",", "\"\<ITEM: NUMBER OF ATOMS\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteLine", "[", 
       RowBox[{"str", ",", "num"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteLine", "[", 
       RowBox[{"str", ",", 
        RowBox[{"\"\<ITEM: ATOMS id type \>\"", "<>", "tag"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"al", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"xd", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "i"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{"als", "=", 
          RowBox[{
           RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\< 1 \>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"N", "[", 
             RowBox[{"al", ",", "5"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"WriteLine", "[", 
          RowBox[{"str", ",", "als"}], "]"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "str", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Output: \>\"", ",", "file"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7782189253580427`*^9, 3.7782189452431803`*^9}, 
   3.778345614553857*^9},
 CellLabel->
  "In[501]:=",ExpressionUUID->"0aafdcd8-9ff4-4ea3-ab9d-295b327bbc61"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OvitoOutput", "[", 
     RowBox[{
     "path_String", ",", "fname_String", ",", "istep_", ",", "tag_", ",", 
      "x__"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"file", ",", "str", ",", 
        RowBox[{"xd", "=", 
         RowBox[{"{", "x", "}"}]}], ",", "len", ",", "num", ",", "al", ",", 
        "als", ",", "strl0", ",", "strl"}], "}"}], ",", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"path", ",", 
           RowBox[{"StringJoin", "[", 
            RowBox[{"fname", ",", 
             RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.txt\>\""}], 
            "]"}]}], "}"}], "]"}]}], ";", 
       RowBox[{"len", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"xd", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"DeleteCases", "[", 
            RowBox[{
             RowBox[{"StringSplit", "[", 
              RowBox[{"tag", ",", 
               RowBox[{"{", 
                RowBox[{"\"\< \>\"", ",", "\"\<,\>\""}], "}"}]}], "]"}], ",", 
             "\"\<\>\""}], "]"}], "]"}], "\[NotEqual]", "len"}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Error, the tags are not consistent with the data, no data \
written\>\"", "]"}], ";", 
          RowBox[{"Return", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"num", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"xd", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"strl", "=", 
        RowBox[{"{", 
         RowBox[{"\"\<ITEM: TIMESTEP\>\"", ",", 
          RowBox[{"ToString", "[", "istep", "]"}], ",", 
          "\"\<ITEM: NUMBER OF ATOMS\>\"", ",", 
          RowBox[{"ToString", "[", "num", "]"}], ",", 
          RowBox[{"\"\<ITEM: ATOMS id type \>\"", "<>", "tag"}]}], "}"}]}], 
       ";", 
       RowBox[{"(*", 
        RowBox[{
        "table", " ", "seems", " ", "to", " ", "be", " ", "the", " ", 
         "best"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"strl0", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\< 1 \>\"", "<>", 
           RowBox[{"DoubleListToString", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"xd", "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", "i"}], "]"}], "]"}], "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "num"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{"file", ",", 
         RowBox[{"Join", "[", 
          RowBox[{"strl", ",", "strl0"}], "]"}], ",", "\"\<Text\>\""}], "]"}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Output: \>\"", ",", "file"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"OvitoOutput4", " ", "is", " ", "best"}], ",", " ", 
    RowBox[{"then", " ", "OvitoOutput"}], ",", " ", 
    RowBox[{"then", " ", "others"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"OvitoOutput4", "[", 
    RowBox[{
    "path_String", ",", "fname_String", ",", "istep_", ",", "tag_", ",", 
     "x__"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"file", ",", "str", ",", "xd0", ",", 
       RowBox[{"xd", "=", 
        RowBox[{"{", "x", "}"}]}], ",", "nx", ",", "xil", ",", "xil2", ",", 
       "xd2", ",", "len", ",", "num", ",", "al", ",", "als", ",", "strl0", 
       ",", "strl", ",", "colsep", ",", "rowsep", ",", "prec", ",", 
       "doubletostring"}], "}"}], ",", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"path", ",", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"fname", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.txt\>\""}], 
           "]"}]}], "}"}], "]"}]}], ";", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"xd", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nx", "=", 
       RowBox[{"Length", "[", "xd", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"num", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xd", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"StringSplit", "[", 
             RowBox[{"tag", ",", 
              RowBox[{"{", 
               RowBox[{"\"\< \>\"", ",", "\"\<,\>\""}], "}"}]}], "]"}], ",", 
            "\"\<\>\""}], "]"}], "]"}], "\[NotEqual]", "len"}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Error, the tags are not consistent with the data, no data \
written\>\"", "]"}], ";", 
         RowBox[{"Return", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"xd0", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"num", ",", 
           RowBox[{"len", "+", "2"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"num", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xd", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"xd0", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], "=", 
       RowBox[{"N", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "num"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"xil2", "=", "2"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"xil", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"xd", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"xd0", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{
              RowBox[{"xil2", "+", "1"}], ";;", 
              RowBox[{"xil2", "+", "xil"}]}]}], "]"}], "]"}], "=", 
          RowBox[{"xd", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{"xil2", "+=", "xil"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "nx"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"colsep", "=", "\"\<\\t\>\""}], ";", 
      RowBox[{"rowsep", "=", "\"\<\\n\>\""}], ";", 
      RowBox[{"prec", "=", "8"}], ";", 
      RowBox[{"SetAttributes", "[", 
       RowBox[{"doubletostring", ",", "Listable"}], "]"}], ";", 
      RowBox[{
       RowBox[{"doubletostring", "[", "xxx_", "]"}], ":=", 
       RowBox[{"Internal`DoubleToString", "[", 
        RowBox[{"xxx", ",", "False", ",", "prec"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"https", ":"}], "//", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
            "questions"}], "/", "170884"}], "/", "fast"}], "-", "matlab", "-",
          "slow", "-", "mathematica", "-", "export", "-", "a", "-", "matrix", 
         "-", "as", "-", "tsv"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"strl", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"Riffle", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<ITEM: TIMESTEP\>\"", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", 
            "\"\<ITEM: NUMBER OF ATOMS\>\"", ",", 
            RowBox[{"ToString", "[", "num", "]"}], ",", 
            RowBox[{"\"\<ITEM: ATOMS id type \>\"", "<>", "tag"}]}], "}"}], 
          ",", "rowsep"}], "]"}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
       "parallel", " ", "table", " ", "is", " ", "not", " ", "faster", " ", 
        "than", " ", "table"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"strl0", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"len", " ", "num"}], "<", "1000000"}], ",", 
         RowBox[{"StringJoin", "[", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{"row", "\[Function]", 
             RowBox[{"StringReplace", "[", 
              RowBox[{
               RowBox[{"StringJoin", "[", 
                RowBox[{
                 RowBox[{"Riffle", "[", 
                  RowBox[{
                   RowBox[{"doubletostring", "/@", "row"}], ",", "colsep"}], 
                  "]"}], ",", "rowsep"}], "]"}], ",", 
               RowBox[{"\"\<*^\>\"", "\[Rule]", "\"\<e\>\""}]}], "]"}]}], ",",
             "xd0"}], "]"}], "]"}], ",", 
         RowBox[{"StringJoin", "[", 
          RowBox[{"ParallelMap", "[", 
           RowBox[{
            RowBox[{"row", "\[Function]", 
             RowBox[{"StringReplace", "[", 
              RowBox[{
               RowBox[{"StringJoin", "[", 
                RowBox[{
                 RowBox[{"Riffle", "[", 
                  RowBox[{
                   RowBox[{"doubletostring", "@", "row"}], ",", "colsep"}], 
                  "]"}], ",", "rowsep"}], "]"}], ",", 
               RowBox[{"\"\<*^\>\"", "\[Rule]", "\"\<e\>\""}]}], "]"}]}], ",",
             "xd0"}], "]"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"file", ",", 
        RowBox[{"StringJoin", "[", 
         RowBox[{"strl", ",", "rowsep", ",", "strl0"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Output: \>\"", ",", "file"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"OvitoOutput34", "[", 
    RowBox[{
    "path_String", ",", "fname_String", ",", "istep_", ",", "tag_", ",", 
     "x__"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"file", ",", "str", ",", 
       RowBox[{"xd", "=", 
        RowBox[{"{", "x", "}"}]}], ",", "len", ",", "num", ",", "al", ",", 
       "als", ",", "strl0", ",", "strl"}], "}"}], ",", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"path", ",", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"fname", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.txt\>\""}], 
           "]"}]}], "}"}], "]"}]}], ";", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"xd", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"StringSplit", "[", 
             RowBox[{"tag", ",", 
              RowBox[{"{", 
               RowBox[{"\"\< \>\"", ",", "\"\<,\>\""}], "}"}]}], "]"}], ",", 
            "\"\<\>\""}], "]"}], "]"}], "\[NotEqual]", "len"}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Error, the tags are not consistent with the data, no data \
written\>\"", "]"}], ";", 
         RowBox[{"Return", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"num", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xd", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"strl", "=", 
       RowBox[{"{", 
        RowBox[{"\"\<ITEM: TIMESTEP\>\"", ",", 
         RowBox[{"ToString", "[", "istep", "]"}], ",", 
         "\"\<ITEM: NUMBER OF ATOMS\>\"", ",", 
         RowBox[{"ToString", "[", "num", "]"}], ",", 
         RowBox[{"\"\<ITEM: ATOMS id type \>\"", "<>", "tag"}]}], "}"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"strl0", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"\"\<\>\"", ",", "num"}], "]"}]}], ";", 
      RowBox[{"(*", "\"\<do is not better than table\>\"", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"strl0", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\< 1 \>\"", "<>", 
          RowBox[{"DoubleListToString", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"xd", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "i"}], "]"}], "]"}], "]"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"file", ",", 
        RowBox[{"Join", "[", 
         RowBox[{"strl", ",", "strl0"}], "]"}], ",", "\"\<Text\>\""}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Output: \>\"", ",", "file"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"OvitoOutput32323", "[", 
    RowBox[{
    "path_String", ",", "fname_String", ",", "istep_", ",", "tag_", ",", 
     "x__"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"file", ",", "str", ",", "xd0", ",", 
       RowBox[{"xd", "=", 
        RowBox[{"{", "x", "}"}]}], ",", "nx", ",", "xil", ",", "xil2", ",", 
       "xd2", ",", "len", ",", "num", ",", "al", ",", "als", ",", "strl0", 
       ",", "strl"}], "}"}], ",", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"path", ",", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"fname", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.txt\>\""}], 
           "]"}]}], "}"}], "]"}]}], ";", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"xd", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nx", "=", 
       RowBox[{"Length", "[", "xd", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"num", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xd", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"StringSplit", "[", 
             RowBox[{"tag", ",", 
              RowBox[{"{", 
               RowBox[{"\"\< \>\"", ",", "\"\<,\>\""}], "}"}]}], "]"}], ",", 
            "\"\<\>\""}], "]"}], "]"}], "\[NotEqual]", "len"}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Error, the tags are not consistent with the data, no data \
written\>\"", "]"}], ";", 
         RowBox[{"Return", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"xd0", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"num", ",", 
           RowBox[{"len", "+", "2"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"num", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xd", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"xd0", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], "=", 
       RowBox[{"N", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "num"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"xil2", "=", "2"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"xil", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"xd", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"xd0", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{
              RowBox[{"xil2", "+", "1"}], ";;", 
              RowBox[{"xil2", "+", "xil"}]}]}], "]"}], "]"}], "=", 
          RowBox[{"xd", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{"xil2", "+=", "xil"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "nx"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"strl", "=", 
       RowBox[{"{", 
        RowBox[{"\"\<ITEM: TIMESTEP\>\"", ",", 
         RowBox[{"ToString", "[", "istep", "]"}], ",", 
         "\"\<ITEM: NUMBER OF ATOMS\>\"", ",", 
         RowBox[{"ToString", "[", "num", "]"}], ",", 
         RowBox[{"\"\<ITEM: ATOMS id type \>\"", "<>", "tag"}]}], "}"}]}], 
      ";", 
      RowBox[{"(*", 
       RowBox[{
       "parallel", " ", "table", " ", "is", " ", "not", " ", "faster", " ", 
        "than", " ", "table"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"strl0", "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"DoubleListToString", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"xd0", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "num"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"file", ",", 
        RowBox[{"Join", "[", 
         RowBox[{"strl", ",", "strl0"}], "]"}], ",", "\"\<Text\>\""}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Output: \>\"", ",", "file"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.77834536460056*^9, 3.7783453920131283`*^9}, {
  3.7783454572818613`*^9, 3.778345555237464*^9}, {3.778462833472269*^9, 
  3.7784628344663258`*^9}, {3.778463067333645*^9, 3.778463158203842*^9}},
 CellLabel->
  "In[502]:=",ExpressionUUID->"3f701474-3e00-4c96-a643-81764a82c9ac"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MMsave", "[", 
    RowBox[{"path_String", ",", "fname_String", ",", "istep_", ",", "x__"}], 
    "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"file", ",", 
       RowBox[{"xd", "=", 
        RowBox[{"{", "x", "}"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"path", ",", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"fname", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.wdx\>\""}], 
           "]"}]}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"file", ",", "xd"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Output: \>\"", ",", "file"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MMread", "[", 
    RowBox[{"path_String", ",", "fname_String", ",", "istep_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "file", "}"}], ",", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"path", ",", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"fname", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.wdx\>\""}], 
           "]"}]}], "}"}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"str", "=", 
         RowBox[{"OpenWrite", "[", "file", "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Import", "[", "file", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellLabel->
  "In[506]:=",ExpressionUUID->"2787641a-c57e-4e0e-bdb3-3e14c4c9fcf1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CheckTextCommand", "[", "path_String", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "res", "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"FileExistsQ", "[", "path", "]"}], ",", 
       RowBox[{
        RowBox[{"res", "=", 
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{"path", ",", "String", ",", "1"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"StringStartsQ", "[", 
           RowBox[{"res", ",", "\"\<1\>\""}], "]"}], ",", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<Abort command was found in file: \>\"", ",", "path"}], "]"}],
            ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}]}]}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7811448654835653`*^9, 3.781144869426834*^9}},
 CellLabel->
  "In[508]:=",ExpressionUUID->"0bd05017-99cd-4e98-8195-3013ae4ba0b9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Eigensystem2", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"m", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"em", ",", "el", ",", "ev", ",", "a$", ",", "b$", ",", "c$"}],
         "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a$", ",", "b$", ",", "c$"}], "}"}], "=", 
         RowBox[{"Chop", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"m", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"m", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"m", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"em", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{"a$", "^", "2"}], "+", 
           RowBox[{"4", " ", 
            RowBox[{"b$", "^", "2"}]}], "-", 
           RowBox[{"2", " ", "a$", " ", "c$"}], "+", 
           RowBox[{"c$", "^", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"el", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"0.5", " ", 
            RowBox[{"(", 
             RowBox[{"a$", "+", "c$", "-", "em"}], ")"}]}], ",", 
           RowBox[{"0.5", " ", 
            RowBox[{"(", 
             RowBox[{"a$", "+", "c$", "+", "em"}], ")"}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ev", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"a$", "-", "c$", "-", "em", "+", 
             RowBox[{"10.", "^", 
              RowBox[{"-", "30"}]}]}], ",", 
            RowBox[{"2", " ", "b$"}]}], "}"}], "/", 
          RowBox[{"Sqrt", "[", 
           RowBox[{
            RowBox[{"10.", "^", 
             RowBox[{"-", "60"}]}], "+", 
            RowBox[{"4", " ", 
             RowBox[{"b$", "^", "2"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"a$", "-", "c$", "-", "em"}], ")"}], "^", "2"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"el", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"el", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"ev", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"ev", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"-", 
           RowBox[{"ev", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", 
          RowBox[{"ev", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}]}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7820462763245068`*^9, 3.782046277151554*^9}},
 CellLabel->
  "In[509]:=",ExpressionUUID->"0a7590e5-b735-4d3a-93d3-83d8628163e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Eigensystem3", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"m$", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "a$", ",", "b$", ",", "c$", ",", "d$", ",", "e$", ",", "f$", ",", 
         "dn$", ",", "dd$", ",", "cc$", ",", "bb$", ",", "d1$", ",", "d$1", 
         ",", "C$", ",", "r$$0", ",", 
         RowBox[{"nx$", "=", "1"}], ",", 
         RowBox[{"x1$", "=", "0."}], ",", 
         RowBox[{"x2$", "=", "0."}], ",", 
         RowBox[{"x3$", "=", "0."}], ",", "v1$", ",", "v2$", ",", "v3$", ",", 
         RowBox[{"tol$", "=", 
          RowBox[{"10.", "^", 
           RowBox[{"-", "24"}]}]}], ",", 
         RowBox[{"ndim", "=", 
          RowBox[{"Length", "[", "m$", "]"}]}]}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "a$", ",", "b$", ",", "c$", ",", "d$", ",", "e$", ",", "f$"}], 
          "}"}], "=", 
         RowBox[{"Chop", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}], ",", 
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", 
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dn$", "=", 
         RowBox[{
          RowBox[{"b$", " ", "b$"}], "+", 
          RowBox[{"c$", " ", "c$"}], "+", 
          RowBox[{"e$", " ", "e$"}]}]}], ";", 
        RowBox[{"(*", "p1", "*)"}], 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"v1$", ",", "v2$", ",", "v3$"}], "}"}], "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1.", ",", "0.", ",", "0."}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0.", ",", "1.", ",", "0."}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dn$", "<", 
           RowBox[{"10.", "^", 
            RowBox[{"-", "20"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x1$", ",", "x2$", ",", "x3$"}], "}"}], "=", 
            RowBox[{"{", 
             RowBox[{"a$", ",", "d$", ",", "f$"}], "}"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"nx$", "=", "1"}]}], ",", 
          RowBox[{
           RowBox[{"dd$", "=", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"a$", "+", "d$", "+", "f$"}], ")"}], "/", "3."}]}], ";", 
           RowBox[{"(*", "q", "*)"}], 
           RowBox[{"cc$", "=", 
            RowBox[{
             RowBox[{"a$", " ", "a$"}], "+", 
             RowBox[{"d$", " ", "d$"}], "+", 
             RowBox[{"f$", " ", "f$"}], "-", 
             RowBox[{"3", " ", "dd$", " ", "dd$"}], "+", 
             RowBox[{"2", " ", "dn$"}]}]}], ";", 
           RowBox[{"(*", "p2", "*)"}], 
           RowBox[{"bb$", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"cc$", "/", "6"}], "]"}]}], ";", 
           RowBox[{"(*", "p", "*)"}], 
           RowBox[{"d1$", "=", 
            RowBox[{
             RowBox[{"a$", " ", "d$", " ", "f$"}], "+", 
             RowBox[{"2", " ", "b$", " ", "e$", " ", "c$"}], "-", 
             RowBox[{"a$", " ", "e$", " ", "e$"}], "-", 
             RowBox[{"d$", " ", "c$", " ", "c$"}], "-", 
             RowBox[{"f$", " ", "b$", " ", "b$"}]}]}], ";", 
           RowBox[{"(*", "detA", "*)"}], 
           RowBox[{"d$1", "=", 
            RowBox[{"0.5", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"d1$", "+", 
                RowBox[{"dd$", " ", "dn$"}], "+", 
                RowBox[{"2", " ", 
                 RowBox[{"dd$", "^", "3"}]}], "-", 
                RowBox[{"dd$", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"a$", " ", "d$"}], "+", 
                   RowBox[{"a$", " ", "f$"}], "+", 
                   RowBox[{"d$", " ", "f$"}]}], ")"}]}]}], ")"}], "/", 
              RowBox[{"bb$", "^", "3"}]}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "d$1", "]"}], "\[GreaterEqual]", "1."}], 
             ",", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"d$1", "\[LessEqual]", 
                 RowBox[{"-", "1."}]}], ",", 
                RowBox[{
                 RowBox[{"nx$", "=", "2"}], ";", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"x1$", ",", "x3$"}], "}"}], "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"dd$", "+", "bb$"}], ",", 
                    RowBox[{"dd$", "-", 
                    RowBox[{"2", " ", "bb$"}]}]}], "}"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"x2$", "=", "x1$"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"d$1", "\[GreaterEqual]", "1."}], ",", 
                RowBox[{
                 RowBox[{"nx$", "=", "2"}], ";", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"x1$", ",", "x3$"}], "}"}], "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"dd$", "-", "bb$"}], ",", 
                    RowBox[{"dd$", "+", 
                    RowBox[{"2", " ", "bb$"}]}]}], "}"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"x2$", "=", "x1$"}]}]}], "]"}], ";"}], ",", 
             RowBox[{
              RowBox[{"C$", "=", 
               RowBox[{
                RowBox[{"ArcCos", "[", "d$1", "]"}], "/", "3."}]}], ";", 
              RowBox[{"nx$", "=", "3"}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"x1$", ",", "x2$"}], "}"}], "=", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"dd$", "+", 
                  RowBox[{"2", " ", "bb$", " ", 
                   RowBox[{"Cos", "[", "C$", "]"}]}]}], ",", 
                 RowBox[{"dd$", "+", 
                  RowBox[{"2", " ", "bb$", " ", 
                   RowBox[{"Cos", "[", 
                    RowBox[{"C$", "+", 
                    RowBox[{"2.", " ", 
                    RowBox[{"\[Pi]", "/", "3"}]}]}], "]"}]}]}]}], "}"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"x3$", "=", 
               RowBox[{
                RowBox[{"3", " ", "dd$"}], "-", "x1$", "-", "x2$"}]}], 
              ";"}]}], "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"nx$", "\[Equal]", "2"}], ",", 
          RowBox[{
           RowBox[{"v3$", "=", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"-", 
                RowBox[{"e$", "^", "2"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"d$", "-", "x3$"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"f$", "-", "x3$"}], ")"}]}]}], ",", 
              RowBox[{
               RowBox[{"c$", " ", "e$"}], "+", 
               RowBox[{"b$", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "f$"}], "+", "x3$"}], ")"}]}]}], ",", 
              RowBox[{
               RowBox[{"b$", " ", "e$"}], "+", 
               RowBox[{"c$", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "d$"}], "+", "x3$"}], ")"}]}]}]}], "}"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"r$$0", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"v3$", ".", "v3$"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"r$$0", "<", 
              RowBox[{"10.", "^", 
               RowBox[{"-", "20"}]}]}], ",", 
             RowBox[{"v3$", "=", 
              RowBox[{"{", 
               RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], ",", 
             RowBox[{"v3$", "*=", 
              RowBox[{"1.", "/", "r$$0"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"v2$", "=", 
            RowBox[{"v3$", "+", 
             RowBox[{"RandomReal", "[", 
              RowBox[{"1.", ",", "3"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"v2$", "-=", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"v3$", ".", "v2$"}], ")"}], " ", "v3$"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"v2$", "*=", 
            RowBox[{"1.", "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"v2$", ".", "v2$"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"v1$", "=", 
            RowBox[{"Cross", "[", 
             RowBox[{"v2$", ",", "v3$"}], "]"}]}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"nx$", "\[Equal]", "3"}], ",", 
          RowBox[{
           RowBox[{"v1$", "=", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"-", 
                RowBox[{"e$", "^", "2"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"d$", "-", "x1$"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"f$", "-", "x1$"}], ")"}]}]}], ",", 
              RowBox[{
               RowBox[{"c$", " ", "e$"}], "+", 
               RowBox[{"b$", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "f$"}], "+", "x1$"}], ")"}]}]}], ",", 
              RowBox[{
               RowBox[{"b$", " ", "e$"}], "+", 
               RowBox[{"c$", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "d$"}], "+", "x1$"}], ")"}]}]}]}], "}"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"r$$0", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"v1$", ".", "v1$"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"r$$0", "<", 
              RowBox[{"10.", "^", 
               RowBox[{"-", "20"}]}]}], ",", 
             RowBox[{"v1$", "=", 
              RowBox[{"{", 
               RowBox[{"1.", ",", "0.", ",", "0."}], "}"}]}], ",", 
             RowBox[{"v1$", "*=", 
              RowBox[{"1.", "/", "r$$0"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"v2$", "=", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"-", 
                RowBox[{"e$", "^", "2"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"d$", "-", "x2$"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"f$", "-", "x2$"}], ")"}]}]}], ",", 
              RowBox[{
               RowBox[{"c$", " ", "e$"}], "+", 
               RowBox[{"b$", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "f$"}], "+", "x2$"}], ")"}]}]}], ",", 
              RowBox[{
               RowBox[{"b$", " ", "e$"}], "+", 
               RowBox[{"c$", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "d$"}], "+", "x2$"}], ")"}]}]}]}], "}"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"r$$0", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"v2$", ".", "v2$"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"r$$0", "<", 
              RowBox[{"10.", "^", 
               RowBox[{"-", "20"}]}]}], ",", 
             RowBox[{"v2$", "=", 
              RowBox[{"{", 
               RowBox[{"0.", ",", "1.", ",", "0."}], "}"}]}], ",", 
             RowBox[{"v2$", "*=", 
              RowBox[{"1.", "/", "r$$0"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"v2$", "*=", 
            RowBox[{"1.", "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"v2$", ".", "v2$"}], "]"}]}]}], ";", 
           RowBox[{"v3$", "=", 
            RowBox[{"Cross", "[", 
             RowBox[{"v1$", ",", "v2$"}], "]"}]}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"x1$", ",", "x2$", ",", "x3$", ",", 
          RowBox[{"v1$", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"v1$", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"v1$", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"v2$", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"v2$", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"v2$", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"v3$", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"v3$", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"v3$", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}]}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.78175717278892*^9, 3.7817571993012953`*^9}, {
   3.7817572341515913`*^9, 3.781757251061932*^9}, {3.781757298433564*^9, 
   3.781757367702401*^9}, {3.781757463393224*^9, 3.781757467160351*^9}, {
   3.781757566894899*^9, 3.78175756858254*^9}, {3.781757639127449*^9, 
   3.781757677103404*^9}, {3.781757959947803*^9, 3.781757961833222*^9}, 
   3.781758001310038*^9, {3.7817580563613853`*^9, 3.7817580869687843`*^9}, {
   3.7817582166628733`*^9, 3.7817582174281607`*^9}, {3.781758268693912*^9, 
   3.781758286956876*^9}, {3.781758350064457*^9, 3.781758551265983*^9}, {
   3.781758597423705*^9, 3.781758598864194*^9}, {3.7817586304905033`*^9, 
   3.781758689719776*^9}, {3.781758911753969*^9, 3.781758953520502*^9}, {
   3.781759049039318*^9, 3.781759058282178*^9}, {3.781759331987029*^9, 
   3.7817593970449247`*^9}, {3.781759819117395*^9, 3.781759825743655*^9}, {
   3.781759875471686*^9, 3.781759877614168*^9}, 3.7817600991014214`*^9, {
   3.782046281949828*^9, 3.782046282782876*^9}},
 CellLabel->
  "In[510]:=",ExpressionUUID->"753d2943-a05b-4c2e-8947-3668c1b905d8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Eigenvalues2", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"m", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"em", ",", "a$", ",", "b$", ",", "c$"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a$", ",", "b$", ",", "c$"}], "}"}], "=", 
         RowBox[{"Chop", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"m", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"m", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"m", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"em", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{"a$", "^", "2"}], "+", 
           RowBox[{"4", " ", 
            RowBox[{"b$", "^", "2"}]}], "-", 
           RowBox[{"2", " ", "a$", " ", "c$"}], "+", 
           RowBox[{"c$", "^", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0.5", " ", 
           RowBox[{"(", 
            RowBox[{"a$", "+", "c$", "-", "em"}], ")"}]}], ",", 
          RowBox[{"0.5", " ", 
           RowBox[{"(", 
            RowBox[{"a$", "+", "c$", "+", "em"}], ")"}]}]}], "}"}]}]}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7820462763245068`*^9, 3.7820463471095552`*^9}},
 CellLabel->
  "In[511]:=",ExpressionUUID->"28a65ebb-f4d6-4e8e-aa3a-858c0f1d69d4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Eigenvalues3", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"m$", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "a$", ",", "b$", ",", "c$", ",", "d$", ",", "e$", ",", "f$", ",", 
         "dn$", ",", "dd$", ",", "cc$", ",", "bb$", ",", "d1$", ",", "d$1", 
         ",", "C$", ",", "r$$0", ",", 
         RowBox[{"nx$", "=", "1"}], ",", 
         RowBox[{"x1$", "=", "0."}], ",", 
         RowBox[{"x2$", "=", "0."}], ",", 
         RowBox[{"x3$", "=", "0."}], ",", "v1$", ",", "v2$", ",", "v3$", ",", 
         RowBox[{"tol$", "=", 
          RowBox[{"10.", "^", 
           RowBox[{"-", "24"}]}]}], ",", 
         RowBox[{"ndim", "=", 
          RowBox[{"Length", "[", "m$", "]"}]}]}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "a$", ",", "b$", ",", "c$", ",", "d$", ",", "e$", ",", "f$"}], 
          "}"}], "=", 
         RowBox[{"Chop", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}], ",", 
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", 
            RowBox[{"m$", "[", 
             RowBox[{"[", 
              RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dn$", "=", 
         RowBox[{
          RowBox[{"b$", " ", "b$"}], "+", 
          RowBox[{"c$", " ", "c$"}], "+", 
          RowBox[{"e$", " ", "e$"}]}]}], ";", 
        RowBox[{"(*", "p1", "*)"}], 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"v1$", ",", "v2$", ",", "v3$"}], "}"}], "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1.", ",", "0.", ",", "0."}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0.", ",", "1.", ",", "0."}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dn$", "<", 
           RowBox[{"10.", "^", 
            RowBox[{"-", "20"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x1$", ",", "x2$", ",", "x3$"}], "}"}], "=", 
            RowBox[{"{", 
             RowBox[{"a$", ",", "d$", ",", "f$"}], "}"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"nx$", "=", "1"}]}], ",", 
          RowBox[{
           RowBox[{"dd$", "=", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"a$", "+", "d$", "+", "f$"}], ")"}], "/", "3."}]}], ";", 
           RowBox[{"(*", "q", "*)"}], 
           RowBox[{"cc$", "=", 
            RowBox[{
             RowBox[{"a$", " ", "a$"}], "+", 
             RowBox[{"d$", " ", "d$"}], "+", 
             RowBox[{"f$", " ", "f$"}], "-", 
             RowBox[{"3", " ", "dd$", " ", "dd$"}], "+", 
             RowBox[{"2", " ", "dn$"}]}]}], ";", 
           RowBox[{"(*", "p2", "*)"}], 
           RowBox[{"bb$", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"cc$", "/", "6"}], "]"}]}], ";", 
           RowBox[{"(*", "p", "*)"}], 
           RowBox[{"d1$", "=", 
            RowBox[{
             RowBox[{"a$", " ", "d$", " ", "f$"}], "+", 
             RowBox[{"2", " ", "b$", " ", "e$", " ", "c$"}], "-", 
             RowBox[{"a$", " ", "e$", " ", "e$"}], "-", 
             RowBox[{"d$", " ", "c$", " ", "c$"}], "-", 
             RowBox[{"f$", " ", "b$", " ", "b$"}]}]}], ";", 
           RowBox[{"(*", "detA", "*)"}], 
           RowBox[{"d$1", "=", 
            RowBox[{"0.5", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"d1$", "+", 
                RowBox[{"dd$", " ", "dn$"}], "+", 
                RowBox[{"2", " ", 
                 RowBox[{"dd$", "^", "3"}]}], "-", 
                RowBox[{"dd$", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"a$", " ", "d$"}], "+", 
                   RowBox[{"a$", " ", "f$"}], "+", 
                   RowBox[{"d$", " ", "f$"}]}], ")"}]}]}], ")"}], "/", 
              RowBox[{"bb$", "^", "3"}]}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "d$1", "]"}], "\[GreaterEqual]", "1."}], 
             ",", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"d$1", "\[LessEqual]", 
                 RowBox[{"-", "1."}]}], ",", 
                RowBox[{
                 RowBox[{"nx$", "=", "2"}], ";", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"x1$", ",", "x3$"}], "}"}], "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"dd$", "+", "bb$"}], ",", 
                    RowBox[{"dd$", "-", 
                    RowBox[{"2", " ", "bb$"}]}]}], "}"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"x2$", "=", "x1$"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"d$1", "\[GreaterEqual]", "1."}], ",", 
                RowBox[{
                 RowBox[{"nx$", "=", "2"}], ";", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"x1$", ",", "x3$"}], "}"}], "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"dd$", "-", "bb$"}], ",", 
                    RowBox[{"dd$", "+", 
                    RowBox[{"2", " ", "bb$"}]}]}], "}"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"x2$", "=", "x1$"}]}]}], "]"}], ";"}], ",", 
             RowBox[{
              RowBox[{"C$", "=", 
               RowBox[{
                RowBox[{"ArcCos", "[", "d$1", "]"}], "/", "3."}]}], ";", 
              RowBox[{"nx$", "=", "3"}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"x1$", ",", "x2$"}], "}"}], "=", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"dd$", "+", 
                  RowBox[{"2", " ", "bb$", " ", 
                   RowBox[{"Cos", "[", "C$", "]"}]}]}], ",", 
                 RowBox[{"dd$", "+", 
                  RowBox[{"2", " ", "bb$", " ", 
                   RowBox[{"Cos", "[", 
                    RowBox[{"C$", "+", 
                    RowBox[{"2.", " ", 
                    RowBox[{"\[Pi]", "/", "3"}]}]}], "]"}]}]}]}], "}"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"x3$", "=", 
               RowBox[{
                RowBox[{"3", " ", "dd$"}], "-", "x1$", "-", "x2$"}]}], 
              ";"}]}], "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"x1$", ",", "x2$", ",", "x3$"}], "}"}]}]}], "]"}]}], "]"}]}],
   ";"}]], "Input",
 CellChangeTimes->{{3.78175717278892*^9, 3.7817571993012953`*^9}, {
   3.7817572341515913`*^9, 3.781757251061932*^9}, {3.781757298433564*^9, 
   3.781757367702401*^9}, {3.781757463393224*^9, 3.781757467160351*^9}, {
   3.781757566894899*^9, 3.78175756858254*^9}, {3.781757639127449*^9, 
   3.781757677103404*^9}, {3.781757959947803*^9, 3.781757961833222*^9}, 
   3.781758001310038*^9, {3.7817580563613853`*^9, 3.7817580869687843`*^9}, {
   3.7817582166628733`*^9, 3.7817582174281607`*^9}, {3.781758268693912*^9, 
   3.781758286956876*^9}, {3.781758350064457*^9, 3.781758551265983*^9}, {
   3.781758597423705*^9, 3.781758598864194*^9}, {3.7817586304905033`*^9, 
   3.781758689719776*^9}, {3.781758911753969*^9, 3.781758953520502*^9}, {
   3.781759049039318*^9, 3.781759058282178*^9}, {3.781759331987029*^9, 
   3.7817593970449247`*^9}, {3.781759819117395*^9, 3.781759825743655*^9}, {
   3.781759875471686*^9, 3.781759877614168*^9}, 3.7817600991014214`*^9, {
   3.782046281949828*^9, 3.782046282782876*^9}, {3.782046353357913*^9, 
   3.7820463556450434`*^9}, {3.7820463988625154`*^9, 3.782046399395546*^9}, 
   3.7820464778500333`*^9},
 CellLabel->
  "In[512]:=",ExpressionUUID->"bb226940-47ec-4b80-9f63-bdedff01cddd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Area23", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"m", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"nr", "=", 
          RowBox[{"Length", "[", "m", "]"}]}], ",", 
         RowBox[{"nc", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"m", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "im"}], "}"}], ",", 
       RowBox[{
        RowBox[{"im", "=", "0."}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "2"}], "&&", 
           RowBox[{"nr", "\[Equal]", "1"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Sqrt", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"m", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
             RowBox[{
              RowBox[{"m", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}]}], "]"}], 
           "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"Length", " ", "of", " ", "line", " ", "in", " ", "2", "D"}],
          "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "2"}], "&&", 
           RowBox[{"nr", "\[Equal]", "2"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", 
              RowBox[{"m", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"Area", " ", "in", " ", "2", "D"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "3"}], "&&", 
           RowBox[{"nr", "\[Equal]", "1"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Sqrt", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"m", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
             RowBox[{
              RowBox[{"m", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
             RowBox[{
              RowBox[{"m", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}]}], "]"}], 
           "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"Length", " ", "of", " ", "line", " ", "in", " ", "3", "D"}],
          "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "3"}], "&&", 
           RowBox[{"nr", "\[Equal]", "2"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Sqrt", "[", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}], "2"], 
             "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "-", 
                RowBox[{
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}], "2"], 
             "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}], "2"]}], 
            "]"}], "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"(*", 
          RowBox[{"Area", " ", "in", " ", "3", "D"}], "*)"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "3"}], "&&", 
           RowBox[{"nr", "\[Equal]", "3"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", 
              RowBox[{"m", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"Volume", " ", "in", " ", "3", "D"}], "*)"}], 
        "\[IndentingNewLine]", "im"}]}], "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7827534321904964`*^9, 3.78275363645818*^9}, {
  3.782753679970669*^9, 3.7827539354862833`*^9}, {3.7827539881482954`*^9, 
  3.7827540040632057`*^9}, {3.782755756722452*^9, 3.7827558050192146`*^9}, {
  3.7827560226006594`*^9, 3.7827560525043697`*^9}, {3.782756223413145*^9, 
  3.7827562677286797`*^9}, {3.7827566700286903`*^9, 3.782756672508832*^9}, {
  3.782757509566709*^9, 3.7827575776916056`*^9}, {3.7827576130496283`*^9, 
  3.782757707391024*^9}, {3.7827577415129757`*^9, 3.7827577750478935`*^9}, {
  3.782788468556866*^9, 3.7827884823296537`*^9}},
 CellLabel->
  "In[513]:=",ExpressionUUID->"2d18e92a-e288-4b95-88c0-e2390be6b987"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"return", " ", "the", " ", 
    RowBox[{"(", 
     RowBox[{"pseudo", "-"}], ")"}], "inverse", " ", "of", " ", "low", " ", 
    "order", " ", "matrix"}], ",", " ", 
   RowBox[{"2", "d"}], ",", " ", 
   RowBox[{"3", "d"}], ",", " ", 
   RowBox[{
    RowBox[{"the", " ", "row"}], "\[LessEqual]", " ", "column"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ndim", "=", "2"}], ";", 
    RowBox[{"nr", "=", "2"}], ";", 
    RowBox[{"m", "=", 
     RowBox[{"RandomReal", "[", 
      RowBox[{"1", ",", 
       RowBox[{"{", 
        RowBox[{"nr", ",", "ndim"}], "}"}]}], "]"}]}], ";", 
    RowBox[{
     RowBox[{
      RowBox[{"Inverse23", "[", "m", "]"}], "//", 
      RowBox[{"AbsoluteTiming", "\[IndentingNewLine]", 
       RowBox[{"Inverse", "[", "m", "]"}]}]}], "//", 
     RowBox[{"AbsoluteTiming", "\[IndentingNewLine]", 
      RowBox[{"m", ".", 
       RowBox[{"Inverse23", "[", "m", "]"}]}]}]}]}]}], "\[IndentingNewLine]", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.7827548960002213`*^9, 3.7827549422408667`*^9}, {
   3.7827550024973125`*^9, 3.7827550051634655`*^9}, 3.782758162364047*^9},
 CellLabel->
  "In[514]:=",ExpressionUUID->"373e2789-972b-490f-86da-1cdb6b6a0bba"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Inverse23", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"m", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"nr", "=", 
          RowBox[{"Length", "[", "m", "]"}]}], ",", 
         RowBox[{"nc", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"m", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "im"}], "}"}], ",", 
       RowBox[{
        RowBox[{"im", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", "nc", "}"}], ",", 
           RowBox[{"{", "nr", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"nr", ">", "3"}], " ", "||", " ", 
             RowBox[{"nc", ">", "nr"}]}], ",", 
            RowBox[{"Return", "[", "im", "]"}]}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "2"}], "&&", 
           RowBox[{"nr", "\[Equal]", "1"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"m", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                ")"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"m", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "2"}], "]"}], "]"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                ")"}]}], "}"}]}], "}"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "2"}], "&&", 
           RowBox[{"nr", "\[Equal]", "2"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"m", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2"}], "]"}], "]"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{"-", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "/", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}]}], 
                 ")"}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "/", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}]}], 
                 ")"}]}], ",", 
               RowBox[{
                RowBox[{"m", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}]}]}], 
              "}"}]}], "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "3"}], "&&", 
           RowBox[{"nr", "\[Equal]", "1"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"m", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                ")"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"m", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "2"}], "]"}], "]"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                ")"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"m", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "3"}], "]"}], "]"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                ")"}]}], "}"}]}], "}"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "3"}], "&&", 
           RowBox[{"nr", "\[Equal]", "2"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "-", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}]}]}], 
                 ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}]}], ")"}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "-", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}]}]}], 
                 ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}]}], ")"}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "-", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}]}]}], 
                 ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], "-", 
                  RowBox[{"2", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}], "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ")"}]}]}], ")"}]}]}], "}"}]}], "}"}], "]"}]}], "]"}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "3"}], "&&", 
           RowBox[{"nr", "\[Equal]", "3"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}]}], 
              "}"}]}], "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        "im"}]}], "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7827541468623734`*^9, 3.782754152698707*^9}, {
   3.782754475921194*^9, 3.782754485597748*^9}, {3.782754665522039*^9, 
   3.782754668358201*^9}, {3.782754717538014*^9, 3.7827548046429963`*^9}, {
   3.782755083348937*^9, 3.7827550884022264`*^9}, 3.7827579329569254`*^9},
 CellLabel->
  "In[515]:=",ExpressionUUID->"9dde3fee-bfe7-49ac-b3e7-9bcba3d6e03e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Inverse23s", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"m", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"nr", "=", 
          RowBox[{"Length", "[", "m", "]"}]}], ",", 
         RowBox[{"nc", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"m", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "im"}], "}"}], ",", 
       RowBox[{
        RowBox[{"im", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", "nc", "}"}], ",", 
           RowBox[{"{", "nr", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"nr", ">", "3"}], " ", "||", " ", 
             RowBox[{"nc", ">", "nr"}]}], ",", 
            RowBox[{"Return", "[", "im", "]"}]}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "2"}], "&&", 
           RowBox[{"nr", "\[Equal]", "2"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"m", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2"}], "]"}], "]"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{"-", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "/", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}]}], 
                 ")"}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "/", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}]}], 
                 ")"}]}], ",", 
               RowBox[{
                RowBox[{"m", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}]}]}], 
              "}"}]}], "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nc", "\[Equal]", "3"}], "&&", 
           RowBox[{"nr", "\[Equal]", "3"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}], ")"}]}]}], 
              "}"}]}], "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        "im"}]}], "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7874909232474513`*^9, 3.7874909465207825`*^9}},
 CellLabel->
  "In[516]:=",ExpressionUUID->"8c2b0bed-c579-4b7d-80ed-ce14a60a4120"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MultiIndexList0", "[", 
    RowBox[{"d_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", "c"}], "}"}], ",", 
     RowBox[{
      RowBox[{"a", "=", 
       RowBox[{"Subsets", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"d", "+", "n"}], "]"}], ",", 
         RowBox[{"{", "d", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"c", "=", 
          RowBox[{"a", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{"b", "=", 
          RowBox[{"c", "-", "1"}]}], ";", 
         RowBox[{
          RowBox[{"b", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}], "-=", 
          RowBox[{"c", "[", 
           RowBox[{"[", 
            RowBox[{"1", ";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"a", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", "b"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", "a"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MultiIndexList1", "[", 
    RowBox[{"d_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Permutations", "[", "ip", "]"}], "-", "1"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "n"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ip", ",", 
         RowBox[{"IntegerPartitions", "[", 
          RowBox[{
           RowBox[{"k", "+", "d"}], ",", 
           RowBox[{"{", "d", "}"}]}], "]"}]}], "}"}]}], "]"}], ",", "2"}], 
    "]"}]}], ";"}]}], "Input",
 CellLabel->
  "In[522]:=",ExpressionUUID->"53690920-02aa-4886-88e5-abd5436a66f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MultiIndexList", "[", 
    RowBox[{"d_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Permutations", "[", "ip", "]"}], "-", "1"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "n"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ip", ",", 
         RowBox[{"IntegerPartitions", "[", 
          RowBox[{
           RowBox[{"k", "+", "d"}], ",", 
           RowBox[{"{", "d", "}"}]}], "]"}]}], "}"}]}], "]"}], ",", "2"}], 
    "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[524]:=",ExpressionUUID->"dd7cc694-407b-4fe6-ae58-f99d4f71545d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"TaylorSeries0", "[", 
    RowBox[{"f_", ",", 
     RowBox[{"{", 
      RowBox[{"X_", ",", "X0_", ",", "n_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"vars", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "X", "}"}], "]"}]}], ",", 
       RowBox[{"vars0", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "X0", "}"}], "]"}]}], ",", "d", ",", "alist", ",", 
       "xlist", ",", "dflist", ",", "xx"}], "}"}], ",", 
     RowBox[{
      RowBox[{"d", "=", 
       RowBox[{"Length", "[", "vars", "]"}]}], ";", 
      RowBox[{"xx", "=", 
       RowBox[{"vars", "-", "vars0"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"alist", "=", 
       RowBox[{"MultiIndexList0", "[", 
        RowBox[{"d", ",", "n"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"xlist", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"1", "/", 
           RowBox[{"Apply", "[", 
            RowBox[{"Times", ",", 
             RowBox[{"Factorial", "[", "nn", "]"}]}], "]"}]}], " ", 
          RowBox[{"Apply", "[", 
           RowBox[{"Times", ",", 
            RowBox[{"xx", "^", "nn"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", "alist"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dflist", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"f", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"Transpose", "[", 
              RowBox[{"{", 
               RowBox[{"vars", ",", "nn"}], "}"}], "]"}]}]}], "]"}], "/.", 
          RowBox[{"(", 
           RowBox[{"Rule", "@@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"vars", ",", "vars0"}], "}"}], "\[Transpose]"}], 
             ")"}]}], ")"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", "alist"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"xlist", ",", "dflist"}], "}"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TaylorSeries1", "[", 
    RowBox[{"f_", ",", 
     RowBox[{"{", 
      RowBox[{"X_", ",", "X0_", ",", "n_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"vars", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "X", "}"}], "]"}]}], ",", 
       RowBox[{"vars0", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "X0", "}"}], "]"}]}], ",", "d", ",", "alist", ",", 
       "xlist", ",", "dflist", ",", "xx"}], "}"}], ",", 
     RowBox[{
      RowBox[{"d", "=", 
       RowBox[{"Length", "[", "vars", "]"}]}], ";", 
      RowBox[{"xx", "=", 
       RowBox[{"vars", "-", "vars0"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"alist", "=", 
       RowBox[{"MultiIndexList1", "[", 
        RowBox[{"d", ",", "n"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"xlist", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"1", "/", 
           RowBox[{"Apply", "[", 
            RowBox[{"Times", ",", 
             RowBox[{"Factorial", "[", "nn", "]"}]}], "]"}]}], " ", 
          RowBox[{"Apply", "[", 
           RowBox[{"Times", ",", 
            RowBox[{"xx", "^", "nn"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", "alist"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dflist", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"f", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"Transpose", "[", 
              RowBox[{"{", 
               RowBox[{"vars", ",", "nn"}], "}"}], "]"}]}]}], "]"}], "/.", 
          RowBox[{"(", 
           RowBox[{"Rule", "@@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"vars", ",", "vars0"}], "}"}], "\[Transpose]"}], 
             ")"}]}], ")"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", "alist"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"{", 
       RowBox[{"xlist", ",", "dflist"}], "}"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{3.7896473909182076`*^9},
 CellLabel->
  "In[525]:=",ExpressionUUID->"e06b55b3-abfb-40a3-b065-a7ff3a9dae6b"]
}, Open  ]]
},
WindowSize->{828.75, 729.75},
WindowMargins->{{Automatic, 142.5}, {Automatic, 72.75}},
FrontEndVersion->"13.0 for Microsoft Windows (64-bit) (February 4, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"ce646e49-2b2f-430b-b9c4-263408d2ffc2"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 2258, 61, 309, "Input",ExpressionUUID->"e105784a-1344-4304-ac26-917ea4cbff95"],
Cell[2819, 83, 2094, 51, 190, "Input",ExpressionUUID->"50f569c4-75fd-4294-973f-250ca1546d90"],
Cell[4916, 136, 1154, 32, 132, "Input",ExpressionUUID->"ead747ab-a475-45d0-935c-942ca3023394"],
Cell[6073, 170, 15449, 419, 1306, "Input",ExpressionUUID->"ed31c5e5-d606-4bf4-bdec-8f23718a6674"],
Cell[21525, 591, 2065, 51, 149, "Input",ExpressionUUID->"30bca96f-8013-4735-ad3a-d1cde44703ab"],
Cell[23593, 644, 1657, 46, 149, "Input",ExpressionUUID->"d358a4a8-b9e5-4afb-bd62-d8afa2af52f0"],
Cell[25253, 692, 3266, 81, 205, "Input",ExpressionUUID->"09d9eda1-2b53-47c8-a773-3d0b3bd061fb"],
Cell[28522, 775, 3711, 100, 295, "Input",ExpressionUUID->"df8df1fe-7250-4062-bf28-367877bd16e4"],
Cell[32236, 877, 9661, 230, 834, "Input",ExpressionUUID->"c30f8721-3d32-4eac-9642-48abbf85afad"],
Cell[41900, 1109, 1102, 31, 154, "Input",ExpressionUUID->"82d03511-a52a-4ba4-ace3-242c94520a1b"],
Cell[43005, 1142, 26283, 704, 2887, "Input",ExpressionUUID->"8bf8b900-51cc-4c9e-98e1-49f3946e1aaf"],
Cell[69291, 1848, 13496, 344, 1276, "Input",ExpressionUUID->"d53ff229-8103-482f-81fe-65e66cf13b1d"],
Cell[82790, 2194, 416, 10, 86, "Input",ExpressionUUID->"7f432fc8-137b-4b21-b2e2-be14400381eb"],
Cell[CellGroupData[{
Cell[83231, 2208, 164, 3, 32, "Item",ExpressionUUID->"39aaa096-038c-4d3f-ac63-6c3949186219"],
Cell[83398, 2213, 6056, 145, 510, "Input",ExpressionUUID->"1ad30bbf-db65-4bae-b16d-c67035b0446a"],
Cell[89457, 2360, 6404, 160, 592, "Input",ExpressionUUID->"311d74ef-3168-4f10-baab-098d6d4561f0"],
Cell[95864, 2522, 4283, 113, 456, "Input",ExpressionUUID->"db6e76c5-0d14-43ab-8490-859b3d9ca1b6"],
Cell[100150, 2637, 3023, 85, 349, "Input",ExpressionUUID->"936e3ef6-695c-4e36-92ed-2549fe81c7b8"],
Cell[103176, 2724, 813, 22, 78, "Input",ExpressionUUID->"f4fa9db1-3b4a-4d65-98b0-3f3a709625d5"],
Cell[103992, 2748, 5012, 139, 597, "Input",ExpressionUUID->"eb664222-df08-448d-8f58-9445e6431beb"]
}, Open  ]],
Cell[CellGroupData[{
Cell[109041, 2892, 170, 3, 32, "Item",ExpressionUUID->"572c77ee-17c5-45c4-b817-4471d029ab12"],
Cell[109214, 2897, 44223, 1147, 4626, "Input",ExpressionUUID->"455eddb4-95b6-4914-9c7f-c2011fe8cd2a"],
Cell[153440, 4046, 3265, 87, 330, "Input",ExpressionUUID->"362d68e5-35ee-4cb0-8e52-a2988714d983"],
Cell[156708, 4135, 6338, 175, 678, "Input",ExpressionUUID->"8fc51a60-a259-4f12-9e19-39c255bbdfe3"],
Cell[163049, 4312, 14736, 390, 1469, "Input",ExpressionUUID->"e2a0f909-ed00-43dd-9290-7f6903a7f5db"],
Cell[177788, 4704, 15218, 393, 1393, "Input",ExpressionUUID->"bf75def9-d273-4c01-8ba5-bcf5eb9952f2"],
Cell[193009, 5099, 405, 6, 28, "Input",ExpressionUUID->"0c0bceea-6799-4a12-8049-fd569d82b055"],
Cell[193417, 5107, 4748, 102, 439, "Input",ExpressionUUID->"5bcdb1d8-1a4a-481f-8ba5-d050bb469a1c"],
Cell[198168, 5211, 1347, 32, 118, "Input",ExpressionUUID->"091b26eb-f03e-42fd-ad5d-d9b65a3c1020"],
Cell[199518, 5245, 1857, 54, 205, "Input",ExpressionUUID->"5ef18d52-94aa-4726-bd96-81240d4827a7"],
Cell[201378, 5301, 17188, 448, 1353, "Input",ExpressionUUID->"519377cf-33a2-4b21-ae82-5025826dec62"],
Cell[218569, 5751, 2175, 58, 184, "Input",ExpressionUUID->"b523d0c3-07d1-49cd-965e-6d9d735084a0"],
Cell[220747, 5811, 8284, 224, 760, "Input",ExpressionUUID->"c2d9ce55-e8e3-404f-bdb3-d5b48520bc71"],
Cell[229034, 6037, 2196, 61, 255, "Input",ExpressionUUID->"c55cda74-632b-4a5e-82fa-86f3a60aa86c"],
Cell[231233, 6100, 2783, 73, 298, "Input",ExpressionUUID->"13d739a2-4761-4c8b-abbf-86ff4a33d9b8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[234053, 6178, 485, 8, 74, "Item",ExpressionUUID->"050a5c44-adc9-4d2a-a6b4-5f5d808316fc"],
Cell[234541, 6188, 1122, 33, 114, "Input",ExpressionUUID->"ff5e3f6c-5653-423f-ad0c-2a5b10a76f6a"],
Cell[235666, 6223, 9423, 256, 942, "Input",ExpressionUUID->"8b76476d-1aad-415d-9cae-34e1bffeb26d"],
Cell[245092, 6481, 5425, 140, 599, "Input",ExpressionUUID->"9d5d62c2-d2e4-411d-8000-ade58c266894"],
Cell[250520, 6623, 3553, 98, 314, "Input",ExpressionUUID->"8ad7010e-45ab-46a5-881c-7197867505e2"],
Cell[254076, 6723, 2518, 64, 170, "Input",ExpressionUUID->"fe5d3a1d-bc56-4726-a6c0-1f0ffc13e609"],
Cell[256597, 6789, 894, 27, 114, "Input",ExpressionUUID->"1278be06-d382-4d2a-b140-9e7c06b7593c"],
Cell[257494, 6818, 1867, 55, 170, "Input",ExpressionUUID->"ad1f1d08-5416-4176-99e7-1c97e28475ed"]
}, Open  ]],
Cell[259376, 6876, 182, 3, 32, "Item",ExpressionUUID->"7e466f42-1c56-4987-8141-2d8fdfc669e2"],
Cell[259561, 6881, 310, 7, 32, "Item",ExpressionUUID->"d21948e0-03c1-41d1-823f-1bb07a722204"],
Cell[259874, 6890, 191, 4, 32, "Item",ExpressionUUID->"c38b6a25-eca2-401c-aa86-c214d4179ea7"],
Cell[CellGroupData[{
Cell[260090, 6898, 3688, 95, 1334, "Item",ExpressionUUID->"957e1dd9-4e14-4edb-98b9-7e9f7417072c"],
Cell[263781, 6995, 1867, 51, 184, "Input",ExpressionUUID->"d7353588-95a4-4d13-ae6d-9bf89e87fabb"],
Cell[265651, 7048, 2486, 69, 241, "Input",ExpressionUUID->"3af695ba-9b24-4c8f-aa98-c48c92102d16"],
Cell[268140, 7119, 5079, 125, 703, "Input",ExpressionUUID->"7c6986c2-2bec-48cc-b933-e4d0350ff0c2"],
Cell[273222, 7246, 4549, 109, 439, "Input",ExpressionUUID->"98863b39-0656-46a9-b9f4-d3d08bf3adb5"]
}, Open  ]],
Cell[CellGroupData[{
Cell[277808, 7360, 186, 3, 32, "Item",ExpressionUUID->"abd17a81-3781-4e5b-8e37-c57c22cde1a0"],
Cell[277997, 7365, 2822, 93, 124, "Input",ExpressionUUID->"0acf3d70-ccc4-41e8-8c79-c4dadfc907f0"],
Cell[280822, 7460, 1038, 30, 64, "Input",ExpressionUUID->"4090ae40-02f3-46ef-8885-1cd57c70f6c8"],
Cell[281863, 7492, 913, 26, 43, "Input",ExpressionUUID->"23e46948-120e-4a5e-b829-70c6d17999ee"],
Cell[282779, 7520, 2463, 59, 295, "Input",ExpressionUUID->"5229475c-b39b-448b-b04d-2afbc05939d3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[285279, 7584, 267, 6, 53, "Item",ExpressionUUID->"7b601118-711e-42d9-8129-45a3007a47c4"],
Cell[285549, 7592, 457, 13, 43, "Input",ExpressionUUID->"4fff793b-625d-4492-b5d5-a636615665b1"],
Cell[286009, 7607, 3850, 94, 341, "Input",ExpressionUUID->"fc563faa-08c1-4666-8f5b-86fd9dfbb25d"],
Cell[289862, 7703, 18199, 455, 1724, "Input",ExpressionUUID->"e92473e4-815e-4c33-b3e3-01ae656a2d02"],
Cell[308064, 8160, 7540, 188, 722, "Input",ExpressionUUID->"b665b527-0506-4c3a-a7b2-c4703986585f"],
Cell[315607, 8350, 8776, 224, 806, "Input",ExpressionUUID->"b8bcd98e-414d-41b6-b527-42a88e6cd74d"],
Cell[324386, 8576, 4722, 142, 258, "Input",ExpressionUUID->"3a0a0eca-2b75-46b7-95c4-aaa70c748d40"],
Cell[329111, 8720, 23954, 584, 1459, "Input",ExpressionUUID->"b6d651c0-bc7b-4029-8f68-bedb71f7b444"],
Cell[353068, 9306, 2466, 66, 252, "Input",ExpressionUUID->"d563575d-f5b8-491b-8dde-ef901836448d"],
Cell[355537, 9374, 6673, 177, 711, "Input",ExpressionUUID->"75af13f3-5fa7-4ee0-8e05-8fd2e60ac6b8"],
Cell[362213, 9553, 3376, 90, 144, "Input",ExpressionUUID->"ce9d8726-c797-497e-9314-b3e2f40d110e"],
Cell[365592, 9645, 1959, 54, 162, "Input",ExpressionUUID->"164d402d-d927-45c8-a2a0-ad5ea7cd5b7e"],
Cell[367554, 9701, 1505, 38, 184, "Input",ExpressionUUID->"519d7920-feab-4cdb-89db-c329968ef2d6"],
Cell[369062, 9741, 13498, 399, 1246, "Input",ExpressionUUID->"5eb2973d-b4e5-4986-846a-8a997ad80f58"],
Cell[382563, 10142, 1968, 53, 239, "Input",ExpressionUUID->"96d017a4-6495-428a-83e1-03aea584db81"],
Cell[384534, 10197, 2131, 57, 260, "Input",ExpressionUUID->"7cf8cf19-05c9-4829-925c-1b4962692ad7"],
Cell[386668, 10256, 1846, 51, 260, "Input",ExpressionUUID->"8b675a3e-bdab-4a77-84f1-0778138c51af"],
Cell[388517, 10309, 16702, 471, 665, "Input",ExpressionUUID->"17024ff7-cee8-4403-9d7d-be8b41330e8b"],
Cell[405222, 10782, 9225, 252, 712, "Input",ExpressionUUID->"c9aef998-52e3-4ac2-a96a-3ecc4fd468a5"],
Cell[414450, 11036, 1856, 53, 402, "Input",ExpressionUUID->"a61ac640-34d1-4e25-9eee-2c5edfd1e743"],
Cell[416309, 11091, 762, 23, 78, "Input",ExpressionUUID->"3fdd37c4-14fd-4677-90fa-d15cdc879fee"],
Cell[417074, 11116, 5009, 138, 586, "Input",ExpressionUUID->"01653314-93c2-4dbe-94cc-37ab4f1c0723"],
Cell[422086, 11256, 915, 26, 133, "Input",ExpressionUUID->"5488d6bd-65ed-4fec-a8bb-7f971a081be0"],
Cell[423004, 11284, 572, 16, 78, "Input",ExpressionUUID->"713e086b-655d-48ad-8924-02c51b32bb52"],
Cell[423579, 11302, 336, 8, 28, "Input",ExpressionUUID->"c7ea3069-280a-4840-8226-42574a58bdfc"],
Cell[423918, 11312, 2321, 65, 241, "Input",ExpressionUUID->"f062aafa-da9e-4dc0-85f5-499410fd3c08"]
}, Open  ]],
Cell[CellGroupData[{
Cell[426276, 11382, 234, 6, 81, "Subsection",ExpressionUUID->"d98d7d3e-8dc7-4005-814f-17f35b61ef7b"],
Cell[426513, 11390, 3664, 100, 281, "Input",ExpressionUUID->"173de568-b680-4732-8881-dcdb3f737a44"],
Cell[430180, 11492, 1983, 55, 86, "Input",ExpressionUUID->"b6d5d201-19b5-4e4c-8f26-093dd6097fbb"]
}, Open  ]],
Cell[CellGroupData[{
Cell[432200, 11552, 176, 3, 67, "Section",ExpressionUUID->"4919b444-bf6c-49bb-8106-7de361890102"],
Cell[432379, 11557, 8866, 201, 861, "Input",ExpressionUUID->"f275bb74-c552-4c60-bbbf-81cfc0cbe699"],
Cell[441248, 11760, 1358, 39, 149, "Input",ExpressionUUID->"9a188ad9-b892-4484-abfc-a42f47d860b7"],
Cell[442609, 11801, 3989, 88, 594, "Input",ExpressionUUID->"83a8766e-5b9e-4ba9-8b60-83854c7470a4"],
Cell[446601, 11891, 3041, 76, 594, "Input",ExpressionUUID->"0aafdcd8-9ff4-4ea3-ab9d-295b327bbc61"],
Cell[449645, 11969, 18968, 485, 2746, "Input",ExpressionUUID->"3f701474-3e00-4c96-a643-81764a82c9ac"],
Cell[468616, 12456, 1810, 50, 314, "Input",ExpressionUUID->"2787641a-c57e-4e0e-bdb3-3e14c4c9fcf1"],
Cell[470429, 12508, 1072, 29, 149, "Input",ExpressionUUID->"0bd05017-99cd-4e98-8195-3013ae4ba0b9"],
Cell[471504, 12539, 3040, 84, 189, "Input",ExpressionUUID->"0a7590e5-b735-4d3a-93d3-83d8628163e6"],
Cell[474547, 12625, 15018, 370, 996, "Input",ExpressionUUID->"753d2943-a05b-4c2e-8947-3668c1b905d8"],
Cell[489568, 12997, 1740, 48, 135, "Input",ExpressionUUID->"28a65ebb-f4d6-4e8e-aa3a-858c0f1d69d4"],
Cell[491311, 13047, 8715, 206, 534, "Input",ExpressionUUID->"bb226940-47ec-4b80-9f63-bdedff01cddd"],
Cell[500029, 13255, 9152, 237, 422, "Input",ExpressionUUID->"2d18e92a-e288-4b95-88c0-e2390be6b987"],
Cell[509184, 13494, 1239, 32, 105, "Input",ExpressionUUID->"373e2789-972b-490f-86da-1cdb6b6a0bba"],
Cell[510426, 13528, 73744, 1770, 1556, "Input",ExpressionUUID->"9dde3fee-bfe7-49ac-b3e7-9bcba3d6e03e"],
Cell[584173, 15300, 37016, 881, 830, "Input",ExpressionUUID->"8c2b0bed-c579-4b7d-80ed-ce14a60a4120"],
Cell[621192, 16183, 1940, 59, 133, "Input",ExpressionUUID->"53690920-02aa-4886-88e5-abd5436a66f5"],
Cell[623135, 16244, 692, 21, 62, "Input",ExpressionUUID->"dd7cc694-407b-4fe6-ae58-f99d4f71545d"],
Cell[623830, 16267, 4449, 124, 393, "Input",ExpressionUUID->"e06b55b3-abfb-40a3-b065-a7ff3a9dae6b"]
}, Open  ]]
}
]
*)

